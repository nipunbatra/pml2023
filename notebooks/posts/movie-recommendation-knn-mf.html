<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nipun Batra">
<meta name="dcterms.date" content="2023-04-14">
<meta name="description" content="Movie Recommendation using KNN and Matrix Factorization">

<title>ES654 - Movie Recommendation using KNN and Matrix Factorization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ES654</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../grading.html" rel="" target="">
 <span class="menu-text">Grading Policy</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../faq.html" rel="" target="">
 <span class="menu-text">FAQs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../schedule.html" rel="" target="">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../quizzes.html" rel="" target="">
 <span class="menu-text">Quizzes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notebooks/index.html" rel="" target="">
 <span class="menu-text">Notebooks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://nipunbatra.github.io" rel="" target="">
 <span class="menu-text">Instructor Homepage</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Movie Recommendation using KNN and Matrix Factorization</h1>
</div>

<div>
  <div class="description">
    Movie Recommendation using KNN and Matrix Factorization
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nipun Batra </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 14, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config InlineBackend.figure_format <span class="op">=</span> <span class="st">'retina'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate some toy user and movie data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of users</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>n_users <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of movies</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>n_movies <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of ratings</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>n_ratings <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random user ids</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>user_ids <span class="op">=</span> np.random.randint(<span class="dv">0</span>, n_users, n_ratings)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random movie ids</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>movie_ids <span class="op">=</span> np.random.randint(<span class="dv">0</span>, n_movies, n_ratings)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random ratings</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>ratings <span class="op">=</span> np.random.randint(<span class="dv">1</span>, <span class="dv">6</span>, n_ratings)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe with the data</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'user_id'</span>: user_ids, <span class="st">'movie_id'</span>: movie_ids, <span class="st">'rating'</span>: ratings})</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># We should not have any duplicate ratings for the same user and movie</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop any rows that have duplicate user_id and movie_id pairs</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop_duplicates([<span class="st">'user_id'</span>, <span class="st">'movie_id'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">user_id</th>
<th data-quarto-table-cell-role="th">movie_id</th>
<th data-quarto-table-cell-role="th">rating</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>66</td>
<td>7</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>54</td>
<td>7</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>38</td>
<td>5</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>56</td>
<td>6</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>0</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">987</td>
<td>77</td>
<td>8</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">992</td>
<td>99</td>
<td>3</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">994</td>
<td>8</td>
<td>5</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">998</td>
<td>22</td>
<td>2</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999</td>
<td>88</td>
<td>9</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>642 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a user-item matrix</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> df.pivot(index<span class="op">=</span><span class="st">'user_id'</span>, columns<span class="op">=</span><span class="st">'movie_id'</span>, values<span class="op">=</span><span class="st">'rating'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">movie_id</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">user_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3.0</td>
<td>4.0</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>1.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4.0</td>
<td>2.0</td>
<td>NaN</td>
<td>1.0</td>
<td>NaN</td>
<td>3.0</td>
<td>3.0</td>
<td>5.0</td>
<td>3.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.0</td>
<td>NaN</td>
<td>NaN</td>
<td>4.0</td>
<td>1.0</td>
<td>5.0</td>
<td>NaN</td>
<td>2.0</td>
<td>NaN</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
<td>2.0</td>
<td>NaN</td>
<td>3.0</td>
<td>NaN</td>
<td>2.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>3.0</td>
<td>NaN</td>
<td>NaN</td>
<td>4.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>2.0</td>
<td>3.0</td>
<td>NaN</td>
<td>1.0</td>
<td>NaN</td>
<td>5.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">96</td>
<td>1.0</td>
<td>2.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">97</td>
<td>3.0</td>
<td>1.0</td>
<td>4.0</td>
<td>NaN</td>
<td>3.0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>5.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">98</td>
<td>5.0</td>
<td>3.0</td>
<td>NaN</td>
<td>NaN</td>
<td>2.0</td>
<td>NaN</td>
<td>1.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99</td>
<td>1.0</td>
<td>5.0</td>
<td>2.0</td>
<td>3.0</td>
<td>NaN</td>
<td>2.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill in the missing values with zeros</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> A.fillna(<span class="dv">0</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">movie_id</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">user_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3.0</td>
<td>4.0</td>
<td>0.0</td>
<td>5.0</td>
<td>5.0</td>
<td>1.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4.0</td>
<td>2.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>3.0</td>
<td>3.0</td>
<td>5.0</td>
<td>3.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>1.0</td>
<td>5.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.0</td>
<td>0.0</td>
<td>4.0</td>
<td>2.0</td>
<td>0.0</td>
<td>3.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0.0</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>2.0</td>
<td>3.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">96</td>
<td>1.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">97</td>
<td>3.0</td>
<td>1.0</td>
<td>4.0</td>
<td>0.0</td>
<td>3.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">98</td>
<td>5.0</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0.0</td>
<td>1.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99</td>
<td>1.0</td>
<td>5.0</td>
<td>2.0</td>
<td>3.0</td>
<td>0.0</td>
<td>2.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cosine similarity between U1 and U2</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># User 1</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>u1 <span class="op">=</span> A.loc[<span class="dv">0</span>]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># User 2</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>u2 <span class="op">=</span> A.loc[<span class="dv">1</span>]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the dot product</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>dot <span class="op">=</span> np.dot(u1, u2)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the L2 norm</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>norm_u1 <span class="op">=</span> np.linalg.norm(u1)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>norm_u2 <span class="op">=</span> np.linalg.norm(u2)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the cosine similarity</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>cos_sim <span class="op">=</span> dot <span class="op">/</span> (norm_u1 <span class="op">*</span> norm_u2)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>cos_sim</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>0.7174278379758501</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the cosine similarity between users</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics.pairwise <span class="im">import</span> cosine_similarity</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>sim_matrix <span class="op">=</span> cosine_similarity(A)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(sim_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">90</th>
<th data-quarto-table-cell-role="th">91</th>
<th data-quarto-table-cell-role="th">92</th>
<th data-quarto-table-cell-role="th">93</th>
<th data-quarto-table-cell-role="th">94</th>
<th data-quarto-table-cell-role="th">95</th>
<th data-quarto-table-cell-role="th">96</th>
<th data-quarto-table-cell-role="th">97</th>
<th data-quarto-table-cell-role="th">98</th>
<th data-quarto-table-cell-role="th">99</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.000000</td>
<td>0.717428</td>
<td>0.663734</td>
<td>0.565794</td>
<td>0.547289</td>
<td>0.742468</td>
<td>0.539472</td>
<td>0.599021</td>
<td>0.748964</td>
<td>0.523832</td>
<td>...</td>
<td>0.876593</td>
<td>0.593722</td>
<td>0.615664</td>
<td>0.722496</td>
<td>0.783190</td>
<td>0.657754</td>
<td>0.665375</td>
<td>0.446627</td>
<td>0.774667</td>
<td>0.703313</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.717428</td>
<td>1.000000</td>
<td>0.650769</td>
<td>0.591169</td>
<td>0.559964</td>
<td>0.585314</td>
<td>0.300491</td>
<td>0.255039</td>
<td>0.693395</td>
<td>0.500193</td>
<td>...</td>
<td>0.609392</td>
<td>0.313893</td>
<td>0.510454</td>
<td>0.550459</td>
<td>0.624622</td>
<td>0.493197</td>
<td>0.644346</td>
<td>0.476288</td>
<td>0.802740</td>
<td>0.781611</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.663734</td>
<td>0.650769</td>
<td>1.000000</td>
<td>0.758954</td>
<td>0.406780</td>
<td>0.372046</td>
<td>0.416654</td>
<td>0.270593</td>
<td>0.746685</td>
<td>0.560180</td>
<td>...</td>
<td>0.519274</td>
<td>0.322243</td>
<td>0.772529</td>
<td>0.253842</td>
<td>0.712485</td>
<td>0.257761</td>
<td>0.322830</td>
<td>0.283373</td>
<td>0.441886</td>
<td>0.459929</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.565794</td>
<td>0.591169</td>
<td>0.758954</td>
<td>1.000000</td>
<td>0.549030</td>
<td>0.540128</td>
<td>0.671775</td>
<td>0.572892</td>
<td>0.611794</td>
<td>0.489225</td>
<td>...</td>
<td>0.424052</td>
<td>0.586110</td>
<td>0.456327</td>
<td>0.506719</td>
<td>0.715831</td>
<td>0.210494</td>
<td>0.506585</td>
<td>0.492312</td>
<td>0.551652</td>
<td>0.424052</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.547289</td>
<td>0.559964</td>
<td>0.406780</td>
<td>0.549030</td>
<td>1.000000</td>
<td>0.354329</td>
<td>0.304478</td>
<td>0.541185</td>
<td>0.821353</td>
<td>0.202287</td>
<td>...</td>
<td>0.667638</td>
<td>0.527306</td>
<td>0.339913</td>
<td>0.435159</td>
<td>0.582943</td>
<td>0.478699</td>
<td>0.417780</td>
<td>0.450063</td>
<td>0.502836</td>
<td>0.741820</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>0.657754</td>
<td>0.493197</td>
<td>0.257761</td>
<td>0.210494</td>
<td>0.478699</td>
<td>0.519615</td>
<td>0.452602</td>
<td>0.571548</td>
<td>0.551553</td>
<td>0.405674</td>
<td>...</td>
<td>0.564076</td>
<td>0.556890</td>
<td>0.604211</td>
<td>0.682793</td>
<td>0.661382</td>
<td>1.000000</td>
<td>0.412568</td>
<td>0.796715</td>
<td>0.678637</td>
<td>0.693008</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">96</td>
<td>0.665375</td>
<td>0.644346</td>
<td>0.322830</td>
<td>0.506585</td>
<td>0.417780</td>
<td>0.853538</td>
<td>0.359095</td>
<td>0.538977</td>
<td>0.351369</td>
<td>0.191776</td>
<td>...</td>
<td>0.498686</td>
<td>0.640033</td>
<td>0.190421</td>
<td>0.690704</td>
<td>0.682163</td>
<td>0.412568</td>
<td>1.000000</td>
<td>0.280141</td>
<td>0.734105</td>
<td>0.581800</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">97</td>
<td>0.446627</td>
<td>0.476288</td>
<td>0.283373</td>
<td>0.492312</td>
<td>0.450063</td>
<td>0.400743</td>
<td>0.709211</td>
<td>0.532239</td>
<td>0.469979</td>
<td>0.566223</td>
<td>...</td>
<td>0.262641</td>
<td>0.446564</td>
<td>0.501441</td>
<td>0.689500</td>
<td>0.637007</td>
<td>0.796715</td>
<td>0.280141</td>
<td>1.000000</td>
<td>0.659366</td>
<td>0.481508</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">98</td>
<td>0.774667</td>
<td>0.802740</td>
<td>0.441886</td>
<td>0.551652</td>
<td>0.502836</td>
<td>0.844146</td>
<td>0.446610</td>
<td>0.473016</td>
<td>0.617575</td>
<td>0.335738</td>
<td>...</td>
<td>0.546861</td>
<td>0.500390</td>
<td>0.305585</td>
<td>0.673754</td>
<td>0.687116</td>
<td>0.678637</td>
<td>0.734105</td>
<td>0.659366</td>
<td>1.000000</td>
<td>0.600213</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99</td>
<td>0.703313</td>
<td>0.781611</td>
<td>0.459929</td>
<td>0.424052</td>
<td>0.741820</td>
<td>0.527274</td>
<td>0.294579</td>
<td>0.578997</td>
<td>0.732042</td>
<td>0.435869</td>
<td>...</td>
<td>0.818182</td>
<td>0.615435</td>
<td>0.581559</td>
<td>0.645439</td>
<td>0.623673</td>
<td>0.693008</td>
<td>0.581800</td>
<td>0.481508</td>
<td>0.600213</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

<p>100 rows × 100 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>sns.heatmap(sim_matrix, cmap<span class="op">=</span><span class="st">'Greys'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="movie-recommendation-knn-mf_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the most similar users to user u </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> k_nearest_neighbors(A, u, k):</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Find the k nearest neighbors for user u"""</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the index of the user in the matrix</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    u_index <span class="op">=</span> A.index.get_loc(u)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the similarity between the user and all other users</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    sim_matrix <span class="op">=</span> cosine_similarity(A)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the k most similar users</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    k_nearest <span class="op">=</span> np.argsort(sim_matrix[u_index])[::<span class="op">-</span><span class="dv">1</span>][<span class="dv">1</span>:k<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the user ids</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> A.index[k_nearest]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>k_nearest_neighbors(A, <span class="dv">0</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>Int64Index([28, 46, 90, 32, 87], dtype='int64', name='user_id')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show matrix of movie ratings for u and k nearest neighbors</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_neighbors(A, u, k):</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Show the movie ratings for user u and k nearest neighbors"""</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the user ids of the k nearest neighbors</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> k_nearest_neighbors(A, u, k)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the movie ratings for user u and the k nearest neighbors</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> A.loc[[u] <span class="op">+</span> <span class="bu">list</span>(neighbors)]</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the dataframe</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>show_neighbors(A, <span class="dv">0</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">movie_id</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">user_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3.0</td>
<td>4.0</td>
<td>0.0</td>
<td>5.0</td>
<td>5.0</td>
<td>1.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">28</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>4.0</td>
<td>2.0</td>
<td>1.0</td>
<td>4.0</td>
<td>0.0</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>3.0</td>
<td>0.0</td>
<td>2.0</td>
<td>5.0</td>
<td>5.0</td>
<td>1.0</td>
<td>0.0</td>
<td>4.0</td>
<td>2.0</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">90</td>
<td>1.0</td>
<td>5.0</td>
<td>1.0</td>
<td>5.0</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
<td>4.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">87</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>4.0</td>
<td>0.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rating for user u for movie 0 is: (4.0 + 3.0) / 2 = 3.5 (Discard 0s)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> predict_rating(A, u, m, k<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Predict the rating for user u for movie m"""</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the user ids of the k nearest neighbors</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> k_nearest_neighbors(A, u, k)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the movie ratings for user u and the k nearest neighbors</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> A.loc[[u] <span class="op">+</span> <span class="bu">list</span>(neighbors)]</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the ratings for movie m</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    ratings <span class="op">=</span> df[m]</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the mean of the ratings</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    mean <span class="op">=</span> ratings[<span class="dv">1</span>:][ratings <span class="op">!=</span> <span class="dv">0</span>].mean()</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the mean</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>predict_rating(A, <span class="dv">0</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>2.6666666666666665</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now working with real data</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(<span class="st">"mov-rec.xlsx"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Timestamp</th>
<th data-quarto-table-cell-role="th">Your name</th>
<th data-quarto-table-cell-role="th">Sholay</th>
<th data-quarto-table-cell-role="th">Swades (We The People)</th>
<th data-quarto-table-cell-role="th">The Matrix (I)</th>
<th data-quarto-table-cell-role="th">Interstellar</th>
<th data-quarto-table-cell-role="th">Dangal</th>
<th data-quarto-table-cell-role="th">Taare Zameen Par</th>
<th data-quarto-table-cell-role="th">Shawshank Redemption</th>
<th data-quarto-table-cell-role="th">The Dark Knight</th>
<th data-quarto-table-cell-role="th">Notting Hill</th>
<th data-quarto-table-cell-role="th">Uri: The Surgical Strike</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2023-04-11 10:58:44.990</td>
<td>Nipun</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2023-04-11 10:59:49.617</td>
<td>Gautam Vashishtha</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>1.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2023-04-11 11:12:44.033</td>
<td>Eshan Gujarathi</td>
<td>4.0</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2023-04-11 11:13:48.674</td>
<td>Sai Krishna Avula</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2023-04-11 11:13:55.658</td>
<td>Ankit Yadav</td>
<td>3.0</td>
<td>3.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Discard the timestamp column</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'Timestamp'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the "Your Name" column the index</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.set_index(<span class="st">'Your name'</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sholay</th>
<th data-quarto-table-cell-role="th">Swades (We The People)</th>
<th data-quarto-table-cell-role="th">The Matrix (I)</th>
<th data-quarto-table-cell-role="th">Interstellar</th>
<th data-quarto-table-cell-role="th">Dangal</th>
<th data-quarto-table-cell-role="th">Taare Zameen Par</th>
<th data-quarto-table-cell-role="th">Shawshank Redemption</th>
<th data-quarto-table-cell-role="th">The Dark Knight</th>
<th data-quarto-table-cell-role="th">Notting Hill</th>
<th data-quarto-table-cell-role="th">Uri: The Surgical Strike</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Your name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Nipun</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gautam Vashishtha</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>1.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Eshan Gujarathi</td>
<td>4.0</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Sai Krishna Avula</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Ankit Yadav</td>
<td>3.0</td>
<td>3.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Dhruv</td>
<td>NaN</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Saatvik Rao</td>
<td>4.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Zeel B Patel</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>NaN</td>
<td>2.0</td>
<td>NaN</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Neel</td>
<td>4.0</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Sachin Jalan</td>
<td>4.0</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>NaN</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Ayush Shrivastava</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">....</td>
<td>4.0</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Hari Hara Sudhan</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Etikikota Hrushikesh</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Chirag</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>2.0</td>
<td>3.0</td>
<td>4.0</td>
<td>2.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aaryan Darad</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Hetvi Patel</td>
<td>4.0</td>
<td>3.0</td>
<td>2.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Kalash Kankaria</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Rachit Verma</td>
<td>NaN</td>
<td>NaN</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">shriraj</td>
<td>3.0</td>
<td>2.0</td>
<td>5.0</td>
<td>4.0</td>
<td>2.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bhavini Korthi</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4.0</td>
<td>5.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Hitarth Gandhi</td>
<td>3.0</td>
<td>NaN</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Radhika Joglekar</td>
<td>3.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Medhansh Singh</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Arun Mani</td>
<td>NaN</td>
<td>NaN</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Satyam</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Karan Kumar</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">R Yeeshu Dhurandhar</td>
<td>5.0</td>
<td>NaN</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Satyam Gupta</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
<td>NaN</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">rushali</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">shridhar</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Tanvi Jain</td>
<td>4.0</td>
<td>3.0</td>
<td>NaN</td>
<td>NaN</td>
<td>4.0</td>
<td>5.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Manish Prabhubhai Salvi</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>4.0</td>
<td>NaN</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Varun Barala</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Kevin Shah</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Inderjeet</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Gangaram Siddam</td>
<td>4.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aditi</td>
<td>4.0</td>
<td>4.0</td>
<td>NaN</td>
<td>5.0</td>
<td>1.0</td>
<td>3.0</td>
<td>5.0</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Madhuri Awachar</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Anupam</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Jinay</td>
<td>3.0</td>
<td>1.0</td>
<td>4.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Shrutimoy</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aadesh Desai</td>
<td>4.0</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Dhairya</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
<td>NaN</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Rahul C</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>Index(['Nipun', 'Gautam Vashishtha', 'Eshan Gujarathi', 'Sai Krishna Avula',
       'Ankit Yadav ', 'Dhruv', 'Saatvik Rao ', 'Zeel B Patel', 'Neel ',
       'Sachin Jalan ', 'Ayush Shrivastava', '....', 'Hari Hara Sudhan',
       'Etikikota Hrushikesh', 'Chirag', 'Aaryan Darad', 'Hetvi Patel',
       'Kalash Kankaria', 'Rachit Verma', 'shriraj', 'Bhavini Korthi ',
       'Hitarth Gandhi ', 'Radhika Joglekar ', 'Medhansh Singh', 'Arun Mani',
       'Satyam ', 'Karan Kumar ', 'R Yeeshu Dhurandhar', 'Satyam Gupta',
       'rushali', 'shridhar', 'Tanvi Jain ', 'Manish Prabhubhai Salvi ',
       'Varun Barala', 'Kevin Shah ', 'Inderjeet', 'Gangaram Siddam ', 'Aditi',
       'Madhuri Awachar', 'Anupam', 'Jinay', 'Shrutimoy', 'Aadesh Desai',
       'Dhairya', 'Rahul C'],
      dtype='object', name='Your name')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get index for user and movie</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>user <span class="op">=</span> <span class="st">'Rahul C'</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(user <span class="kw">in</span> df.index)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the movie ratings for user</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>user_ratings <span class="op">=</span> df.loc[user]</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>user_ratings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>Sholay                      3.0
Swades (We The People)      3.0
The Matrix (I)              4.0
Interstellar                4.0
Dangal                      4.0
Taare Zameen Par            4.0
Shawshank Redemption        4.0
The Dark Knight             5.0
Notting Hill                NaN
Uri: The Surgical Strike    NaN
Name: Rahul C, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df_copy <span class="op">=</span> df.copy()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df_copy.fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>show_neighbors(df_copy, user, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sholay</th>
<th data-quarto-table-cell-role="th">Swades (We The People)</th>
<th data-quarto-table-cell-role="th">The Matrix (I)</th>
<th data-quarto-table-cell-role="th">Interstellar</th>
<th data-quarto-table-cell-role="th">Dangal</th>
<th data-quarto-table-cell-role="th">Taare Zameen Par</th>
<th data-quarto-table-cell-role="th">Shawshank Redemption</th>
<th data-quarto-table-cell-role="th">The Dark Knight</th>
<th data-quarto-table-cell-role="th">Notting Hill</th>
<th data-quarto-table-cell-role="th">Uri: The Surgical Strike</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Your name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Rahul C</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Shrutimoy</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>0.0</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Hitarth Gandhi</td>
<td>3.0</td>
<td>0.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">R Yeeshu Dhurandhar</td>
<td>5.0</td>
<td>0.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">shridhar</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Sachin Jalan</td>
<td>4.0</td>
<td>0.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>0.0</td>
<td>3.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sholay</th>
<th data-quarto-table-cell-role="th">Swades (We The People)</th>
<th data-quarto-table-cell-role="th">The Matrix (I)</th>
<th data-quarto-table-cell-role="th">Interstellar</th>
<th data-quarto-table-cell-role="th">Dangal</th>
<th data-quarto-table-cell-role="th">Taare Zameen Par</th>
<th data-quarto-table-cell-role="th">Shawshank Redemption</th>
<th data-quarto-table-cell-role="th">The Dark Knight</th>
<th data-quarto-table-cell-role="th">Notting Hill</th>
<th data-quarto-table-cell-role="th">Uri: The Surgical Strike</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>39.000000</td>
<td>32.000000</td>
<td>38.000000</td>
<td>43.000000</td>
<td>45.000000</td>
<td>44.000000</td>
<td>35.000000</td>
<td>40.000000</td>
<td>21.000000</td>
<td>39.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>4.102564</td>
<td>3.718750</td>
<td>4.131579</td>
<td>4.581395</td>
<td>3.644444</td>
<td>3.977273</td>
<td>4.400000</td>
<td>4.250000</td>
<td>3.476190</td>
<td>4.230769</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.753758</td>
<td>0.958304</td>
<td>0.991070</td>
<td>0.793802</td>
<td>1.003529</td>
<td>1.067242</td>
<td>0.976187</td>
<td>1.080123</td>
<td>0.813575</td>
<td>0.902089</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>3.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>2.000000</td>
<td>2.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>4.000000</td>
<td>3.000000</td>
<td>4.000000</td>
<td>4.000000</td>
<td>3.000000</td>
<td>3.000000</td>
<td>4.000000</td>
<td>4.000000</td>
<td>3.000000</td>
<td>4.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>4.000000</td>
<td>4.000000</td>
<td>4.000000</td>
<td>5.000000</td>
<td>4.000000</td>
<td>4.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>3.000000</td>
<td>4.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>5.000000</td>
<td>4.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>4.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>4.000000</td>
<td>5.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the rating for user u for movie m</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>predict_rating(df_copy, user, <span class="st">'The Dark Knight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>4.8</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>predict_rating(df_copy, user, <span class="st">'Sholay'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>4.4</code></pre>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic Matrix Factorization (without missing values)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># A is a matrix of size (n_users, n_movies) randomly generated values between 1 and 5</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> torch.randint(<span class="dv">1</span>, <span class="dv">6</span>, (n_users, n_movies), dtype<span class="op">=</span>torch.<span class="bu">float</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>tensor([[1., 5., 4., 3., 4., 3., 1., 3., 3., 4.],
        [3., 3., 4., 4., 4., 2., 5., 2., 2., 4.],
        [2., 5., 5., 3., 3., 1., 4., 5., 2., 5.],
        [4., 2., 1., 5., 1., 5., 1., 1., 5., 1.],
        [4., 3., 5., 3., 4., 1., 2., 4., 1., 5.],
        [1., 2., 2., 1., 2., 4., 1., 1., 3., 3.],
        [4., 2., 2., 3., 5., 3., 3., 2., 5., 2.],
        [2., 2., 1., 1., 2., 4., 5., 1., 4., 3.],
        [1., 3., 2., 1., 3., 4., 1., 5., 5., 1.],
        [4., 4., 2., 4., 1., 4., 2., 1., 4., 4.],
        [1., 3., 1., 2., 3., 1., 3., 2., 4., 4.],
        [5., 3., 5., 1., 4., 5., 4., 2., 1., 5.],
        [5., 1., 5., 3., 4., 4., 4., 2., 2., 2.],
        [1., 1., 2., 3., 5., 4., 3., 1., 1., 1.],
        [3., 2., 5., 4., 3., 5., 2., 4., 4., 3.],
        [2., 2., 4., 1., 2., 3., 2., 4., 3., 5.],
        [4., 2., 4., 5., 2., 2., 1., 2., 1., 1.],
        [4., 3., 2., 1., 1., 1., 5., 2., 1., 1.],
        [2., 1., 2., 1., 1., 1., 5., 5., 1., 4.],
        [1., 3., 5., 1., 5., 5., 5., 5., 2., 2.],
        [1., 2., 2., 5., 1., 1., 5., 4., 2., 5.],
        [5., 1., 2., 2., 1., 5., 2., 3., 5., 2.],
        [2., 2., 1., 5., 5., 5., 5., 3., 4., 3.],
        [1., 1., 4., 1., 2., 5., 5., 5., 2., 1.],
        [5., 3., 3., 1., 2., 3., 3., 2., 2., 3.],
        [2., 4., 5., 1., 2., 3., 5., 3., 1., 5.],
        [2., 1., 1., 1., 2., 2., 5., 5., 2., 1.],
        [3., 1., 1., 3., 3., 3., 2., 1., 3., 2.],
        [4., 4., 4., 5., 1., 3., 4., 3., 2., 2.],
        [4., 4., 4., 5., 2., 5., 2., 1., 4., 3.],
        [3., 3., 5., 1., 4., 3., 3., 3., 3., 2.],
        [2., 4., 2., 3., 4., 2., 4., 3., 3., 3.],
        [5., 4., 1., 5., 4., 3., 5., 1., 3., 4.],
        [3., 5., 3., 2., 4., 2., 5., 1., 2., 5.],
        [2., 5., 4., 1., 1., 5., 1., 5., 2., 4.],
        [1., 3., 3., 4., 4., 5., 2., 5., 3., 5.],
        [3., 3., 5., 3., 4., 1., 3., 1., 1., 3.],
        [2., 4., 1., 3., 5., 1., 5., 2., 4., 1.],
        [5., 2., 2., 3., 1., 4., 5., 5., 4., 2.],
        [5., 3., 5., 1., 5., 4., 3., 1., 1., 3.],
        [4., 2., 2., 2., 2., 1., 2., 1., 1., 3.],
        [2., 2., 1., 4., 1., 4., 5., 2., 5., 1.],
        [3., 4., 2., 1., 3., 1., 2., 5., 3., 5.],
        [1., 3., 3., 5., 3., 2., 1., 2., 5., 1.],
        [3., 4., 2., 4., 2., 3., 4., 1., 1., 1.],
        [1., 1., 5., 1., 3., 2., 5., 5., 5., 4.],
        [4., 4., 4., 4., 4., 3., 1., 4., 1., 1.],
        [3., 4., 5., 4., 1., 5., 2., 3., 1., 3.],
        [5., 2., 5., 5., 2., 4., 5., 4., 4., 5.],
        [3., 5., 5., 4., 1., 5., 1., 2., 5., 1.],
        [2., 4., 3., 5., 4., 5., 2., 5., 3., 3.],
        [3., 2., 3., 1., 1., 4., 1., 1., 2., 1.],
        [4., 1., 2., 4., 4., 3., 2., 2., 2., 4.],
        [2., 2., 3., 2., 3., 2., 2., 5., 4., 3.],
        [4., 2., 3., 4., 4., 1., 1., 4., 2., 3.],
        [2., 2., 3., 2., 2., 1., 4., 3., 5., 4.],
        [5., 5., 5., 4., 2., 1., 3., 1., 3., 3.],
        [2., 4., 5., 1., 2., 2., 5., 3., 3., 1.],
        [1., 4., 3., 2., 3., 5., 3., 2., 4., 4.],
        [1., 3., 2., 1., 2., 3., 2., 2., 5., 2.],
        [4., 5., 5., 3., 1., 2., 1., 3., 4., 4.],
        [4., 2., 3., 2., 3., 4., 5., 1., 4., 3.],
        [3., 2., 1., 3., 2., 2., 5., 5., 5., 1.],
        [2., 5., 5., 2., 3., 5., 3., 4., 3., 2.],
        [1., 2., 2., 4., 4., 5., 5., 2., 5., 1.],
        [4., 4., 1., 5., 2., 4., 4., 2., 4., 2.],
        [4., 1., 5., 3., 1., 4., 5., 2., 2., 2.],
        [3., 2., 2., 1., 1., 1., 2., 4., 2., 2.],
        [1., 1., 3., 2., 2., 4., 3., 3., 2., 2.],
        [2., 4., 3., 1., 1., 2., 4., 2., 5., 2.],
        [1., 4., 3., 5., 4., 2., 4., 2., 2., 5.],
        [4., 4., 5., 5., 4., 3., 4., 1., 4., 5.],
        [5., 2., 2., 1., 4., 4., 3., 5., 5., 5.],
        [3., 1., 3., 1., 2., 5., 5., 4., 3., 1.],
        [5., 5., 5., 3., 5., 3., 3., 3., 3., 3.],
        [5., 3., 3., 3., 4., 3., 5., 4., 5., 1.],
        [5., 5., 3., 5., 4., 1., 2., 1., 3., 2.],
        [5., 3., 4., 1., 5., 2., 4., 4., 2., 1.],
        [1., 2., 1., 2., 1., 3., 4., 1., 2., 1.],
        [5., 3., 3., 1., 5., 1., 4., 5., 5., 1.],
        [2., 2., 5., 2., 3., 5., 1., 5., 4., 2.],
        [3., 3., 1., 2., 5., 5., 4., 4., 4., 5.],
        [5., 3., 5., 3., 5., 5., 3., 4., 1., 4.],
        [5., 3., 2., 5., 1., 2., 4., 3., 1., 4.],
        [5., 2., 5., 2., 4., 3., 2., 2., 4., 5.],
        [2., 3., 5., 2., 4., 5., 3., 1., 4., 3.],
        [3., 3., 1., 4., 5., 2., 1., 3., 4., 4.],
        [5., 2., 3., 4., 2., 2., 5., 4., 2., 1.],
        [3., 1., 1., 2., 5., 1., 5., 1., 5., 3.],
        [3., 5., 1., 5., 3., 4., 5., 5., 4., 3.],
        [2., 4., 1., 5., 4., 1., 4., 5., 1., 4.],
        [5., 5., 4., 1., 2., 2., 2., 5., 1., 3.],
        [5., 2., 3., 3., 4., 3., 3., 4., 3., 2.],
        [1., 5., 4., 4., 5., 3., 4., 2., 4., 1.],
        [2., 4., 1., 1., 4., 2., 1., 1., 3., 4.],
        [4., 4., 2., 3., 2., 2., 3., 5., 4., 1.],
        [5., 4., 3., 4., 5., 4., 5., 1., 5., 5.],
        [1., 1., 1., 1., 4., 4., 5., 2., 4., 2.],
        [2., 4., 1., 2., 4., 3., 5., 1., 4., 4.],
        [2., 5., 2., 1., 3., 5., 5., 4., 1., 4.]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>A.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>torch.Size([100, 10])</code></pre>
</div>
</div>
<p>Let us decompose A as WH. W is of shape (n, k) and H is of shape (k, n). We can write the above equation as: A = WH</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly initialize A and B</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>W <span class="op">=</span> torch.randn(n_users, <span class="dv">2</span>, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> torch.randn(<span class="dv">2</span>, n_movies, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the loss</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> torch.norm(torch.mm(W, H) <span class="op">-</span> A)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>tensor(110.7991, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(torch.mm(W, H).detach().numpy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-1.733831</td>
<td>2.962563</td>
<td>-0.009936</td>
<td>-0.591927</td>
<td>2.442282</td>
<td>-0.533001</td>
<td>-0.500535</td>
<td>-0.777075</td>
<td>-0.427938</td>
<td>-0.050505</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-1.605388</td>
<td>2.875087</td>
<td>0.171515</td>
<td>-0.770741</td>
<td>2.594427</td>
<td>-0.652586</td>
<td>-0.512620</td>
<td>-0.953935</td>
<td>-0.329276</td>
<td>-0.023146</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.159360</td>
<td>-0.289060</td>
<td>-0.022038</td>
<td>0.082685</td>
<td>-0.266777</td>
<td>0.069192</td>
<td>0.052250</td>
<td>0.101196</td>
<td>0.030828</td>
<td>0.001642</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>-3.637741</td>
<td>4.346515</td>
<td>-2.580031</td>
<td>1.911339</td>
<td>0.407374</td>
<td>1.134387</td>
<td>-0.353923</td>
<td>1.689442</td>
<td>-1.846117</td>
<td>-0.440421</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1.706123</td>
<td>-2.207651</td>
<td>0.978520</td>
<td>-0.611154</td>
<td>-0.617788</td>
<td>-0.328235</td>
<td>0.228982</td>
<td>-0.492014</td>
<td>0.780051</td>
<td>0.176302</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>1.362280</td>
<td>-2.751892</td>
<td>-0.572962</td>
<td>1.180665</td>
<td>-2.989312</td>
<td>0.929992</td>
<td>0.551276</td>
<td>1.363935</td>
<td>0.121039</td>
<td>-0.036218</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">96</td>
<td>1.432943</td>
<td>-1.514237</td>
<td>1.287248</td>
<td>-1.086741</td>
<td>0.338909</td>
<td>-0.685343</td>
<td>0.065700</td>
<td>-1.016967</td>
<td>0.827599</td>
<td>0.208897</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">97</td>
<td>0.381086</td>
<td>0.345669</td>
<td>1.366953</td>
<td>-1.551476</td>
<td>1.978570</td>
<td>-1.084161</td>
<td>-0.261282</td>
<td>-1.599606</td>
<td>0.599750</td>
<td>0.189461</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">98</td>
<td>-3.364117</td>
<td>6.450801</td>
<td>0.942667</td>
<td>-2.333749</td>
<td>6.511645</td>
<td>-1.880903</td>
<td>-1.232884</td>
<td>-2.755594</td>
<td>-0.473888</td>
<td>0.027722</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99</td>
<td>0.877697</td>
<td>-1.631227</td>
<td>-0.175042</td>
<td>0.521516</td>
<td>-1.568212</td>
<td>0.428319</td>
<td>0.302370</td>
<td>0.626961</td>
<td>0.149908</td>
<td>0.002033</td>
</tr>
</tbody>
</table>

<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(A)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
<td>1.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>1.0</td>
<td>4.0</td>
<td>5.0</td>
<td>2.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.0</td>
<td>2.0</td>
<td>1.0</td>
<td>5.0</td>
<td>1.0</td>
<td>5.0</td>
<td>1.0</td>
<td>1.0</td>
<td>5.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>1.0</td>
<td>2.0</td>
<td>4.0</td>
<td>1.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>4.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">96</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>1.0</td>
<td>5.0</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">97</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>2.0</td>
<td>4.0</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">98</td>
<td>2.0</td>
<td>4.0</td>
<td>1.0</td>
<td>2.0</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>1.0</td>
<td>4.0</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>1.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>1.0</td>
<td>4.0</td>
</tr>
</tbody>
</table>

<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimizer</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam([W, H], lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the loss</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> torch.norm(torch.mm(W, H) <span class="op">-</span> A)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Zero the gradients</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Backpropagate</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the parameters</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the loss</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(loss.item())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>110.79912567138672
108.5261001586914
106.6722412109375
104.86959075927734
102.57525634765625
99.17333984375
94.17224884033203
87.41124725341797
79.23120880126953
70.51470184326172
62.338897705078125
55.442466735839844
50.24897003173828
46.78135681152344
44.567237854003906
43.125022888183594
42.18255615234375
41.56866455078125
41.16780471801758
40.899253845214844
40.70838928222656
40.56161117553711
40.439727783203125
40.33248519897461
40.23463821411133
40.143455505371094
40.05741500854492
39.9755744934082
39.89726638793945
39.82197952270508
39.749305725097656
39.678890228271484
39.610443115234375
39.54371643066406
39.478515625
39.4146842956543
39.35213088989258
39.290809631347656
39.23072052001953
39.17192077636719
39.114505767822266
39.058589935302734
39.00433349609375
38.95188903808594
38.90142059326172
38.85308837890625
38.8070182800293
38.76333999633789
38.722137451171875
38.6834716796875
38.64735412597656
38.61379623413086
38.5827522277832
38.554161071777344
38.527931213378906
38.503971099853516
38.482154846191406
38.46236038208008
38.444454193115234
38.42829132080078
38.41374588012695
38.40068435668945
38.38897705078125
38.378501892089844
38.36914825439453
38.36080551147461
38.35336685180664
38.34674835205078
38.34086608886719
38.33564376831055
38.330997467041016
38.326881408691406
38.3232307434082
38.31999206542969
38.31712341308594
38.314579010009766
38.31232833862305
38.310325622558594
38.308555603027344
38.30698013305664
38.30558776855469
38.30434799194336
38.30324935913086
38.30227279663086
38.301395416259766
38.300621032714844
38.2999267578125
38.29930114746094
38.29874801635742
38.298248291015625
38.29779815673828
38.297393798828125
38.297027587890625
38.29669189453125
38.29639434814453
38.296119689941406
38.295867919921875
38.29563903808594
38.29542922973633
38.29523468017578</code></pre>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(torch.mm(W, H).detach().numpy()).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3.622862</td>
<td>3.536414</td>
<td>3.945925</td>
<td>2.985436</td>
<td>2.999869</td>
<td>2.749094</td>
<td>2.605484</td>
<td>2.758482</td>
<td>2.209353</td>
<td>3.361388</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3.622746</td>
<td>3.547434</td>
<td>3.798462</td>
<td>3.133817</td>
<td>3.271342</td>
<td>3.176287</td>
<td>3.221505</td>
<td>3.073355</td>
<td>2.856927</td>
<td>3.383140</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(A).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
<td>1.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> factorize(A, k):</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Factorize the matrix A into W and H</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">    A: input matrix of size (n_users, n_movies)</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">    k: number of latent features</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns W and H</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">    W: matrix of size (n_users, k)</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co">    H: matrix of size (k, n_movies)</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Randomly initialize W and H</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    W <span class="op">=</span> torch.randn(A.shape[<span class="dv">0</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    H <span class="op">=</span> torch.randn(k, A.shape[<span class="dv">1</span>], requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optimizer</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optim.Adam([W, H], lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Train the model</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the loss</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> torch.norm(torch.mm(W, H) <span class="op">-</span> A)</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Zero the gradients</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Backpropagate</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update the parameters</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> W, H, loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>]:</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    W, H, loss <span class="op">=</span> factorize(A, k)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(k, loss.item())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1 42.103797912597656
2 38.35541534423828
3 34.45906448364258
4 30.72266387939453
5 27.430004119873047
6 23.318540573120117
9 9.963604927062988
10 0.16205351054668427
11 0.18895108997821808</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(torch.mm(W,H).detach().numpy()).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.014621</td>
<td>5.012642</td>
<td>4.012176</td>
<td>3.013239</td>
<td>4.012656</td>
<td>3.010292</td>
<td>1.012815</td>
<td>3.011410</td>
<td>3.015494</td>
<td>4.012996</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.987797</td>
<td>2.986945</td>
<td>3.989305</td>
<td>3.987498</td>
<td>3.988829</td>
<td>1.989375</td>
<td>4.989910</td>
<td>1.987138</td>
<td>1.986990</td>
<td>3.987026</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(A).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
<td>1.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># With missing values</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly replace some entries with NaN</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> torch.randint(<span class="dv">1</span>, <span class="dv">6</span>, (n_users, n_movies), dtype<span class="op">=</span>torch.<span class="bu">float</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>A[torch.rand(A.shape) <span class="op">&lt;</span> <span class="fl">0.5</span>] <span class="op">=</span> <span class="bu">float</span>(<span class="st">'nan'</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>tensor([[nan, 5., 5., nan, 1., 1., 4., 2., nan, 4.],
        [nan, 2., 2., 1., nan, nan, nan, nan, 3., nan],
        [nan, nan, 5., 1., nan, nan, 2., nan, nan, nan],
        [nan, nan, nan, 1., 4., 2., nan, 2., nan, 4.],
        [nan, nan, 2., nan, 3., 1., nan, nan, 4., 4.],
        [nan, 2., 5., nan, 2., nan, 1., nan, 3., nan],
        [nan, nan, nan, nan, 2., 1., nan, 3., nan, 5.],
        [nan, 4., nan, 1., 5., nan, 4., 5., 4., nan],
        [nan, nan, 2., 5., nan, nan, 5., nan, nan, 2.],
        [nan, nan, 3., 2., nan, 1., 1., 4., 5., nan],
        [nan, nan, 5., nan, nan, nan, 2., 2., nan, 3.],
        [nan, 5., 4., 2., nan, nan, nan, 1., 4., 3.],
        [nan, nan, 1., nan, 4., 4., nan, nan, 3., nan],
        [nan, 1., nan, nan, 3., nan, nan, nan, nan, 5.],
        [4., nan, 2., nan, nan, nan, nan, nan, 4., 3.],
        [4., nan, 3., nan, 3., nan, 4., 1., 1., nan],
        [5., nan, 3., nan, 3., nan, nan, 1., nan, nan],
        [2., 5., nan, 5., 3., 4., 3., 3., 5., 5.],
        [3., 3., nan, nan, nan, nan, nan, nan, 4., nan],
        [1., nan, 1., 3., 4., 1., nan, nan, 2., nan],
        [nan, nan, 5., nan, nan, nan, 2., nan, 1., nan],
        [3., 3., nan, nan, 2., 2., 3., 4., 4., nan],
        [2., nan, nan, 2., nan, nan, nan, nan, nan, 4.],
        [nan, 2., nan, 4., 5., 5., nan, 3., 5., nan],
        [2., 2., 2., 4., nan, 4., nan, 1., nan, nan],
        [5., 4., 5., 1., nan, 3., 5., 5., 1., 4.],
        [2., nan, nan, 2., nan, nan, nan, nan, nan, nan],
        [nan, 1., 5., nan, nan, nan, 2., 2., nan, nan],
        [2., 3., 4., nan, nan, nan, 1., 4., 4., nan],
        [2., nan, 1., 4., 1., 1., nan, 5., nan, 1.],
        [5., nan, 3., 1., 5., nan, nan, nan, 2., nan],
        [nan, 3., 4., nan, nan, 3., nan, 5., 5., nan],
        [4., 3., 2., 3., nan, nan, nan, nan, 1., nan],
        [1., 1., nan, 5., 1., 5., nan, nan, 5., nan],
        [4., 5., nan, nan, nan, 3., nan, 2., 5., 5.],
        [nan, 5., 5., nan, nan, nan, nan, 4., nan, nan],
        [5., nan, 4., 2., 3., 3., nan, nan, 2., 1.],
        [nan, nan, nan, nan, 5., nan, 2., 2., 4., nan],
        [3., 5., 1., 5., 3., nan, 5., nan, 2., 4.],
        [nan, 2., 4., nan, 1., 4., nan, 5., nan, 3.],
        [5., 5., 2., 5., nan, 4., nan, 2., nan, 3.],
        [5., nan, nan, 5., 1., 5., nan, nan, 3., 3.],
        [nan, 4., 2., 5., nan, 2., 3., nan, nan, 1.],
        [nan, nan, 4., 5., 5., nan, nan, 4., nan, 2.],
        [nan, nan, nan, nan, nan, nan, nan, 1., 3., nan],
        [3., 3., 1., 1., 1., 4., nan, nan, nan, 2.],
        [nan, nan, nan, 4., 5., nan, nan, 3., nan, nan],
        [5., nan, 5., 2., 4., nan, nan, nan, 5., nan],
        [nan, 1., 1., nan, 3., 1., nan, 1., nan, 1.],
        [nan, nan, 1., 2., nan, 3., nan, 2., 2., 4.],
        [nan, nan, 5., 1., 3., 2., 2., nan, 1., nan],
        [nan, 2., 2., nan, 4., nan, nan, nan, 3., nan],
        [nan, nan, nan, nan, 5., 4., nan, 3., nan, nan],
        [nan, 2., nan, nan, nan, nan, nan, 3., nan, nan],
        [nan, 2., 5., 2., nan, 3., 4., nan, 1., 2.],
        [1., nan, 1., nan, nan, 3., 4., 2., nan, 1.],
        [nan, 4., 4., 1., nan, nan, 5., nan, nan, 2.],
        [nan, nan, 3., nan, nan, 4., 1., nan, 3., nan],
        [nan, 1., nan, 3., 2., 3., nan, 2., nan, 4.],
        [2., 3., 3., nan, 1., 4., 3., nan, nan, 1.],
        [5., nan, 3., 1., 1., nan, 4., nan, 3., nan],
        [5., nan, nan, nan, nan, nan, 4., nan, nan, nan],
        [2., nan, nan, 2., nan, nan, 2., 3., nan, 4.],
        [3., nan, 4., 5., nan, nan, nan, 1., nan, 3.],
        [3., 3., 1., nan, 2., 5., 5., nan, 2., nan],
        [1., 1., 3., 1., nan, nan, 4., 3., 4., 5.],
        [4., nan, nan, 5., 2., nan, 1., nan, nan, nan],
        [nan, nan, 2., nan, 5., nan, 2., 1., nan, 4.],
        [nan, 5., nan, 4., 3., 2., 2., 1., nan, 4.],
        [nan, nan, 1., nan, nan, nan, 2., nan, nan, nan],
        [1., nan, nan, 4., 5., 3., nan, 2., nan, nan],
        [2., nan, 5., 1., 3., nan, 5., nan, nan, nan],
        [3., 5., nan, nan, nan, 5., 2., nan, nan, 2.],
        [nan, 2., 5., nan, nan, nan, 2., nan, 1., 2.],
        [nan, 3., 2., nan, nan, 4., nan, 2., nan, 5.],
        [nan, 4., 5., 2., 5., nan, nan, nan, nan, 5.],
        [3., 1., 5., 3., nan, nan, nan, 3., nan, 4.],
        [nan, 5., nan, 5., nan, 5., 1., 1., 3., 1.],
        [2., nan, nan, nan, 5., nan, nan, 4., nan, 4.],
        [nan, 3., 4., 2., nan, 2., nan, 2., nan, nan],
        [nan, 5., nan, 2., 2., 4., 5., 5., nan, nan],
        [nan, nan, nan, nan, nan, 5., nan, nan, 5., 4.],
        [nan, nan, nan, nan, nan, 2., 2., 2., 2., 4.],
        [nan, nan, nan, 2., 5., 3., 3., nan, nan, nan],
        [1., 2., 4., 2., nan, 2., 5., 4., nan, 5.],
        [4., nan, nan, 5., 4., nan, 5., 1., 3., nan],
        [4., nan, 1., 4., nan, nan, 2., nan, 4., 3.],
        [4., 2., 1., 3., nan, nan, 1., nan, nan, 1.],
        [nan, 1., 3., 1., 2., nan, 3., nan, 5., nan],
        [nan, 1., 1., nan, 1., 1., nan, 4., nan, nan],
        [nan, nan, nan, nan, 1., 5., nan, 5., 3., nan],
        [3., 4., nan, 4., 3., nan, 2., 1., nan, nan],
        [1., 1., nan, 2., nan, nan, nan, 2., 4., 1.],
        [nan, 4., 2., nan, 3., nan, 2., 1., nan, 2.],
        [2., nan, 5., nan, 3., nan, 5., 1., nan, nan],
        [3., 3., nan, nan, 3., 3., nan, 4., 2., nan],
        [2., nan, 5., nan, 5., 3., nan, nan, 5., nan],
        [nan, nan, nan, nan, 5., nan, nan, nan, nan, 5.],
        [4., nan, nan, 1., 4., 5., 1., nan, 2., 4.],
        [1., nan, nan, nan, 2., nan, 4., nan, nan, nan]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>W, H, loss <span class="op">=</span> factorize(A, <span class="dv">2</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>tensor(nan, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<p>As expected, the above function does not work. Our current loss function does not handle missing values.</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> <span class="op">~</span>torch.isnan(A)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>mask</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>tensor([[False,  True,  True, False,  True,  True,  True,  True, False,  True],
        [False,  True,  True,  True, False, False, False, False,  True, False],
        [False, False,  True,  True, False, False,  True, False, False, False],
        [False, False, False,  True,  True,  True, False,  True, False,  True],
        [False, False,  True, False,  True,  True, False, False,  True,  True],
        [False,  True,  True, False,  True, False,  True, False,  True, False],
        [False, False, False, False,  True,  True, False,  True, False,  True],
        [False,  True, False,  True,  True, False,  True,  True,  True, False],
        [False, False,  True,  True, False, False,  True, False, False,  True],
        [False, False,  True,  True, False,  True,  True,  True,  True, False],
        [False, False,  True, False, False, False,  True,  True, False,  True],
        [False,  True,  True,  True, False, False, False,  True,  True,  True],
        [False, False,  True, False,  True,  True, False, False,  True, False],
        [False,  True, False, False,  True, False, False, False, False,  True],
        [ True, False,  True, False, False, False, False, False,  True,  True],
        [ True, False,  True, False,  True, False,  True,  True,  True, False],
        [ True, False,  True, False,  True, False, False,  True, False, False],
        [ True,  True, False,  True,  True,  True,  True,  True,  True,  True],
        [ True,  True, False, False, False, False, False, False,  True, False],
        [ True, False,  True,  True,  True,  True, False, False,  True, False],
        [False, False,  True, False, False, False,  True, False,  True, False],
        [ True,  True, False, False,  True,  True,  True,  True,  True, False],
        [ True, False, False,  True, False, False, False, False, False,  True],
        [False,  True, False,  True,  True,  True, False,  True,  True, False],
        [ True,  True,  True,  True, False,  True, False,  True, False, False],
        [ True,  True,  True,  True, False,  True,  True,  True,  True,  True],
        [ True, False, False,  True, False, False, False, False, False, False],
        [False,  True,  True, False, False, False,  True,  True, False, False],
        [ True,  True,  True, False, False, False,  True,  True,  True, False],
        [ True, False,  True,  True,  True,  True, False,  True, False,  True],
        [ True, False,  True,  True,  True, False, False, False,  True, False],
        [False,  True,  True, False, False,  True, False,  True,  True, False],
        [ True,  True,  True,  True, False, False, False, False,  True, False],
        [ True,  True, False,  True,  True,  True, False, False,  True, False],
        [ True,  True, False, False, False,  True, False,  True,  True,  True],
        [False,  True,  True, False, False, False, False,  True, False, False],
        [ True, False,  True,  True,  True,  True, False, False,  True,  True],
        [False, False, False, False,  True, False,  True,  True,  True, False],
        [ True,  True,  True,  True,  True, False,  True, False,  True,  True],
        [False,  True,  True, False,  True,  True, False,  True, False,  True],
        [ True,  True,  True,  True, False,  True, False,  True, False,  True],
        [ True, False, False,  True,  True,  True, False, False,  True,  True],
        [False,  True,  True,  True, False,  True,  True, False, False,  True],
        [False, False,  True,  True,  True, False, False,  True, False,  True],
        [False, False, False, False, False, False, False,  True,  True, False],
        [ True,  True,  True,  True,  True,  True, False, False, False,  True],
        [False, False, False,  True,  True, False, False,  True, False, False],
        [ True, False,  True,  True,  True, False, False, False,  True, False],
        [False,  True,  True, False,  True,  True, False,  True, False,  True],
        [False, False,  True,  True, False,  True, False,  True,  True,  True],
        [False, False,  True,  True,  True,  True,  True, False,  True, False],
        [False,  True,  True, False,  True, False, False, False,  True, False],
        [False, False, False, False,  True,  True, False,  True, False, False],
        [False,  True, False, False, False, False, False,  True, False, False],
        [False,  True,  True,  True, False,  True,  True, False,  True,  True],
        [ True, False,  True, False, False,  True,  True,  True, False,  True],
        [False,  True,  True,  True, False, False,  True, False, False,  True],
        [False, False,  True, False, False,  True,  True, False,  True, False],
        [False,  True, False,  True,  True,  True, False,  True, False,  True],
        [ True,  True,  True, False,  True,  True,  True, False, False,  True],
        [ True, False,  True,  True,  True, False,  True, False,  True, False],
        [ True, False, False, False, False, False,  True, False, False, False],
        [ True, False, False,  True, False, False,  True,  True, False,  True],
        [ True, False,  True,  True, False, False, False,  True, False,  True],
        [ True,  True,  True, False,  True,  True,  True, False,  True, False],
        [ True,  True,  True,  True, False, False,  True,  True,  True,  True],
        [ True, False, False,  True,  True, False,  True, False, False, False],
        [False, False,  True, False,  True, False,  True,  True, False,  True],
        [False,  True, False,  True,  True,  True,  True,  True, False,  True],
        [False, False,  True, False, False, False,  True, False, False, False],
        [ True, False, False,  True,  True,  True, False,  True, False, False],
        [ True, False,  True,  True,  True, False,  True, False, False, False],
        [ True,  True, False, False, False,  True,  True, False, False,  True],
        [False,  True,  True, False, False, False,  True, False,  True,  True],
        [False,  True,  True, False, False,  True, False,  True, False,  True],
        [False,  True,  True,  True,  True, False, False, False, False,  True],
        [ True,  True,  True,  True, False, False, False,  True, False,  True],
        [False,  True, False,  True, False,  True,  True,  True,  True,  True],
        [ True, False, False, False,  True, False, False,  True, False,  True],
        [False,  True,  True,  True, False,  True, False,  True, False, False],
        [False,  True, False,  True,  True,  True,  True,  True, False, False],
        [False, False, False, False, False,  True, False, False,  True,  True],
        [False, False, False, False, False,  True,  True,  True,  True,  True],
        [False, False, False,  True,  True,  True,  True, False, False, False],
        [ True,  True,  True,  True, False,  True,  True,  True, False,  True],
        [ True, False, False,  True,  True, False,  True,  True,  True, False],
        [ True, False,  True,  True, False, False,  True, False,  True,  True],
        [ True,  True,  True,  True, False, False,  True, False, False,  True],
        [False,  True,  True,  True,  True, False,  True, False,  True, False],
        [False,  True,  True, False,  True,  True, False,  True, False, False],
        [False, False, False, False,  True,  True, False,  True,  True, False],
        [ True,  True, False,  True,  True, False,  True,  True, False, False],
        [ True,  True, False,  True, False, False, False,  True,  True,  True],
        [False,  True,  True, False,  True, False,  True,  True, False,  True],
        [ True, False,  True, False,  True, False,  True,  True, False, False],
        [ True,  True, False, False,  True,  True, False,  True,  True, False],
        [ True, False,  True, False,  True,  True, False, False,  True, False],
        [False, False, False, False,  True, False, False, False, False,  True],
        [ True, False, False,  True,  True,  True,  True, False,  True,  True],
        [ True, False, False, False,  True, False,  True, False, False, False]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>mask.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>tensor(517)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>W <span class="op">=</span> torch.randn(A.shape[<span class="dv">0</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> torch.randn(k, A.shape[<span class="dv">1</span>],  requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>diff_matrix <span class="op">=</span> torch.mm(W, H)<span class="op">-</span>A</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>diff_matrix.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>torch.Size([100, 10])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mask the matrix</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>diff_matrix[mask].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>torch.Size([517])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify the loss function to ignore NaN values</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> factorize(A, k):</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Factorize the matrix D into A and B"""</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Randomly initialize A and B</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    W <span class="op">=</span> torch.randn(A.shape[<span class="dv">0</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    H <span class="op">=</span> torch.randn(k, A.shape[<span class="dv">1</span>], requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optimizer</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optim.Adam([W, H], lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Train the model</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the loss</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>        diff_matrix <span class="op">=</span> torch.mm(W, H) <span class="op">-</span> A</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>        diff_vector <span class="op">=</span> diff_matrix[mask]</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> torch.norm(diff_vector)</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Zero the gradients</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Backpropagate</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update the parameters</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> W, H, loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>W, H, loss <span class="op">=</span> factorize(A, <span class="dv">5</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>tensor(7.1147, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>torch.mm(W, H)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>tensor([[-3.7026e+00,  5.1163e+00,  4.9660e+00, -5.8455e-01,  1.0200e+00,
          9.1470e-01,  3.8727e+00,  2.2007e+00,  1.3782e+01,  3.9267e+00],
        [ 6.4588e-02,  2.0002e+00,  1.9979e+00,  1.0001e+00,  3.6942e+00,
          1.1512e+00,  3.8181e+00,  3.5421e+00,  3.0014e+00,  5.0035e+00],
        [-3.3540e-01, -1.0050e+00,  5.0000e+00,  1.0010e+00,  1.7959e-01,
          8.6454e-01,  1.9994e+00,  2.9560e+00,  1.0767e+01, -3.4057e-01],
        [ 2.6321e+00,  3.5523e+00,  2.1706e+00,  9.9769e-01,  3.9995e+00,
          2.0030e+00,  2.8652e+00,  2.0006e+00,  3.5503e-02,  3.9991e+00],
        [ 5.3195e-02, -1.3399e+00,  1.9455e+00,  2.2700e+00,  3.0539e+00,
          1.0086e+00,  3.8842e+00,  5.1128e+00,  4.0248e+00,  3.9763e+00],
        [ 5.5045e+00,  2.0044e+00,  4.9388e+00,  1.6216e+00,  2.0865e+00,
          2.8957e+00,  9.2770e-01,  8.8714e-01,  3.0420e+00, -9.2438e-01],
        [ 6.1366e-01, -1.3394e+00, -6.3292e+00,  4.0202e+00,  2.0028e+00,
          1.0014e+00,  2.1030e+00,  3.0001e+00, -1.0639e+01,  4.9979e+00],
        [ 1.6036e+00,  3.6518e+00,  3.7664e+00,  1.2319e+00,  5.1780e+00,
          2.1295e+00,  4.7475e+00,  4.0635e+00,  4.0645e+00,  5.9223e+00],
        [-4.1593e+00, -1.1450e+01,  2.0064e+00,  5.0104e+00,  1.7877e-01,
         -6.8356e-01,  4.9576e+00,  1.0525e+01,  1.2403e+01,  2.0250e+00],
        [ 1.7769e+00, -4.9137e+00,  3.1228e+00,  2.2575e+00,  5.8793e-01,
          6.6961e-01,  1.2031e+00,  3.7871e+00,  4.9702e+00, -1.4083e+00],
        [ 9.1273e+00,  1.4212e+00,  5.0018e+00, -1.0804e+00,  8.9608e+00,
          1.6892e+00,  2.0130e+00,  1.9936e+00, -7.2410e+00,  2.9931e+00],
        [ 3.2326e+00,  5.2245e+00,  3.8534e+00,  1.8050e+00,  2.7570e+00,
          3.2246e+00,  2.7488e+00,  1.4501e+00,  3.9743e+00,  2.7026e+00],
        [ 9.2220e-01,  6.5451e+00,  9.9373e-01,  4.2199e+00,  4.0030e+00,
          4.0019e+00,  5.8552e+00,  4.3514e+00,  3.0028e+00,  8.0414e+00],
        [-2.3552e+00,  1.0013e+00,  9.6726e-01, -4.6631e-01,  3.0005e+00,
         -4.1134e-01,  3.3274e+00,  3.0678e+00,  3.0946e+00,  4.9978e+00],
        [ 4.0009e+00,  5.9036e+00,  1.9983e+00,  6.0610e+00,  1.0184e+00,
          5.6167e+00,  3.5338e+00,  2.5504e+00,  4.0003e+00,  3.0002e+00],
        [ 4.1839e+00,  9.1531e+00,  2.5008e+00,  3.1248e+00,  3.4309e+00,
          4.8701e+00,  3.6236e+00,  9.7109e-01,  1.3077e+00,  4.9725e+00],
        [ 5.0034e+00, -2.6358e+00,  2.9996e+00, -3.1773e-01,  2.9981e+00,
          3.3085e-01, -3.0125e-01,  1.0002e+00, -2.6015e+00, -1.5107e+00],
        [ 2.1562e+00,  5.1078e+00,  2.3091e+00,  4.3035e+00,  2.3000e+00,
          4.1470e+00,  4.2497e+00,  3.3351e+00,  4.7425e+00,  4.5406e+00],
        [ 2.9999e+00,  2.9999e+00,  3.0624e+00,  4.4992e+00,  4.5262e+00,
          3.8824e+00,  5.4591e+00,  5.5541e+00,  4.0005e+00,  5.9015e+00],
        [ 8.1177e-01, -2.9699e+00,  1.2606e+00,  3.0946e+00,  3.9370e+00,
          1.0488e+00,  4.3280e+00,  6.3317e+00,  1.8619e+00,  4.5940e+00],
        [ 2.1477e+00,  2.4168e+00,  5.0014e+00, -3.6888e+00,  5.9741e+00,
         -5.6343e-01,  1.9977e+00,  9.9599e-01,  1.0008e+00,  3.2156e+00],
        [ 2.5660e+00,  2.4872e+00,  2.9711e+00,  3.0048e+00,  2.5035e+00,
          2.9551e+00,  3.2466e+00,  3.1642e+00,  4.0380e+00,  2.8930e+00],
        [ 2.0003e+00,  1.1864e+01, -1.4367e+00,  1.9999e+00,  4.6078e-01,
          4.1701e+00,  1.3254e+00, -3.0082e+00, -2.7641e+00,  3.9993e+00],
        [ 1.0449e+01,  2.0032e+00,  8.9659e+00,  3.6977e+00,  4.8085e+00,
          5.2882e+00,  2.4920e+00,  3.2403e+00,  4.9395e+00, -8.7002e-01],
        [ 2.0717e+00,  2.1115e+00,  2.0717e+00,  4.2801e+00, -2.0380e+00,
          3.5172e+00,  9.3884e-01,  9.7155e-01,  6.2354e+00, -1.3328e+00],
        [ 5.2955e+00,  3.4266e+00,  5.1299e+00,  1.4202e+00,  6.8671e+00,
          2.9375e+00,  4.3992e+00,  3.9995e+00,  1.2817e+00,  5.0996e+00],
        [ 2.0001e+00,  1.4791e+00,  2.3388e+00,  2.0000e+00, -6.6995e-01,
          2.1166e+00,  4.5259e-01,  3.8568e-01,  4.1443e+00, -1.1447e+00],
        [ 2.9065e+00,  1.0088e+00,  5.0003e+00, -4.4267e-01,  3.6696e+00,
          1.0351e+00,  1.9735e+00,  2.0205e+00,  3.8361e+00,  1.3199e+00],
        [ 2.3390e+00,  2.3721e+00,  3.7185e+00,  1.3874e+00,  2.8777e+00,
          2.1103e+00,  2.7381e+00,  2.4701e+00,  4.1805e+00,  2.4318e+00],
        [ 1.7971e+00, -4.8495e+00,  9.1239e-01,  3.9631e+00,  1.2733e+00,
          1.2781e+00,  2.2735e+00,  5.0206e+00,  1.8186e+00,  7.7334e-01],
        [ 4.4556e+00,  1.2257e+01,  3.8113e+00,  1.3722e+00,  4.8218e+00,
          4.8774e+00,  3.8956e+00, -1.3451e-01,  1.5725e+00,  6.1126e+00],
        [ 2.3871e+00,  3.0010e+00,  3.9991e+00,  2.8334e+00,  4.8395e+00,
          2.9996e+00,  5.1329e+00,  5.0009e+00,  5.0012e+00,  5.6052e+00],
        [ 3.9920e+00,  3.0004e+00,  2.0131e+00,  3.0049e+00,  1.3189e+00,
          3.2595e+00,  1.5054e+00,  1.0929e+00,  9.9195e-01,  8.6129e-01],
        [ 1.3517e+00,  1.3225e+00,  1.2075e+00,  5.6267e+00,  9.9029e-01,
          3.6713e+00,  4.0205e+00,  4.6894e+00,  5.0908e+00,  3.3918e+00],
        [ 3.9141e+00,  5.4294e+00,  6.3565e+00,  3.9410e-02,  5.9122e+00,
          2.6582e+00,  4.0295e+00,  2.6446e+00,  4.8764e+00,  4.5279e+00],
        [ 5.9703e+00,  5.0000e+00,  5.0006e+00,  5.4552e+00,  3.4764e+00,
          5.7107e+00,  4.4197e+00,  3.9984e+00,  5.4614e+00,  3.3112e+00],
        [ 4.9808e+00,  2.5274e+00,  4.0592e+00,  2.0167e+00,  2.9650e+00,
          2.9926e+00,  1.9145e+00,  1.7219e+00,  1.9706e+00,  1.0164e+00],
        [ 3.3675e+00,  7.9931e-01,  6.4143e+00, -1.9437e+00,  5.0061e+00,
          3.9840e-01,  1.9918e+00,  2.0016e+00,  4.0036e+00,  1.4088e+00],
        [ 3.1524e+00,  4.8411e+00,  1.3102e+00,  5.0749e+00,  2.6352e+00,
          4.5228e+00,  4.2075e+00,  3.4787e+00,  2.0158e+00,  4.7858e+00],
        [ 1.1647e+00,  2.0442e+00,  3.9774e+00,  5.2040e+00,  1.0064e+00,
          3.9541e+00,  4.5550e+00,  5.0695e+00,  1.0370e+01,  2.9545e+00],
        [ 4.9155e+00,  4.8887e+00,  1.8611e+00,  4.5726e+00,  2.4214e+00,
          4.6615e+00,  2.9405e+00,  2.1223e+00,  4.9785e-01,  2.9426e+00],
        [ 4.6095e+00,  7.0277e+00,  2.3640e+00,  4.9826e+00,  1.3639e+00,
          5.4668e+00,  2.9430e+00,  1.3600e+00,  2.9275e+00,  2.6572e+00],
        [-9.4300e+00,  3.9400e+00,  1.8115e+00,  4.6790e+00, -7.7135e+00,
          2.3401e+00,  3.3902e+00,  2.5588e+00,  2.3759e+01,  7.8572e-01],
        [ 8.8489e+00,  1.3677e+00,  4.0011e+00,  4.9984e+00,  5.0002e+00,
          4.8811e+00,  3.1127e+00,  4.0020e+00, -1.6249e+00,  1.9996e+00],
        [-5.3638e+00, -1.6611e+01, -1.2622e+00, -2.9465e+00, -5.3122e+00,
         -6.6081e+00, -4.5960e+00,  1.0021e+00,  3.0004e+00, -8.7048e+00],
        [ 2.9505e+00,  3.4944e+00,  1.0966e+00,  2.0104e+00,  1.4645e+00,
          2.5452e+00,  1.3437e+00,  4.9608e-01, -3.2980e-01,  1.5523e+00],
        [ 8.8610e+00,  3.4098e+00,  5.4534e+00,  4.0010e+00,  5.0039e+00,
          5.0527e+00,  2.9819e+00,  2.9969e+00,  4.8445e-01,  1.7580e+00],
        [ 4.7645e+00,  7.2438e+00,  5.3527e+00,  2.1598e+00,  3.9257e+00,
          4.3363e+00,  3.5150e+00,  1.6544e+00,  4.8212e+00,  3.4858e+00],
        [ 3.6301e+00,  8.2968e-01,  1.0952e+00,  5.1852e-01,  2.9273e+00,
          1.1501e+00,  7.9266e-01,  7.6517e-01, -3.4503e+00,  1.2149e+00],
        [ 1.2349e+00,  4.7494e+00,  1.1553e+00,  2.2902e+00,  2.1858e+00,
          2.6806e+00,  3.0526e+00,  1.8136e+00,  1.9800e+00,  4.0943e+00],
        [ 5.4207e+00,  4.6174e-01,  4.6315e+00,  1.0934e+00,  3.5323e+00,
          2.1171e+00,  1.4216e+00,  1.9254e+00,  1.2497e+00,  1.5768e-01],
        [ 8.0981e-01,  1.9982e+00,  1.9823e+00,  2.3342e+00,  4.0156e+00,
          1.9755e+00,  4.5111e+00,  4.4963e+00,  3.0107e+00,  5.5846e+00],
        [ 3.4230e+00,  6.7811e+00,  1.3001e+00,  3.2712e+00,  5.0004e+00,
          4.0008e+00,  4.7148e+00,  2.9985e+00, -8.9564e-01,  6.9733e+00],
        [ 4.3992e+00,  1.9999e+00,  1.7722e+00,  3.3742e+00,  3.4675e+00,
          3.1595e+00,  2.8761e+00,  3.0001e+00, -8.2256e-01,  3.0558e+00],
        [ 6.3852e+00,  1.8676e+00,  5.1417e+00,  2.1083e+00,  5.4183e+00,
          3.1672e+00,  3.1282e+00,  3.3945e+00,  1.0754e+00,  2.5551e+00],
        [ 8.1366e-01,  2.6100e+00,  1.2431e+00,  4.6053e+00, -7.3305e-01,
          3.4299e+00,  2.5706e+00,  2.4739e+00,  5.9303e+00,  1.5624e+00],
        [-1.5185e+01,  3.9601e+00,  4.1178e+00,  1.1159e+00, -7.8194e+00,
         -2.6153e-01,  4.5528e+00,  3.2349e+00,  3.2557e+01,  2.2662e+00],
        [ 4.1539e+00,  6.2482e+00,  3.0004e+00,  2.5108e+00,  4.1870e-01,
          4.0017e+00,  9.9885e-01, -7.3851e-01,  2.9998e+00,  1.7461e-01],
        [ 2.4292e+00,  1.3324e+00, -2.4186e+00,  3.4744e+00,  2.2288e+00,
          2.2009e+00,  2.0940e+00,  2.1399e+00, -5.7555e+00,  3.6885e+00],
        [ 2.2950e+00,  2.9436e+00,  3.1712e+00,  4.1268e+00,  5.4157e-01,
          3.7216e+00,  2.8408e+00,  2.7181e+00,  6.7460e+00,  1.4747e+00],
        [ 5.0664e+00,  4.5652e+01,  2.7328e+00,  1.0374e+00,  1.2891e+00,
          1.3143e+01,  3.7184e+00, -1.3608e+01,  3.1697e+00,  1.1363e+01],
        [ 5.0006e+00,  6.9239e+00,  9.1918e-01,  7.2628e+00,  1.5445e+00,
          6.5242e+00,  4.0004e+00,  2.7856e+00,  1.5080e+00,  4.0918e+00],
        [ 2.0015e+00, -1.7211e+00, -2.6718e+00,  1.9970e+00,  3.6355e+00,
          4.8944e-01,  2.0002e+00,  3.0038e+00, -7.9397e+00,  3.9988e+00],
        [ 2.9915e+00,  1.0068e+01,  4.0126e+00,  5.0140e+00,  2.1576e-01,
          6.2162e+00,  3.6692e+00,  9.8564e-01,  9.0477e+00,  2.9998e+00],
        [ 3.1704e+00,  3.0173e+00,  6.3333e-01,  6.8363e+00,  2.2725e+00,
          4.9317e+00,  4.7652e+00,  5.0099e+00,  2.2206e+00,  4.9007e+00],
        [ 7.5330e-01,  1.4262e+00,  3.0599e+00,  8.5747e-01,  4.0712e+00,
          1.1776e+00,  3.8169e+00,  3.8298e+00,  3.8094e+00,  4.5052e+00],
        [ 4.0428e+00, -2.0650e+01,  2.4385e+00,  4.9425e+00,  1.9279e+00,
         -1.5739e+00,  1.0876e+00,  1.0297e+01,  9.8782e-01, -4.4288e+00],
        [ 1.0773e+00,  2.2150e+00,  2.0096e+00, -2.4710e+00,  4.9950e+00,
         -5.0779e-01,  1.9650e+00,  1.0100e+00, -1.8899e+00,  4.0205e+00],
        [ 3.4996e+00,  4.5594e+00, -2.5208e+00,  3.3402e+00,  2.6908e+00,
          3.0928e+00,  2.0393e+00,  8.1359e-01, -7.3751e+00,  4.3822e+00],
        [-4.8442e+00,  3.4518e+00,  9.9972e-01, -1.2881e+00, -3.5755e-01,
         -5.3701e-01,  1.9997e+00,  4.9337e-01,  7.5069e+00,  3.0513e+00],
        [ 1.0026e+00,  7.6105e+00, -7.1104e+00,  3.9509e+00,  4.9733e+00,
          3.0444e+00,  4.5575e+00,  2.0356e+00, -1.3359e+01,  1.0958e+01],
        [ 1.9708e+00,  2.2459e+01,  5.0115e+00,  1.0357e+00,  3.0386e+00,
          7.0322e+00,  4.9501e+00, -3.0939e+00,  8.5776e+00,  8.3022e+00],
        [ 3.0000e+00,  5.0024e+00, -1.4123e+00,  6.3346e+00, -9.3349e-01,
          4.9944e+00,  2.0182e+00,  1.1012e+00, -1.8768e-01,  1.9884e+00],
        [ 4.4226e+00,  2.0069e+00,  5.0098e+00, -8.1680e-01,  5.0611e+00,
          1.2995e+00,  1.9966e+00,  1.6425e+00,  9.9608e-01,  1.9906e+00],
        [ 1.1858e+01,  3.1806e+00,  1.9399e+00,  2.0242e+00,  9.7272e+00,
          3.8295e+00,  2.5867e+00,  2.2628e+00, -1.4185e+01,  4.8150e+00],
        [ 3.0139e+00,  4.0015e+00,  4.9996e+00,  2.0000e+00,  5.0004e+00,
          3.0423e+00,  4.6969e+00,  4.0977e+00,  5.4217e+00,  4.9981e+00],
        [ 3.1070e+00,  1.5608e+00,  4.4961e+00,  2.4194e+00,  3.9092e+00,
          2.6510e+00,  3.8237e+00,  4.1656e+00,  5.0091e+00,  3.2677e+00],
        [ 3.6123e+00,  5.0130e+00,  1.2513e+00,  5.0780e+00, -6.2890e-01,
          4.7738e+00,  1.7050e+00,  7.5555e-01,  2.9369e+00,  7.0034e-01],
        [ 1.9988e+00, -1.0755e+00,  2.1010e+00,  4.8154e-01,  5.0034e+00,
          4.1238e-01,  3.1198e+00,  4.0017e+00, -6.4504e-01,  3.9979e+00],
        [-2.4511e+00,  3.0049e+00,  4.0049e+00,  2.0168e+00, -1.7567e+00,
          1.9773e+00,  2.5612e+00,  1.9963e+00,  1.3746e+01,  7.7954e-01],
        [ 1.2900e+00,  4.8906e+00,  1.2285e+01,  2.0178e+00,  2.0017e+00,
          4.0381e+00,  5.2765e+00,  4.7427e+00,  2.3263e+01,  1.4459e+00],
        [ 3.4409e+00,  1.6323e+00,  2.1447e+00,  7.1434e+00,  2.1349e+00,
          4.9995e+00,  4.9455e+00,  5.8905e+00,  5.0000e+00,  4.0006e+00],
        [-8.3402e+00,  1.6671e+00, -9.7906e+00,  7.5550e+00, -7.1860e+00,
          1.9594e+00,  2.1880e+00,  1.9448e+00,  1.9841e+00,  3.9175e+00],
        [ 6.1855e+00,  1.0277e+00,  6.0344e+00,  2.0010e+00,  5.0009e+00,
          2.9985e+00,  3.0008e+00,  3.6213e+00,  3.0914e+00,  1.7165e+00],
        [ 9.9264e-01,  2.2125e+00,  3.9075e+00,  1.8425e+00,  4.0571e+00,
          2.0497e+00,  4.5854e+00,  4.5379e+00,  6.0676e+00,  4.9087e+00],
        [ 4.1464e+00,  1.4062e+01,  2.4284e+00,  4.7693e+00,  3.6919e+00,
          6.9404e+00,  5.3224e+00,  1.0755e+00,  2.9501e+00,  7.6420e+00],
        [ 3.7800e+00,  1.9199e+01,  1.3223e+00,  4.2259e+00, -1.6001e+00,
          7.9395e+00,  1.7065e+00, -4.9606e+00,  3.8810e+00,  3.1246e+00],
        [ 4.0234e+00,  2.0156e+00,  9.3090e-01,  2.9352e+00,  1.4458e+00,
          2.8364e+00,  1.1944e+00,  1.0778e+00, -1.3489e+00,  8.8513e-01],
        [ 2.9993e-01,  1.0106e+00,  2.8743e+00,  1.0596e+00,  2.1897e+00,
          1.1528e+00,  2.7986e+00,  2.9140e+00,  5.0939e+00,  2.6367e+00],
        [-2.7522e+00,  1.0011e+00,  9.9939e-01,  2.1638e+00,  9.9803e-01,
          9.9864e-01,  3.8559e+00,  4.0029e+00,  6.9205e+00,  4.3317e+00],
        [ 4.8687e+00, -1.5672e-01,  1.6703e+00,  7.5356e+00,  9.9502e-01,
          4.9990e+00,  3.3880e+00,  5.0098e+00,  2.9938e+00,  1.4576e+00],
        [ 3.0192e+00,  3.9819e+00, -5.9198e+00,  3.9832e+00,  2.9753e+00,
          2.7502e+00,  2.0750e+00,  9.5908e-01, -1.2959e+01,  5.9251e+00],
        [ 1.0148e+00,  9.7130e-01,  1.9768e+00,  2.0122e+00,  6.6718e-01,
          1.7201e+00,  1.7755e+00,  1.9466e+00,  4.0138e+00,  1.0400e+00],
        [ 5.3930e+00,  4.0298e+00,  2.0109e+00,  2.7548e+00,  2.9962e+00,
          3.5641e+00,  1.8677e+00,  1.0778e+00, -1.7539e+00,  2.0255e+00],
        [ 1.9953e+00,  1.2843e+01,  5.0056e+00,  2.5516e+00,  2.9983e+00,
          5.4422e+00,  5.0090e+00,  9.8768e-01,  8.9960e+00,  6.2394e+00],
        [ 2.8324e+00,  2.8434e+00,  1.9018e+00,  3.8000e+00,  3.1922e+00,
          3.3458e+00,  3.8883e+00,  3.7678e+00,  2.0126e+00,  4.2686e+00],
        [ 2.0652e+00,  8.7485e+00,  4.9003e+00, -7.1472e-02,  5.0456e+00,
          2.9448e+00,  4.2957e+00,  1.4602e+00,  5.0622e+00,  6.0046e+00],
        [ 1.2368e+00, -8.0124e-01,  4.5406e-01,  5.8132e-01,  5.0025e+00,
          1.8401e-01,  3.2316e+00,  3.9075e+00, -2.7376e+00,  4.9980e+00],
        [ 4.4707e+00,  1.3100e+01,  3.8913e+00,  5.0670e-01,  3.1494e+00,
          4.7096e+00,  2.2617e+00, -2.3287e+00,  1.8589e+00,  3.9039e+00],
        [ 9.9929e-01,  1.5253e+01,  2.1834e-03,  2.6820e+00,  2.0005e+00,
          5.3245e+00,  3.9995e+00, -1.3442e+00,  1.4326e+00,  7.5636e+00]],
       grad_fn=&lt;MmBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now use matrix factorization to predict the ratings</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a class for the model</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MatrixFactorization(nn.Module):</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n_users, n_movies, n_factors<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.user_factors <span class="op">=</span> nn.Embedding(n_users, n_factors)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.movie_factors <span class="op">=</span> nn.Embedding(n_movies, n_factors)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, user, movie):</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="va">self</span>.user_factors(user) <span class="op">*</span> <span class="va">self</span>.movie_factors(movie)).<span class="bu">sum</span>(<span class="dv">1</span>)      </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> MatrixFactorization(n_users, n_movies, <span class="dv">2</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>MatrixFactorization(
  (user_factors): Embedding(100, 2)
  (movie_factors): Embedding(10, 2)
)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>model(torch.tensor([<span class="dv">0</span>]), torch.tensor([<span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>tensor([-0.0271], grad_fn=&lt;SumBackward1&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>A[<span class="dv">0</span>, <span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>tensor(5.)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(A)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>torch.Tensor</code></pre>
</div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> <span class="op">~</span>torch.isnan(A)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the indices of the non-NaN values</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>i, j <span class="op">=</span> torch.where(mask)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the values of the non-NaN values</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>v <span class="op">=</span> A[mask]</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Store in PyTorch tensors</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>users <span class="op">=</span> i.to(torch.int64)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>movies <span class="op">=</span> j.to(torch.int64)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>ratings <span class="op">=</span> v.to(torch.float32)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">'user'</span>: users, <span class="st">'movie'</span>: movies, <span class="st">'rating'</span>: ratings})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">user</th>
<th data-quarto-table-cell-role="th">movie</th>
<th data-quarto-table-cell-role="th">rating</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>1</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>2</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>4</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>5</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>6</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">512</td>
<td>98</td>
<td>8</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">513</td>
<td>98</td>
<td>9</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">514</td>
<td>99</td>
<td>0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">515</td>
<td>99</td>
<td>4</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">516</td>
<td>99</td>
<td>6</td>
<td>4.0</td>
</tr>
</tbody>
</table>

<p>517 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the Matrix Factorization model</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> MatrixFactorization(n_users, n_movies, <span class="dv">4</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the loss</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    pred <span class="op">=</span> model(users, movies)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> F.mse_loss(pred, ratings)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Zero the gradients</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Backpropagate</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the parameters</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the loss</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(loss.item())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>14.604362487792969
4.332712650299072
1.0960761308670044
0.6966323852539062
0.5388827919960022
0.45243579149246216
0.4012693464756012
0.3728969395160675
0.35568001866340637
0.34289655089378357</code></pre>
</div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>model(users, movies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>tensor([3.5693, 4.5338, 2.6934, 1.8316, 4.8915, 2.0194, 2.7778, 1.8601, 2.1124,
        1.1378, 2.9079, 5.0470, 0.9911, 1.9791, 1.0050, 3.9618, 2.0085, 2.0034,
        4.0113, 1.9218, 2.9801, 1.0432, 3.8993, 4.1292, 1.9357, 3.8285, 3.5266,
        1.3640, 2.3989, 2.4166, 0.8559, 3.3685, 4.4493, 3.4018, 1.4722, 4.8378,
        4.6684, 4.4473, 4.3097, 2.0022, 5.0147, 5.0113, 1.9599, 2.8305, 1.4493,
        1.6750, 0.9520, 3.8460, 5.1279, 4.7453, 2.1484, 1.8009, 3.2104, 4.2068,
        4.5473, 2.9229, 1.1817, 3.1108, 3.2157, 1.2238, 3.6272, 3.9029, 3.2554,
        0.9945, 3.0062, 5.0030, 4.1144, 1.6314, 3.7945, 3.3091, 4.0727, 3.6212,
        2.4359, 3.5707, 1.2826, 0.9663, 4.9973, 3.0163, 2.9916, 1.0014, 3.1734,
        3.8712, 4.3364, 3.7119, 4.5313, 2.3875, 4.0274, 4.7121, 4.3851, 2.8072,
        3.2066, 3.9684, 0.9307, 1.4160, 2.7484, 2.8771, 1.2753, 2.5825, 4.9857,
        2.0109, 1.0080, 2.2618, 2.7936, 2.5859, 3.0972, 3.1443, 3.8655, 3.2023,
        2.0061, 1.9866, 4.0068, 2.7861, 4.2803, 4.5452, 3.8177, 2.9951, 5.6040,
        1.9013, 2.4498, 1.9155, 4.3239, 3.2993, 1.1275, 4.1460, 4.3619, 4.5913,
        1.1365, 3.0865, 6.0992, 3.9207, 1.8325, 3.8526, 2.0000, 2.0000, 1.0255,
        5.0484, 1.9858, 1.9716, 2.0854, 2.7726, 3.5053, 1.7365, 3.2607, 4.7006,
        1.8830, 0.3378, 2.6222, 0.6491, 3.1144, 3.8404, 2.0632, 4.3311, 4.6138,
        1.6119, 3.0444, 2.4498, 2.7860, 4.0832, 3.2681, 5.0069, 4.8745, 3.6048,
        3.5065, 1.8871, 2.9108, 0.9982, 0.6787, 1.4787, 5.6890, 1.5117, 4.0205,
        4.6624, 4.1051, 4.5437, 3.5410, 1.8761, 4.6653, 5.2577, 5.0311, 4.9531,
        4.0022, 4.7229, 4.0406, 2.5056, 3.2014, 2.9312, 1.3051, 1.3258, 4.9233,
        2.0871, 1.8761, 4.1304, 3.9279, 4.5547, 1.6639, 4.3163, 1.8149, 4.7431,
        3.4398, 3.5483, 3.2541, 2.8282, 1.5230, 2.8214, 4.9214, 3.5371, 4.4522,
        4.7928, 2.4932, 4.8619, 4.7693, 2.3121, 2.3021, 4.6609, 4.7478, 1.7768,
        5.3910, 2.8929, 2.4920, 4.1654, 1.8382, 3.4456, 3.7108, 2.3989, 1.0480,
        4.2870, 5.2730, 3.8976, 3.2956, 3.1010, 0.9666, 3.0227, 2.9491, 3.2218,
        1.4033, 1.7050, 0.5457, 3.1223, 2.1794, 3.9939, 5.0190, 2.9944, 4.5670,
        5.4131, 2.4720, 4.0239, 4.5689, 0.9386, 1.1827, 2.1553, 1.4232, 0.4127,
        1.7502, 1.5601, 2.0953, 2.3530, 2.7085, 2.7157, 2.7900, 4.6793, 1.1711,
        3.4493, 1.7701, 2.1576, 0.8294, 1.9908, 2.1975, 3.6396, 3.1952, 4.9882,
        4.0091, 2.9998, 1.9985, 3.0063, 3.7149, 4.2018, 1.1992, 2.2550, 3.5132,
        1.3794, 2.4434, 2.0220, 0.6691, 1.9927, 3.4666, 2.8342, 1.0393, 4.1834,
        4.0819, 0.8652, 4.8585, 2.0225, 2.9662, 3.9794, 1.0412, 3.0180, 1.0117,
        3.1728, 2.6027, 2.5184, 2.5120, 3.3483, 3.0602, 3.2139, 1.9144, 1.4899,
        2.8253, 2.9160, 1.6410, 3.8484, 2.9637, 2.1272, 2.0490, 4.4915, 1.6853,
        5.0641, 3.9315, 1.8812, 2.1028, 2.1203, 2.8898, 4.0215, 3.3032, 3.6131,
        4.8380, 0.7513, 3.4182, 3.0527, 3.6200, 1.3040, 1.1657, 4.2705, 4.8569,
        2.7037, 0.9142, 1.5261, 3.3970, 0.6980, 3.1131, 3.8348, 3.4478, 4.9488,
        4.0077, 4.9673, 2.0816, 0.9995, 3.4965, 3.2899, 1.0624, 1.4977, 4.3810,
        4.2225, 3.1540, 4.0191, 3.4060, 2.0160, 1.2814, 2.9608, 1.1513, 1.9530,
        0.9872, 3.9914, 4.9865, 3.0477, 1.9701, 2.5473, 4.6173, 0.5252, 3.4813,
        4.7750, 3.5971, 4.1422, 5.2524, 2.0691, 2.0039, 2.1420, 5.0156, 1.8481,
        0.7781, 2.2183, 2.6443, 2.2889, 4.3373, 2.2449, 4.5594, 3.8624, 5.2333,
        2.1537, 4.7373, 5.0298, 2.1322, 2.7047, 4.2308, 2.4907, 2.3259, 4.7678,
        5.0266, 5.2597, 4.7697, 0.9911, 1.0440, 2.7818, 1.1585, 2.1967, 4.4422,
        3.4151, 4.8498, 2.8759, 4.0001, 1.8111, 2.3611, 1.9162, 4.3893, 2.4916,
        2.0815, 3.9944, 5.5013, 4.6856, 4.9904, 4.9865, 4.0133, 1.7178, 2.2895,
        1.9270, 2.6042, 3.5529, 2.0969, 4.9558, 2.9138, 3.0347, 1.6650, 2.2754,
        3.7474, 0.9570, 2.3175, 4.1652, 4.4857, 5.1715, 5.4181, 3.7923, 4.0080,
        3.5960, 2.1456, 2.9088, 3.2796, 1.2589, 4.6664, 2.3447, 3.6577, 2.8478,
        2.8383, 2.9852, 0.9179, 3.0814, 1.2291, 0.7621, 0.8185, 2.3877, 1.1364,
        2.8636, 3.2811, 4.5790, 0.7829, 1.2192, 0.8060, 1.2341, 3.9681, 1.1422,
        4.9521, 5.1383, 2.8294, 3.6377, 3.8734, 3.5638, 2.9749, 1.5051, 1.4258,
        0.5846, 1.0630, 2.7671, 1.7912, 2.8734, 1.8916, 3.9858, 2.5439, 2.6786,
        1.6704, 1.3576, 1.7701, 2.0514, 5.1632, 2.6842, 4.8280, 1.1577, 2.9727,
        3.3256, 2.7693, 2.6430, 4.0140, 2.2755, 2.1973, 4.6792, 5.3522, 2.8058,
        4.9664, 5.2983, 4.7749, 3.8326, 2.4944, 4.2989, 2.8784, 2.0605, 2.8428,
        3.1081, 1.0411, 1.9078, 3.9594], grad_fn=&lt;SumBackward1&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let's predict the ratings for our df dataframe</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> torch.from_numpy(df.values)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>A.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>torch.Size([45, 10])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> <span class="op">~</span>torch.isnan(A)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the indices of the non-NaN values</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>i, j <span class="op">=</span> torch.where(mask)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the values of the non-NaN values</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>v <span class="op">=</span> A[mask]</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Store in PyTorch tensors</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>users <span class="op">=</span> i.to(torch.int64)</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>movies <span class="op">=</span> j.to(torch.int64)</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>ratings <span class="op">=</span> v.to(torch.float32)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">'user'</span>: users, <span class="st">'movie'</span>: movies, <span class="st">'rating'</span>: ratings})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">user</th>
<th data-quarto-table-cell-role="th">movie</th>
<th data-quarto-table-cell-role="th">rating</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>1</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>2</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>3</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>4</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">371</td>
<td>44</td>
<td>3</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">372</td>
<td>44</td>
<td>4</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">373</td>
<td>44</td>
<td>5</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">374</td>
<td>44</td>
<td>6</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">375</td>
<td>44</td>
<td>7</td>
<td>5.0</td>
</tr>
</tbody>
</table>

<p>376 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the Matrix Factorization model</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>n_users <span class="op">=</span> A.shape[<span class="dv">0</span>]</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>n_movies <span class="op">=</span> A.shape[<span class="dv">1</span>]</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> MatrixFactorization(n_users, n_movies, <span class="dv">4</span>)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the loss</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>    pred <span class="op">=</span> model(users, movies)</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> F.mse_loss(pred, ratings)</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Zero the gradients</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Backpropagate</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the parameters</span></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the loss</span></span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(loss.item())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>19.889324188232422
3.1148574352264404
0.6727441549301147
0.5543633103370667
0.5081750750541687
0.4629250764846802
0.4147825837135315
0.36878159642219543
0.32987719774246216
0.29975879192352295</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let us predict the ratings for any user and movie from df for which we already have the ratings</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>username <span class="op">=</span> <span class="st">'Dhruv'</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>movie <span class="op">=</span> <span class="st">'The Dark Knight'</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the user and movie indices</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>user_idx <span class="op">=</span> df.index.get_loc(username)</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>movie_idx <span class="op">=</span> df.columns.get_loc(movie)</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the rating</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model(torch.tensor([user_idx]), torch.tensor([movie_idx]))</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>pred.item(), df.loc[username, movie]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>(5.259384632110596, 5.0)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>df.loc[username]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>Sholay                      NaN
Swades (We The People)      NaN
The Matrix (I)              5.0
Interstellar                5.0
Dangal                      3.0
Taare Zameen Par            NaN
Shawshank Redemption        5.0
The Dark Knight             5.0
Notting Hill                4.0
Uri: The Surgical Strike    5.0
Name: Dhruv, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let us predict the ratings for any user and movie from df for which we do not have the ratings</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>username <span class="op">=</span> <span class="st">'Dhruv'</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>movie <span class="op">=</span> <span class="st">'Sholay'</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the user and movie indices</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>user_idx <span class="op">=</span> df.index.get_loc(username)</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>movie_idx <span class="op">=</span> df.columns.get_loc(movie)</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the rating</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> model(torch.tensor([user_idx]), torch.tensor([movie_idx]))</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>pred, df.loc[username, movie]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>(tensor([3.7885], grad_fn=&lt;SumBackward1&gt;), nan)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the matrix</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    completed_matrix <span class="op">=</span> pd.DataFrame(model.user_factors.weight <span class="op">@</span> model.movie_factors.weight.t(), index<span class="op">=</span>df.index, columns<span class="op">=</span>df.columns)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># round to nearest integer</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    completed_matrix <span class="op">=</span> completed_matrix.<span class="bu">round</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>completed_matrix.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sholay</th>
<th data-quarto-table-cell-role="th">Swades (We The People)</th>
<th data-quarto-table-cell-role="th">The Matrix (I)</th>
<th data-quarto-table-cell-role="th">Interstellar</th>
<th data-quarto-table-cell-role="th">Dangal</th>
<th data-quarto-table-cell-role="th">Taare Zameen Par</th>
<th data-quarto-table-cell-role="th">Shawshank Redemption</th>
<th data-quarto-table-cell-role="th">The Dark Knight</th>
<th data-quarto-table-cell-role="th">Notting Hill</th>
<th data-quarto-table-cell-role="th">Uri: The Surgical Strike</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Your name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Nipun</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gautam Vashishtha</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Eshan Gujarathi</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Sai Krishna Avula</td>
<td>4.0</td>
<td>4.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>6.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Ankit Yadav</td>
<td>3.0</td>
<td>2.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sholay</th>
<th data-quarto-table-cell-role="th">Swades (We The People)</th>
<th data-quarto-table-cell-role="th">The Matrix (I)</th>
<th data-quarto-table-cell-role="th">Interstellar</th>
<th data-quarto-table-cell-role="th">Dangal</th>
<th data-quarto-table-cell-role="th">Taare Zameen Par</th>
<th data-quarto-table-cell-role="th">Shawshank Redemption</th>
<th data-quarto-table-cell-role="th">The Dark Knight</th>
<th data-quarto-table-cell-role="th">Notting Hill</th>
<th data-quarto-table-cell-role="th">Uri: The Surgical Strike</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Your name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Nipun</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gautam Vashishtha</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>1.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Eshan Gujarathi</td>
<td>4.0</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Sai Krishna Avula</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Ankit Yadav</td>
<td>3.0</td>
<td>3.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>