<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nipun Batra">
<meta name="dcterms.date" content="2023-04-04">
<meta name="description" content="KNN Movie Recommendation">

<title>ES654 - KNN Movie Recommendation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ES654</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../grading.html">
 <span class="menu-text">Grading Policy</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../faq.html">
 <span class="menu-text">FAQs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../schedule.html">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../quizzes.html">
 <span class="menu-text">Quizzes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../notebooks/index.html">
 <span class="menu-text">Notebooks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://nipunbatra.github.io">
 <span class="menu-text">Instructor Homepage</span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">KNN Movie Recommendation</h1>
</div>

<div>
  <div class="description">
    KNN Movie Recommendation
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nipun Batra </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 4, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config InlineBackend.figure_format <span class="op">=</span> <span class="st">'retina'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate some toy user and movie data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of users</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>n_users <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of movies</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>n_movies <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of ratings</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>n_ratings <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random user ids</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>user_ids <span class="op">=</span> np.random.randint(<span class="dv">0</span>, n_users, n_ratings)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random movie ids</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>movie_ids <span class="op">=</span> np.random.randint(<span class="dv">0</span>, n_movies, n_ratings)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random ratings</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>ratings <span class="op">=</span> np.random.randint(<span class="dv">1</span>, <span class="dv">6</span>, n_ratings)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe with the data</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'user_id'</span>: user_ids, <span class="st">'movie_id'</span>: movie_ids, <span class="st">'rating'</span>: ratings})</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># We should not have any duplicate ratings for the same user and movie</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop any rows that have duplicate user_id and movie_id pairs</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop_duplicates([<span class="st">'user_id'</span>, <span class="st">'movie_id'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>user_id</th>
      <th>movie_id</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>56</td>
      <td>4</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12</td>
      <td>6</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>54</td>
      <td>7</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>46</td>
      <td>3</td>
      <td>5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>988</th>
      <td>8</td>
      <td>9</td>
      <td>1</td>
    </tr>
    <tr>
      <th>990</th>
      <td>38</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>993</th>
      <td>40</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>995</th>
      <td>61</td>
      <td>8</td>
      <td>3</td>
    </tr>
    <tr>
      <th>997</th>
      <td>91</td>
      <td>3</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>642 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a user-item matrix</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> df.pivot(index<span class="op">=</span><span class="st">'user_id'</span>, columns<span class="op">=</span><span class="st">'movie_id'</span>, values<span class="op">=</span><span class="st">'rating'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>movie_id</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>user_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>NaN</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>96</th>
      <td>3.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>98</th>
      <td>1.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>99</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill in the missing values with zeros</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> A.fillna(<span class="dv">0</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>movie_id</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>user_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>0.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>96</th>
      <td>3.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>98</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>99</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cosine similarity between U1 and U2</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># User 1</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>u1 <span class="op">=</span> A.loc[<span class="dv">0</span>]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># User 2</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>u2 <span class="op">=</span> A.loc[<span class="dv">1</span>]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the dot product</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>dot <span class="op">=</span> np.dot(u1, u2)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the L2 norm</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>norm_u1 <span class="op">=</span> np.linalg.norm(u1)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>norm_u2 <span class="op">=</span> np.linalg.norm(u2)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the cosine similarity</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>cos_sim <span class="op">=</span> dot <span class="op">/</span> (norm_u1 <span class="op">*</span> norm_u2)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>cos_sim</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>0.51963422122285</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the cosine similarity between users</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics.pairwise <span class="im">import</span> cosine_similarity</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>sim_matrix <span class="op">=</span> cosine_similarity(A)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(sim_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>90</th>
      <th>91</th>
      <th>92</th>
      <th>93</th>
      <th>94</th>
      <th>95</th>
      <th>96</th>
      <th>97</th>
      <th>98</th>
      <th>99</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.000000</td>
      <td>0.519634</td>
      <td>0.675926</td>
      <td>0.549634</td>
      <td>0.622693</td>
      <td>0.683906</td>
      <td>0.278747</td>
      <td>0.615576</td>
      <td>0.702012</td>
      <td>0.194184</td>
      <td>...</td>
      <td>0.394676</td>
      <td>0.233882</td>
      <td>0.566558</td>
      <td>0.702012</td>
      <td>0.301941</td>
      <td>0.711499</td>
      <td>0.747840</td>
      <td>0.789339</td>
      <td>0.696789</td>
      <td>0.718480</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.519634</td>
      <td>1.000000</td>
      <td>0.674330</td>
      <td>0.451571</td>
      <td>0.802501</td>
      <td>0.684035</td>
      <td>0.610705</td>
      <td>0.489219</td>
      <td>0.731805</td>
      <td>0.680697</td>
      <td>...</td>
      <td>0.800641</td>
      <td>0.288231</td>
      <td>0.429669</td>
      <td>0.744208</td>
      <td>0.351432</td>
      <td>0.431672</td>
      <td>0.614413</td>
      <td>0.842218</td>
      <td>0.508863</td>
      <td>0.297805</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.675926</td>
      <td>0.674330</td>
      <td>1.000000</td>
      <td>0.632456</td>
      <td>0.758671</td>
      <td>0.321938</td>
      <td>0.734809</td>
      <td>0.340909</td>
      <td>0.607622</td>
      <td>0.712991</td>
      <td>...</td>
      <td>0.233955</td>
      <td>0.412861</td>
      <td>0.759064</td>
      <td>0.628942</td>
      <td>0.408635</td>
      <td>0.752298</td>
      <td>0.704068</td>
      <td>0.810696</td>
      <td>0.765339</td>
      <td>0.457045</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.549634</td>
      <td>0.451571</td>
      <td>0.632456</td>
      <td>1.000000</td>
      <td>0.857870</td>
      <td>0.354107</td>
      <td>0.331953</td>
      <td>0.416846</td>
      <td>0.337100</td>
      <td>0.369998</td>
      <td>...</td>
      <td>0.278524</td>
      <td>0.522233</td>
      <td>0.311400</td>
      <td>0.701168</td>
      <td>0.404520</td>
      <td>0.821235</td>
      <td>0.772712</td>
      <td>0.659223</td>
      <td>0.507093</td>
      <td>0.393123</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.622693</td>
      <td>0.802501</td>
      <td>0.758671</td>
      <td>0.857870</td>
      <td>1.000000</td>
      <td>0.566365</td>
      <td>0.557478</td>
      <td>0.494286</td>
      <td>0.603864</td>
      <td>0.610275</td>
      <td>...</td>
      <td>0.612531</td>
      <td>0.529004</td>
      <td>0.394296</td>
      <td>0.884229</td>
      <td>0.467275</td>
      <td>0.760995</td>
      <td>0.806471</td>
      <td>0.868882</td>
      <td>0.688166</td>
      <td>0.536302</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>0.711499</td>
      <td>0.431672</td>
      <td>0.752298</td>
      <td>0.821235</td>
      <td>0.760995</td>
      <td>0.368122</td>
      <td>0.452189</td>
      <td>0.669854</td>
      <td>0.638046</td>
      <td>0.431064</td>
      <td>...</td>
      <td>0.137286</td>
      <td>0.648987</td>
      <td>0.595355</td>
      <td>0.609044</td>
      <td>0.354470</td>
      <td>1.000000</td>
      <td>0.854470</td>
      <td>0.656432</td>
      <td>0.738138</td>
      <td>0.663176</td>
    </tr>
    <tr>
      <th>96</th>
      <td>0.747840</td>
      <td>0.614413</td>
      <td>0.704068</td>
      <td>0.772712</td>
      <td>0.806471</td>
      <td>0.471884</td>
      <td>0.430405</td>
      <td>0.786900</td>
      <td>0.689613</td>
      <td>0.266519</td>
      <td>...</td>
      <td>0.489031</td>
      <td>0.702198</td>
      <td>0.654234</td>
      <td>0.786742</td>
      <td>0.178069</td>
      <td>0.854470</td>
      <td>1.000000</td>
      <td>0.738663</td>
      <td>0.675199</td>
      <td>0.533037</td>
    </tr>
    <tr>
      <th>97</th>
      <td>0.789339</td>
      <td>0.842218</td>
      <td>0.810696</td>
      <td>0.659223</td>
      <td>0.868882</td>
      <td>0.618172</td>
      <td>0.523776</td>
      <td>0.492208</td>
      <td>0.679018</td>
      <td>0.543436</td>
      <td>...</td>
      <td>0.607782</td>
      <td>0.233762</td>
      <td>0.487861</td>
      <td>0.887250</td>
      <td>0.543214</td>
      <td>0.656432</td>
      <td>0.738663</td>
      <td>1.000000</td>
      <td>0.742860</td>
      <td>0.574490</td>
    </tr>
    <tr>
      <th>98</th>
      <td>0.696789</td>
      <td>0.508863</td>
      <td>0.765339</td>
      <td>0.507093</td>
      <td>0.688166</td>
      <td>0.374094</td>
      <td>0.603186</td>
      <td>0.473781</td>
      <td>0.695160</td>
      <td>0.469058</td>
      <td>...</td>
      <td>0.323669</td>
      <td>0.411943</td>
      <td>0.679883</td>
      <td>0.717952</td>
      <td>0.569803</td>
      <td>0.738138</td>
      <td>0.675199</td>
      <td>0.742860</td>
      <td>1.000000</td>
      <td>0.840395</td>
    </tr>
    <tr>
      <th>99</th>
      <td>0.718480</td>
      <td>0.297805</td>
      <td>0.457045</td>
      <td>0.393123</td>
      <td>0.536302</td>
      <td>0.450377</td>
      <td>0.189990</td>
      <td>0.475327</td>
      <td>0.634545</td>
      <td>0.176471</td>
      <td>...</td>
      <td>0.265684</td>
      <td>0.265684</td>
      <td>0.330049</td>
      <td>0.634545</td>
      <td>0.371580</td>
      <td>0.663176</td>
      <td>0.533037</td>
      <td>0.574490</td>
      <td>0.840395</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 100 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>sns.heatmap(sim_matrix, cmap<span class="op">=</span><span class="st">'Greys'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="movie-recommendation-knn_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the most similar users to user u </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> k_nearest_neighbors(A, u, k):</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Find the k nearest neighbors for user u"""</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the index of the user in the matrix</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    u_index <span class="op">=</span> A.index.get_loc(u)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the similarity between the user and all other users</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    sim_matrix <span class="op">=</span> cosine_similarity(A)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the k most similar users</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    k_nearest <span class="op">=</span> np.argsort(sim_matrix[u_index])[::<span class="op">-</span><span class="dv">1</span>][<span class="dv">1</span>:k<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the user ids</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> A.index[k_nearest]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>k_nearest_neighbors(A, <span class="dv">0</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>Int64Index([17, 70, 63, 65, 28], dtype='int64', name='user_id')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show matrix of movie ratings for u and k nearest neighbors</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_neighbors(A, u, k):</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Show the movie ratings for user u and k nearest neighbors"""</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the user ids of the k nearest neighbors</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> k_nearest_neighbors(A, u, k)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the movie ratings for user u and the k nearest neighbors</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> A.loc[[u] <span class="op">+</span> <span class="bu">list</span>(neighbors)]</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the dataframe</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>show_neighbors(A, <span class="dv">0</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>movie_id</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
    <tr>
      <th>user_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>70</th>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>63</th>
      <td>4.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>65</th>
      <td>2.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rating for user u for movie 0 is: (4.0 + 3.0) / 2 = 3.5 (Discard 0s)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> predict_rating(A, u, m, k<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Predict the rating for user u for movie m"""</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the user ids of the k nearest neighbors</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> k_nearest_neighbors(A, u, k)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the movie ratings for user u and the k nearest neighbors</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> A.loc[[u] <span class="op">+</span> <span class="bu">list</span>(neighbors)]</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the ratings for movie m</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    ratings <span class="op">=</span> df[m]</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the mean of the ratings</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    mean <span class="op">=</span> ratings[<span class="dv">1</span>:][ratings <span class="op">!=</span> <span class="dv">0</span>].mean()</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the mean</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>predict_rating(A, <span class="dv">0</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>3.8</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now working with real data</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(<span class="st">"mov-rec.xlsx"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Timestamp</th>
      <th>Your name</th>
      <th>Sholay</th>
      <th>Swades (We The People)</th>
      <th>The Matrix (I)</th>
      <th>Interstellar</th>
      <th>Dangal</th>
      <th>Taare Zameen Par</th>
      <th>Shawshank Redemption</th>
      <th>The Dark Knight</th>
      <th>Notting Hill</th>
      <th>Uri: The Surgical Strike</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2023-04-11 10:58:44.990</td>
      <td>Nipun</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2023-04-11 10:59:49.617</td>
      <td>Gautam Vashishtha</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2023-04-11 11:12:44.033</td>
      <td>Eshan Gujarathi</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2023-04-11 11:13:48.674</td>
      <td>Sai Krishna Avula</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2023-04-11 11:13:55.658</td>
      <td>Ankit Yadav</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Discard the timestamp column</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'Timestamp'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the "Your Name" column the index</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.set_index(<span class="st">'Your name'</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Sholay</th>
      <th>Swades (We The People)</th>
      <th>The Matrix (I)</th>
      <th>Interstellar</th>
      <th>Dangal</th>
      <th>Taare Zameen Par</th>
      <th>Shawshank Redemption</th>
      <th>The Dark Knight</th>
      <th>Notting Hill</th>
      <th>Uri: The Surgical Strike</th>
    </tr>
    <tr>
      <th>Your name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Nipun</th>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Gautam Vashishtha</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Eshan Gujarathi</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Sai Krishna Avula</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Ankit Yadav</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Dhruv</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Saatvik Rao</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Zeel B Patel</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Neel</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Sachin Jalan</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Ayush Shrivastava</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>....</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Hari Hara Sudhan</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Etikikota Hrushikesh</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Chirag</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Aaryan Darad</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Hetvi Patel</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Kalash Kankaria</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Rachit Verma</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>shriraj</th>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Bhavini Korthi</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Hitarth Gandhi</th>
      <td>3.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Radhika Joglekar</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Medhansh Singh</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Arun Mani</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Satyam</th>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Karan Kumar</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>R Yeeshu Dhurandhar</th>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Satyam Gupta</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>rushali</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>shridhar</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Tanvi Jain</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Manish Prabhubhai Salvi</th>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Varun Barala</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Kevin Shah</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Inderjeet</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Gangaram Siddam</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Aditi</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Madhuri Awachar</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Anupam</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Jinay</th>
      <td>3.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Shrutimoy</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Aadesh Desai</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Dhairya</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>Rahul C</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>Index(['Nipun', 'Gautam Vashishtha', 'Eshan Gujarathi', 'Sai Krishna Avula',
       'Ankit Yadav ', 'Dhruv', 'Saatvik Rao ', 'Zeel B Patel', 'Neel ',
       'Sachin Jalan ', 'Ayush Shrivastava', '....', 'Hari Hara Sudhan',
       'Etikikota Hrushikesh', 'Chirag', 'Aaryan Darad', 'Hetvi Patel',
       'Kalash Kankaria', 'Rachit Verma', 'shriraj', 'Bhavini Korthi ',
       'Hitarth Gandhi ', 'Radhika Joglekar ', 'Medhansh Singh', 'Arun Mani',
       'Satyam ', 'Karan Kumar ', 'R Yeeshu Dhurandhar', 'Satyam Gupta',
       'rushali', 'shridhar', 'Tanvi Jain ', 'Manish Prabhubhai Salvi ',
       'Varun Barala', 'Kevin Shah ', 'Inderjeet', 'Gangaram Siddam ', 'Aditi',
       'Madhuri Awachar', 'Anupam', 'Jinay', 'Shrutimoy', 'Aadesh Desai',
       'Dhairya', 'Rahul C'],
      dtype='object', name='Your name')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get index for user and movie</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>user <span class="op">=</span> <span class="st">'Rahul C'</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(user <span class="kw">in</span> df.index)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the movie ratings for user</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>user_ratings <span class="op">=</span> df.loc[user]</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>user_ratings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>Sholay                      3.0
Swades (We The People)      3.0
The Matrix (I)              4.0
Interstellar                4.0
Dangal                      4.0
Taare Zameen Par            4.0
Shawshank Redemption        4.0
The Dark Knight             5.0
Notting Hill                NaN
Uri: The Surgical Strike    NaN
Name: Rahul C, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df_copy <span class="op">=</span> df.copy()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df_copy.fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>show_neighbors(df_copy, user, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Sholay</th>
      <th>Swades (We The People)</th>
      <th>The Matrix (I)</th>
      <th>Interstellar</th>
      <th>Dangal</th>
      <th>Taare Zameen Par</th>
      <th>Shawshank Redemption</th>
      <th>The Dark Knight</th>
      <th>Notting Hill</th>
      <th>Uri: The Surgical Strike</th>
    </tr>
    <tr>
      <th>Your name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Rahul C</th>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Shrutimoy</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Hitarth Gandhi</th>
      <td>3.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>R Yeeshu Dhurandhar</th>
      <td>5.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>shridhar</th>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Sachin Jalan</th>
      <td>4.0</td>
      <td>0.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Sholay</th>
      <th>Swades (We The People)</th>
      <th>The Matrix (I)</th>
      <th>Interstellar</th>
      <th>Dangal</th>
      <th>Taare Zameen Par</th>
      <th>Shawshank Redemption</th>
      <th>The Dark Knight</th>
      <th>Notting Hill</th>
      <th>Uri: The Surgical Strike</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>39.000000</td>
      <td>32.000000</td>
      <td>38.000000</td>
      <td>43.000000</td>
      <td>45.000000</td>
      <td>44.000000</td>
      <td>35.000000</td>
      <td>40.000000</td>
      <td>21.000000</td>
      <td>39.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>4.102564</td>
      <td>3.718750</td>
      <td>4.131579</td>
      <td>4.581395</td>
      <td>3.644444</td>
      <td>3.977273</td>
      <td>4.400000</td>
      <td>4.250000</td>
      <td>3.476190</td>
      <td>4.230769</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.753758</td>
      <td>0.958304</td>
      <td>0.991070</td>
      <td>0.793802</td>
      <td>1.003529</td>
      <td>1.067242</td>
      <td>0.976187</td>
      <td>1.080123</td>
      <td>0.813575</td>
      <td>0.902089</td>
    </tr>
    <tr>
      <th>min</th>
      <td>3.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>4.000000</td>
      <td>3.000000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>3.000000</td>
      <td>3.000000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>3.000000</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>3.000000</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>5.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
      <td>5.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the rating for user u for movie m</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>predict_rating(df_copy, user, <span class="st">'The Dark Knight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>5.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>predict_rating(df_copy, user, <span class="st">'Sholay'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>3.4</code></pre>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic Matrix Factorization (without missing values)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># D is a matrix of size (n_users, n_movies) randomly generated values between 1 and 5</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> torch.randint(<span class="dv">1</span>, <span class="dv">6</span>, (n_users, n_movies), dtype<span class="op">=</span>torch.<span class="bu">float</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>D</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>tensor([[4., 3., 2., 5., 2., 4., 4., 3., 5., 4.],
        [1., 2., 3., 4., 5., 2., 2., 1., 4., 1.],
        [1., 4., 5., 4., 3., 2., 4., 2., 5., 2.],
        [1., 2., 3., 2., 5., 4., 2., 4., 3., 1.],
        [2., 3., 1., 5., 5., 1., 4., 4., 5., 3.],
        [2., 4., 5., 1., 1., 5., 2., 3., 1., 1.],
        [2., 5., 1., 2., 2., 5., 4., 5., 3., 5.],
        [3., 1., 4., 2., 2., 5., 2., 3., 3., 4.],
        [1., 1., 2., 5., 5., 2., 2., 1., 2., 5.],
        [5., 4., 1., 1., 4., 4., 2., 5., 1., 2.],
        [4., 2., 1., 2., 1., 5., 1., 3., 1., 4.],
        [3., 2., 4., 4., 1., 4., 4., 2., 3., 2.],
        [2., 2., 2., 4., 5., 4., 3., 1., 2., 4.],
        [4., 5., 4., 3., 4., 1., 4., 3., 1., 5.],
        [5., 2., 4., 4., 3., 1., 3., 3., 3., 1.],
        [1., 5., 5., 3., 1., 5., 4., 1., 4., 1.],
        [3., 2., 5., 2., 5., 3., 1., 2., 4., 5.],
        [2., 1., 5., 4., 3., 1., 4., 1., 1., 1.],
        [3., 1., 1., 2., 3., 4., 5., 4., 3., 3.],
        [3., 1., 1., 5., 2., 5., 1., 5., 5., 3.],
        [2., 2., 2., 5., 4., 1., 3., 4., 4., 4.],
        [3., 3., 3., 3., 5., 5., 3., 5., 5., 1.],
        [3., 5., 1., 1., 3., 2., 3., 1., 5., 1.],
        [3., 3., 2., 5., 4., 3., 1., 5., 3., 3.],
        [5., 3., 3., 1., 1., 5., 1., 5., 3., 5.],
        [3., 1., 5., 4., 1., 3., 3., 1., 3., 4.],
        [5., 4., 1., 3., 5., 4., 3., 1., 1., 5.],
        [1., 3., 1., 1., 4., 3., 2., 2., 3., 5.],
        [4., 5., 1., 5., 4., 2., 2., 4., 4., 5.],
        [1., 1., 2., 2., 1., 1., 4., 1., 2., 2.],
        [1., 2., 4., 5., 1., 1., 5., 1., 2., 3.],
        [3., 1., 1., 2., 2., 3., 2., 3., 2., 3.],
        [1., 4., 4., 1., 5., 3., 2., 5., 5., 3.],
        [1., 5., 4., 4., 3., 2., 1., 4., 3., 1.],
        [3., 1., 2., 2., 4., 4., 5., 5., 1., 4.],
        [4., 5., 2., 5., 4., 4., 1., 1., 4., 4.],
        [5., 1., 2., 3., 5., 2., 5., 3., 1., 5.],
        [4., 2., 5., 1., 4., 5., 3., 5., 4., 1.],
        [3., 2., 1., 5., 4., 3., 1., 5., 4., 3.],
        [1., 5., 3., 2., 1., 4., 5., 1., 4., 2.],
        [5., 2., 3., 1., 5., 2., 5., 1., 2., 5.],
        [3., 3., 1., 1., 5., 1., 5., 4., 1., 4.],
        [5., 3., 5., 1., 1., 2., 4., 2., 5., 2.],
        [2., 5., 1., 4., 3., 4., 1., 1., 2., 2.],
        [5., 4., 1., 1., 5., 2., 2., 3., 3., 1.],
        [1., 3., 5., 1., 2., 3., 1., 5., 2., 3.],
        [2., 1., 3., 4., 5., 1., 5., 2., 5., 3.],
        [5., 2., 4., 1., 1., 2., 1., 2., 5., 4.],
        [1., 3., 4., 2., 4., 3., 1., 4., 2., 5.],
        [5., 4., 3., 3., 4., 2., 2., 5., 2., 3.],
        [4., 3., 1., 2., 1., 2., 2., 1., 5., 1.],
        [1., 3., 3., 5., 5., 2., 1., 3., 4., 4.],
        [1., 1., 5., 5., 4., 2., 5., 3., 2., 2.],
        [5., 2., 1., 1., 1., 5., 3., 1., 5., 5.],
        [1., 3., 2., 4., 2., 2., 2., 3., 2., 5.],
        [1., 2., 1., 1., 2., 1., 4., 2., 1., 2.],
        [3., 2., 5., 1., 4., 1., 2., 5., 3., 4.],
        [4., 2., 4., 1., 4., 2., 2., 1., 1., 4.],
        [3., 3., 1., 2., 4., 4., 5., 3., 2., 4.],
        [3., 4., 4., 2., 3., 1., 4., 4., 5., 4.],
        [1., 4., 2., 3., 2., 1., 4., 3., 3., 1.],
        [2., 1., 1., 5., 1., 5., 3., 2., 3., 1.],
        [3., 3., 1., 5., 4., 1., 3., 2., 2., 4.],
        [5., 5., 1., 1., 5., 3., 2., 4., 4., 1.],
        [5., 3., 5., 2., 3., 5., 1., 4., 1., 5.],
        [1., 3., 4., 4., 1., 1., 2., 2., 4., 5.],
        [3., 4., 2., 1., 2., 5., 4., 1., 3., 3.],
        [2., 4., 3., 3., 2., 3., 2., 3., 1., 1.],
        [2., 3., 1., 3., 1., 1., 4., 1., 2., 1.],
        [5., 1., 3., 4., 1., 4., 2., 5., 4., 4.],
        [1., 1., 4., 4., 5., 3., 1., 2., 3., 5.],
        [1., 1., 4., 5., 3., 5., 4., 2., 3., 4.],
        [3., 3., 1., 4., 1., 1., 1., 2., 1., 5.],
        [1., 4., 5., 5., 5., 3., 2., 1., 3., 5.],
        [3., 4., 3., 2., 2., 1., 4., 5., 1., 2.],
        [5., 2., 3., 1., 2., 4., 1., 5., 5., 4.],
        [2., 4., 2., 4., 2., 3., 5., 3., 4., 2.],
        [4., 3., 5., 5., 1., 3., 1., 3., 2., 5.],
        [5., 5., 2., 1., 3., 3., 5., 4., 2., 3.],
        [2., 4., 1., 2., 4., 3., 1., 4., 1., 3.],
        [4., 1., 2., 2., 5., 1., 3., 4., 5., 3.],
        [2., 3., 2., 1., 3., 5., 5., 1., 1., 3.],
        [2., 2., 1., 5., 1., 5., 1., 4., 1., 3.],
        [4., 1., 1., 3., 2., 3., 2., 3., 2., 4.],
        [2., 3., 2., 2., 4., 2., 1., 1., 5., 2.],
        [5., 3., 5., 2., 4., 5., 5., 4., 3., 2.],
        [2., 2., 4., 3., 1., 5., 2., 5., 3., 4.],
        [3., 3., 1., 5., 5., 5., 5., 1., 4., 3.],
        [3., 4., 4., 4., 2., 5., 2., 5., 2., 1.],
        [3., 1., 1., 3., 2., 5., 2., 4., 2., 4.],
        [5., 4., 3., 2., 1., 4., 1., 3., 3., 5.],
        [5., 3., 3., 2., 3., 3., 2., 4., 3., 3.],
        [4., 4., 4., 4., 4., 4., 4., 5., 1., 4.],
        [2., 5., 5., 2., 2., 2., 5., 4., 5., 3.],
        [1., 4., 2., 3., 1., 4., 4., 4., 4., 1.],
        [1., 4., 3., 5., 2., 5., 3., 1., 2., 3.],
        [2., 2., 2., 5., 4., 4., 3., 3., 5., 1.],
        [4., 2., 2., 2., 5., 1., 4., 4., 2., 1.],
        [1., 1., 3., 2., 5., 2., 4., 5., 3., 3.],
        [2., 2., 4., 1., 1., 2., 1., 2., 5., 5.]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>D.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>torch.Size([100, 10])</code></pre>
</div>
</div>
<p>Let us decompose D as AB. A is of shape (n, k) and B is of shape (k, n). We can write the above equation as: D = AB</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly initialize A and B</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> torch.randn(n_users, <span class="dv">2</span>, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> torch.randn(n_movies, <span class="dv">2</span>, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the loss</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> torch.norm(torch.mm(A, B.t()) <span class="op">-</span> D)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>tensor(112.6271, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(torch.mm(A, B.t()).detach().numpy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.524264</td>
      <td>0.363830</td>
      <td>-0.686333</td>
      <td>0.569968</td>
      <td>-1.230030</td>
      <td>-0.410660</td>
      <td>-0.836353</td>
      <td>0.361109</td>
      <td>-0.204832</td>
      <td>-1.753140</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.064197</td>
      <td>-0.782522</td>
      <td>2.640134</td>
      <td>2.749459</td>
      <td>-0.938775</td>
      <td>-0.972266</td>
      <td>0.562981</td>
      <td>0.459940</td>
      <td>-1.425668</td>
      <td>-1.993173</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.156803</td>
      <td>-0.030377</td>
      <td>-0.348597</td>
      <td>-1.433861</td>
      <td>1.352612</td>
      <td>0.681336</td>
      <td>0.500788</td>
      <td>-0.461378</td>
      <td>0.667887</td>
      <td>2.156318</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.110378</td>
      <td>-1.263404</td>
      <td>3.816814</td>
      <td>2.916680</td>
      <td>-0.143026</td>
      <td>-0.859163</td>
      <td>1.382228</td>
      <td>0.269013</td>
      <td>-1.587093</td>
      <td>-1.010718</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.274173</td>
      <td>-1.221377</td>
      <td>3.775182</td>
      <td>3.111098</td>
      <td>-0.401042</td>
      <td>-0.966615</td>
      <td>1.245646</td>
      <td>0.350723</td>
      <td>-1.671115</td>
      <td>-1.399655</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>-0.271094</td>
      <td>-0.094235</td>
      <td>0.128423</td>
      <td>-0.316148</td>
      <td>0.470534</td>
      <td>0.185023</td>
      <td>0.269012</td>
      <td>-0.145952</td>
      <td>0.132166</td>
      <td>0.698416</td>
    </tr>
    <tr>
      <th>96</th>
      <td>-0.553128</td>
      <td>-0.254772</td>
      <td>0.412769</td>
      <td>-0.630798</td>
      <td>1.070217</td>
      <td>0.395701</td>
      <td>0.657679</td>
      <td>-0.324934</td>
      <td>0.252195</td>
      <td>1.563543</td>
    </tr>
    <tr>
      <th>97</th>
      <td>1.861921</td>
      <td>-0.796350</td>
      <td>2.599720</td>
      <td>2.500680</td>
      <td>-0.687248</td>
      <td>-0.850650</td>
      <td>0.665373</td>
      <td>0.375566</td>
      <td>-1.311264</td>
      <td>-1.597247</td>
    </tr>
    <tr>
      <th>98</th>
      <td>3.333354</td>
      <td>-1.515899</td>
      <td>4.871802</td>
      <td>4.497489</td>
      <td>-1.071355</td>
      <td>-1.496645</td>
      <td>1.348246</td>
      <td>0.633194</td>
      <td>-2.372742</td>
      <td>-2.659563</td>
    </tr>
    <tr>
      <th>99</th>
      <td>3.380641</td>
      <td>-2.238584</td>
      <td>6.632090</td>
      <td>4.721251</td>
      <td>0.149355</td>
      <td>-1.313815</td>
      <td>2.587998</td>
      <td>0.337695</td>
      <td>-2.602406</td>
      <td>-1.143166</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(D)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>96</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>97</th>
      <td>4.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>98</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>99</th>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>5.0</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimizer</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam([A, B], lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the loss</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> torch.norm(torch.mm(A, B.t()) <span class="op">-</span> D)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Zero the gradients</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    optimizer.zero_grad()</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Backpropagate</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    loss.backward()</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the parameters</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    optimizer.step()</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the loss</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">%</span> <span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(loss.item())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>112.62710571289062
108.92525482177734
105.864013671875
103.14228820800781
100.3882827758789
97.25345611572266
93.47792053222656
88.91209411621094
83.56034088134766
77.6304702758789
71.4714126586914
65.45447540283203
59.91099166870117
55.11323928833008
51.2287712097168
48.287933349609375
46.19685363769531
44.790283203125
43.88166427612305
43.29935836791992
42.91199493408203
42.63471603393555
42.41824722290039
42.235260009765625
42.07093048095703
41.91758346557617
41.7717170715332
41.63225173950195
41.499305725097656
41.37335968017578
41.254825592041016
41.14387512207031
41.04042434692383
40.944252014160156
40.85504913330078
40.772457122802734
40.696102142333984
40.62557601928711
40.56047439575195
40.500396728515625
40.4449348449707
40.393699645996094
40.34634017944336
40.3025016784668
40.26188659667969
40.224212646484375
40.189208984375
40.156639099121094
40.12628173828125
40.09793472290039
40.071414947509766
40.04655456542969
40.023197174072266
40.001197814941406
39.98042297363281
39.96074295043945
39.94205856323242
39.924259185791016
39.907249450683594
39.89093780517578
39.87525177001953
39.86011505126953
39.845455169677734
39.83121109008789
39.81733322143555
39.80376434326172
39.79046630859375
39.777400970458984
39.76453399658203
39.7518196105957
39.739253997802734
39.726802825927734
39.714447021484375
39.702178955078125
39.689979553222656
39.67784881591797
39.66577911376953
39.65376281738281
39.64180374145508
39.62990951538086
39.618080139160156
39.606319427490234
39.59463882446289
39.58304977416992
39.57155990600586
39.560176849365234
39.54891586303711
39.53778839111328
39.52681350708008
39.515995025634766
39.50534439086914
39.4948844909668
39.484619140625
39.47455978393555
39.4647216796875
39.45510482788086
39.44572830200195
39.43659973144531
39.42771911621094
39.41909408569336</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(torch.mm(A, B.t()).detach().numpy()).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.007192</td>
      <td>3.316140</td>
      <td>3.483459</td>
      <td>4.220478</td>
      <td>3.838510</td>
      <td>3.575429</td>
      <td>3.539129</td>
      <td>3.376292</td>
      <td>3.733709</td>
      <td>3.931873</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.974175</td>
      <td>1.970394</td>
      <td>2.661520</td>
      <td>4.411837</td>
      <td>2.908245</td>
      <td>2.106148</td>
      <td>2.671284</td>
      <td>1.541281</td>
      <td>2.793394</td>
      <td>2.923805</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(D).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> factorize(D, k):</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Factorize the matrix D into A and B"""</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Randomly initialize A and B</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> torch.randn(D.shape[<span class="dv">0</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> torch.randn(D.shape[<span class="dv">1</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optimizer</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optim.Adam([A, B], lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Train the model</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the loss</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> torch.norm(torch.mm(A, B.t()) <span class="op">-</span> D)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Zero the gradients</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Backpropagate</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update the parameters</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> A, B, loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">9</span>]:</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    A, B, loss <span class="op">=</span> factorize(D, k)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(k, loss.item())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1 43.15137481689453
2 39.25961685180664
3 35.80067825317383
4 32.64104080200195
5 28.294830322265625
6 24.701953887939453
9 10.68772029876709</code></pre>
</div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(torch.mm(A, B.t()).detach().numpy()).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.115438</td>
      <td>2.987677</td>
      <td>2.055727</td>
      <td>5.064999</td>
      <td>2.033504</td>
      <td>4.004031</td>
      <td>3.952853</td>
      <td>2.940185</td>
      <td>4.953001</td>
      <td>3.905292</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.236143</td>
      <td>2.082658</td>
      <td>2.630625</td>
      <td>3.572773</td>
      <td>4.774615</td>
      <td>1.970729</td>
      <td>2.313552</td>
      <td>1.398327</td>
      <td>4.311027</td>
      <td>1.625913</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(D).head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># With missing values</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly replace some entries with NaN</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> torch.randint(<span class="dv">1</span>, <span class="dv">6</span>, (n_users, n_movies), dtype<span class="op">=</span>torch.<span class="bu">float</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>D[torch.rand(D.shape) <span class="op">&lt;</span> <span class="fl">0.5</span>] <span class="op">=</span> <span class="bu">float</span>(<span class="st">'nan'</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>D</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>tensor([[1., nan, nan, 1., nan, nan, nan, nan, nan, nan],
        [nan, nan, 3., nan, 2., nan, 1., 4., 4., 4.],
        [2., 3., 1., nan, 2., 3., 1., nan, 4., 5.],
        [nan, nan, nan, nan, nan, 4., 2., 3., nan, 3.],
        [nan, nan, 4., nan, 2., nan, 4., nan, nan, 2.],
        [nan, 5., 3., nan, nan, 5., nan, nan, nan, 3.],
        [nan, nan, 3., 4., nan, nan, nan, nan, 1., nan],
        [nan, 5., nan, nan, 2., nan, 1., 3., nan, nan],
        [nan, 3., 2., nan, nan, nan, nan, nan, nan, nan],
        [3., 1., nan, nan, nan, 3., 3., nan, nan, 1.],
        [3., 3., nan, nan, 1., 1., nan, nan, 1., nan],
        [2., 2., nan, 2., nan, 2., 2., nan, 5., 5.],
        [nan, nan, nan, nan, nan, 3., 2., nan, 5., nan],
        [nan, 2., 4., 2., nan, 3., 2., nan, 5., 1.],
        [nan, nan, nan, nan, nan, 2., 4., 2., nan, nan],
        [3., nan, nan, 3., 3., nan, 3., 1., 4., 5.],
        [2., nan, nan, 4., 3., nan, nan, 2., 5., nan],
        [1., 5., nan, nan, 4., nan, nan, nan, 5., 4.],
        [nan, nan, nan, nan, nan, 3., nan, 5., 4., nan],
        [2., 4., 4., nan, 3., 4., nan, nan, nan, 3.],
        [4., nan, nan, 4., 4., 2., 2., 4., nan, 3.],
        [nan, 5., nan, 2., 2., 3., nan, 1., 3., nan],
        [4., nan, 1., 1., 5., nan, nan, 3., nan, nan],
        [nan, nan, nan, nan, nan, nan, 1., nan, 4., 1.],
        [3., nan, 4., nan, 3., 5., 5., nan, 2., nan],
        [5., nan, 2., nan, 1., nan, 3., nan, nan, nan],
        [1., 2., nan, nan, 3., 1., 3., 3., 4., 4.],
        [nan, nan, nan, nan, nan, 5., 1., 3., 1., 5.],
        [1., 1., nan, 3., 2., nan, nan, 2., nan, nan],
        [1., 4., nan, nan, nan, 1., nan, 4., 5., nan],
        [3., nan, 4., 2., nan, nan, 5., 4., nan, nan],
        [nan, 5., 2., nan, nan, 4., nan, nan, nan, nan],
        [5., 5., 1., nan, nan, 1., 1., nan, nan, nan],
        [nan, nan, nan, nan, 3., nan, 4., nan, 5., nan],
        [nan, 5., nan, 2., nan, nan, nan, nan, nan, 5.],
        [nan, 4., 2., 2., nan, 2., 5., nan, nan, nan],
        [nan, nan, nan, nan, 4., nan, nan, 3., nan, 4.],
        [nan, nan, nan, 5., 4., 5., 1., nan, nan, 1.],
        [nan, 1., nan, nan, nan, nan, 3., 3., nan, nan],
        [nan, nan, 2., 2., 5., 4., 1., 1., nan, 5.],
        [3., nan, 1., nan, nan, nan, nan, 4., 2., nan],
        [nan, nan, nan, nan, 1., nan, 3., nan, 2., 3.],
        [nan, nan, nan, 1., 4., 3., 3., nan, 3., 4.],
        [2., nan, 5., nan, 1., 1., nan, 5., 1., 2.],
        [2., nan, 5., nan, 3., nan, 1., 5., 5., nan],
        [5., nan, nan, 5., 4., nan, nan, nan, nan, 4.],
        [nan, 5., nan, 4., 5., 5., nan, 4., 3., nan],
        [nan, 2., 3., nan, nan, 3., 3., 5., nan, nan],
        [1., 4., 5., 3., nan, nan, 2., 5., nan, 1.],
        [nan, nan, 1., 1., 1., 4., nan, 5., nan, nan],
        [4., 5., nan, nan, nan, 3., nan, 3., 1., 3.],
        [2., 3., 4., nan, nan, 2., 2., 3., 4., nan],
        [nan, 3., 5., 2., nan, 5., 1., nan, nan, nan],
        [4., 1., nan, nan, 5., nan, nan, nan, nan, 2.],
        [nan, nan, nan, nan, 2., nan, 3., nan, 3., nan],
        [3., nan, nan, 1., nan, 5., nan, nan, 2., nan],
        [nan, nan, nan, nan, 5., nan, nan, 4., 3., 1.],
        [nan, 4., 3., nan, nan, 3., 5., 1., 5., 3.],
        [1., 2., 3., 5., nan, 4., 4., nan, 2., 5.],
        [nan, 2., 2., nan, 1., 2., nan, 2., 4., 1.],
        [nan, 4., nan, nan, 5., 2., nan, 4., 3., nan],
        [5., 2., 5., 1., 3., 5., 2., nan, nan, 4.],
        [nan, nan, nan, nan, nan, nan, 5., nan, 2., 2.],
        [nan, 1., 1., nan, nan, 1., 4., nan, nan, 4.],
        [nan, 4., nan, nan, nan, nan, nan, 4., 4., 5.],
        [5., 4., 1., nan, nan, 5., nan, 3., 2., nan],
        [4., 5., nan, 5., nan, nan, 1., nan, nan, 3.],
        [1., nan, 2., nan, 5., 4., 3., nan, 3., 1.],
        [nan, 3., nan, nan, 5., nan, nan, nan, 5., 2.],
        [nan, 1., 3., nan, nan, nan, nan, nan, nan, nan],
        [1., nan, nan, 5., 1., 5., 2., 5., 3., nan],
        [nan, 2., nan, 5., 2., 4., nan, 4., 2., 5.],
        [nan, 2., 5., 2., 5., nan, nan, nan, nan, nan],
        [1., nan, nan, 4., 4., 3., 3., nan, nan, nan],
        [3., 3., 5., 4., 3., 3., nan, 3., 3., 5.],
        [1., 3., 4., 5., nan, 1., 2., 3., 1., 5.],
        [nan, 3., 1., 5., nan, 4., nan, nan, 2., 1.],
        [nan, 1., 3., 5., 2., nan, 2., 1., 4., 1.],
        [nan, nan, nan, 3., nan, 1., 2., nan, 2., nan],
        [3., nan, nan, nan, nan, 1., 4., 4., 3., nan],
        [1., nan, nan, nan, nan, nan, nan, 1., 5., nan],
        [2., 4., nan, 2., 5., 4., 3., nan, 4., 5.],
        [1., 4., 2., nan, 5., nan, 3., 1., 2., 1.],
        [nan, 2., 4., nan, 3., nan, nan, nan, nan, nan],
        [nan, 3., 3., 3., 1., 1., nan, 2., 3., nan],
        [nan, 2., 5., 3., 2., 1., nan, 4., 2., nan],
        [4., nan, 2., 1., nan, 4., 2., 5., 2., nan],
        [nan, 5., 4., nan, nan, 1., 3., nan, 3., 2.],
        [nan, nan, 4., 3., nan, 2., 4., 5., nan, 3.],
        [nan, nan, 2., 3., nan, nan, 2., 1., nan, 2.],
        [1., 3., 3., 4., 2., 2., nan, nan, 2., nan],
        [3., 5., 3., 2., nan, 5., 1., 1., nan, 2.],
        [4., nan, 2., 3., nan, nan, 5., nan, 5., nan],
        [nan, 1., nan, nan, 1., nan, nan, nan, 2., 4.],
        [5., nan, nan, nan, nan, nan, 1., 4., 4., nan],
        [nan, nan, 1., nan, nan, 5., 5., 4., nan, 2.],
        [nan, 3., 2., 1., 4., 3., nan, nan, 2., 2.],
        [4., nan, 3., nan, nan, 1., nan, nan, nan, nan],
        [nan, nan, nan, 2., 5., 1., 4., 5., nan, nan],
        [nan, 5., 1., nan, nan, nan, nan, nan, nan, 4.]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>A, B, loss <span class="op">=</span> factorize(D, <span class="dv">2</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>tensor(nan, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> <span class="op">~</span>torch.isnan(D)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>mask</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>tensor([[ True, False, False,  True, False, False, False, False, False, False],
        [False, False,  True, False,  True, False,  True,  True,  True,  True],
        [ True,  True,  True, False,  True,  True,  True, False,  True,  True],
        [False, False, False, False, False,  True,  True,  True, False,  True],
        [False, False,  True, False,  True, False,  True, False, False,  True],
        [False,  True,  True, False, False,  True, False, False, False,  True],
        [False, False,  True,  True, False, False, False, False,  True, False],
        [False,  True, False, False,  True, False,  True,  True, False, False],
        [False,  True,  True, False, False, False, False, False, False, False],
        [ True,  True, False, False, False,  True,  True, False, False,  True],
        [ True,  True, False, False,  True,  True, False, False,  True, False],
        [ True,  True, False,  True, False,  True,  True, False,  True,  True],
        [False, False, False, False, False,  True,  True, False,  True, False],
        [False,  True,  True,  True, False,  True,  True, False,  True,  True],
        [False, False, False, False, False,  True,  True,  True, False, False],
        [ True, False, False,  True,  True, False,  True,  True,  True,  True],
        [ True, False, False,  True,  True, False, False,  True,  True, False],
        [ True,  True, False, False,  True, False, False, False,  True,  True],
        [False, False, False, False, False,  True, False,  True,  True, False],
        [ True,  True,  True, False,  True,  True, False, False, False,  True],
        [ True, False, False,  True,  True,  True,  True,  True, False,  True],
        [False,  True, False,  True,  True,  True, False,  True,  True, False],
        [ True, False,  True,  True,  True, False, False,  True, False, False],
        [False, False, False, False, False, False,  True, False,  True,  True],
        [ True, False,  True, False,  True,  True,  True, False,  True, False],
        [ True, False,  True, False,  True, False,  True, False, False, False],
        [ True,  True, False, False,  True,  True,  True,  True,  True,  True],
        [False, False, False, False, False,  True,  True,  True,  True,  True],
        [ True,  True, False,  True,  True, False, False,  True, False, False],
        [ True,  True, False, False, False,  True, False,  True,  True, False],
        [ True, False,  True,  True, False, False,  True,  True, False, False],
        [False,  True,  True, False, False,  True, False, False, False, False],
        [ True,  True,  True, False, False,  True,  True, False, False, False],
        [False, False, False, False,  True, False,  True, False,  True, False],
        [False,  True, False,  True, False, False, False, False, False,  True],
        [False,  True,  True,  True, False,  True,  True, False, False, False],
        [False, False, False, False,  True, False, False,  True, False,  True],
        [False, False, False,  True,  True,  True,  True, False, False,  True],
        [False,  True, False, False, False, False,  True,  True, False, False],
        [False, False,  True,  True,  True,  True,  True,  True, False,  True],
        [ True, False,  True, False, False, False, False,  True,  True, False],
        [False, False, False, False,  True, False,  True, False,  True,  True],
        [False, False, False,  True,  True,  True,  True, False,  True,  True],
        [ True, False,  True, False,  True,  True, False,  True,  True,  True],
        [ True, False,  True, False,  True, False,  True,  True,  True, False],
        [ True, False, False,  True,  True, False, False, False, False,  True],
        [False,  True, False,  True,  True,  True, False,  True,  True, False],
        [False,  True,  True, False, False,  True,  True,  True, False, False],
        [ True,  True,  True,  True, False, False,  True,  True, False,  True],
        [False, False,  True,  True,  True,  True, False,  True, False, False],
        [ True,  True, False, False, False,  True, False,  True,  True,  True],
        [ True,  True,  True, False, False,  True,  True,  True,  True, False],
        [False,  True,  True,  True, False,  True,  True, False, False, False],
        [ True,  True, False, False,  True, False, False, False, False,  True],
        [False, False, False, False,  True, False,  True, False,  True, False],
        [ True, False, False,  True, False,  True, False, False,  True, False],
        [False, False, False, False,  True, False, False,  True,  True,  True],
        [False,  True,  True, False, False,  True,  True,  True,  True,  True],
        [ True,  True,  True,  True, False,  True,  True, False,  True,  True],
        [False,  True,  True, False,  True,  True, False,  True,  True,  True],
        [False,  True, False, False,  True,  True, False,  True,  True, False],
        [ True,  True,  True,  True,  True,  True,  True, False, False,  True],
        [False, False, False, False, False, False,  True, False,  True,  True],
        [False,  True,  True, False, False,  True,  True, False, False,  True],
        [False,  True, False, False, False, False, False,  True,  True,  True],
        [ True,  True,  True, False, False,  True, False,  True,  True, False],
        [ True,  True, False,  True, False, False,  True, False, False,  True],
        [ True, False,  True, False,  True,  True,  True, False,  True,  True],
        [False,  True, False, False,  True, False, False, False,  True,  True],
        [False,  True,  True, False, False, False, False, False, False, False],
        [ True, False, False,  True,  True,  True,  True,  True,  True, False],
        [False,  True, False,  True,  True,  True, False,  True,  True,  True],
        [False,  True,  True,  True,  True, False, False, False, False, False],
        [ True, False, False,  True,  True,  True,  True, False, False, False],
        [ True,  True,  True,  True,  True,  True, False,  True,  True,  True],
        [ True,  True,  True,  True, False,  True,  True,  True,  True,  True],
        [False,  True,  True,  True, False,  True, False, False,  True,  True],
        [False,  True,  True,  True,  True, False,  True,  True,  True,  True],
        [False, False, False,  True, False,  True,  True, False,  True, False],
        [ True, False, False, False, False,  True,  True,  True,  True, False],
        [ True, False, False, False, False, False, False,  True,  True, False],
        [ True,  True, False,  True,  True,  True,  True, False,  True,  True],
        [ True,  True,  True, False,  True, False,  True,  True,  True,  True],
        [False,  True,  True, False,  True, False, False, False, False, False],
        [False,  True,  True,  True,  True,  True, False,  True,  True, False],
        [False,  True,  True,  True,  True,  True, False,  True,  True, False],
        [ True, False,  True,  True, False,  True,  True,  True,  True, False],
        [False,  True,  True, False, False,  True,  True, False,  True,  True],
        [False, False,  True,  True, False,  True,  True,  True, False,  True],
        [False, False,  True,  True, False, False,  True,  True, False,  True],
        [ True,  True,  True,  True,  True,  True, False, False,  True, False],
        [ True,  True,  True,  True, False,  True,  True,  True, False,  True],
        [ True, False,  True,  True, False, False,  True, False,  True, False],
        [False,  True, False, False,  True, False, False, False,  True,  True],
        [ True, False, False, False, False, False,  True,  True,  True, False],
        [False, False,  True, False, False,  True,  True,  True, False,  True],
        [False,  True,  True,  True,  True,  True, False, False,  True,  True],
        [ True, False,  True, False, False,  True, False, False, False, False],
        [False, False, False,  True,  True,  True,  True,  True, False, False],
        [False,  True,  True, False, False, False, False, False, False,  True]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>mask.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>tensor(522)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> torch.randn(D.shape[<span class="dv">0</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> torch.randn(D.shape[<span class="dv">1</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>diff_matrix <span class="op">=</span> torch.mm(A, B.t())<span class="op">-</span>D</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>diff_matrix.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>torch.Size([100, 10])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mask the matrix</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>diff_matrix[mask].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>torch.Size([522])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify the loss function to ignore NaN values</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> factorize(D, k):</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Factorize the matrix D into A and B"""</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Randomly initialize A and B</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> torch.randn(D.shape[<span class="dv">0</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> torch.randn(D.shape[<span class="dv">1</span>], k, requires_grad<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optimizer</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optim.Adam([A, B], lr<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Train the model</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the loss</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>        diff_matrix <span class="op">=</span> torch.mm(A, B.t())<span class="op">-</span>D</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>        diff_vector <span class="op">=</span> diff_matrix[mask]</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> torch.norm(diff_vector)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Zero the gradients</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Backpropagate</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update the parameters</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> A, B, loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>A, B, loss <span class="op">=</span> factorize(D, <span class="dv">5</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>loss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>tensor(8.3795, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>torch.mm(A, B.t())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>tensor([[ 1.0002e+00, -6.1860e-01,  1.6844e+00,  9.9991e-01, -2.2450e+00,
         -4.0025e-01, -9.3873e-01,  4.5819e+00,  8.8804e-01,  2.8812e-01],
        [ 3.4045e+00,  4.3689e+00,  3.4459e+00,  7.1197e+00,  2.2094e+00,
          3.5827e+00,  6.9298e-01,  3.9435e+00,  3.7188e+00,  3.8646e+00],
        [ 1.8525e+00,  3.5934e+00,  2.3619e+00,  6.9679e+00,  2.2771e+00,
          3.0910e+00,  6.2187e-01,  7.6504e-01,  2.4307e+00,  4.5831e+00],
        [ 2.5042e+00,  2.7107e+00,  2.6498e+00,  1.0070e+00,  3.5360e+00,
          4.0030e+00,  2.0012e+00,  2.9972e+00,  2.6560e+00,  3.0001e+00],
        [-2.0035e+00, -7.5789e-01,  4.0035e+00, -2.6083e+00,  2.0150e+00,
         -3.2294e+00,  3.9778e+00,  1.5164e+00,  2.0601e+00,  1.9979e+00],
        [ 3.3313e+00,  5.0005e+00,  2.9979e+00,  1.9324e+00,  6.2719e+00,
          5.0010e+00,  3.4474e+00,  1.9747e+00,  3.9212e+00,  3.0002e+00],
        [ 2.4918e+00, -8.6924e-01,  2.9974e+00,  3.9993e+00, -3.6196e+00,
          3.3461e+00, -2.6180e+00,  7.8752e+00,  1.0047e+00,  4.7184e+00],
        [ 4.0137e+00,  5.0133e+00, -3.1814e-01,  5.7423e-01,  1.9839e+00,
         -1.9341e+00,  1.0108e+00,  2.9967e+00,  3.5993e+00, -8.8937e+00],
        [ 1.8884e+00,  3.0018e+00,  1.9986e+00,  3.6214e+00,  1.3445e+00,
         -8.3828e-02,  9.5663e-01,  2.3653e+00,  2.7723e+00, -3.0290e-01],
        [ 3.0752e+00,  9.4665e-01,  4.2899e+00, -4.5431e+00,  2.8226e+00,
          2.9628e+00,  3.0004e+00,  8.1094e+00,  3.4849e+00,  1.0188e+00],
        [ 2.9752e+00,  3.0103e+00, -1.8524e+00,  5.1349e-01,  9.8893e-01,
          1.0100e+00, -6.7139e-01,  6.4309e-01,  1.0123e+00, -5.1665e+00],
        [ 2.4924e+00,  1.6909e+00,  6.5299e+00,  2.1961e+00,  1.5871e+00,
          1.9187e+00,  2.5060e+00,  8.5766e+00,  4.5608e+00,  4.9586e+00],
        [ 3.7808e+00,  5.4975e+00,  4.4300e+00,  7.1002e+00,  3.5630e+00,
          2.9987e+00,  1.9959e+00,  4.5226e+00,  5.0039e+00,  3.2930e+00],
        [ 4.1509e+00,  2.9077e+00,  4.4567e+00,  1.6394e+00,  1.6263e+00,
          2.7120e+00,  1.4758e+00,  8.4248e+00,  4.3598e+00,  1.2115e+00],
        [ 1.3388e+00,  2.8519e+00,  3.6300e+00, -2.3746e-01,  5.0226e+00,
          2.0026e+00,  3.9996e+00,  1.9982e+00,  3.3924e+00,  2.7614e+00],
        [ 2.0062e+00,  3.4421e+00,  3.3045e+00,  3.3703e+00,  4.1875e+00,
          3.7794e+00,  2.4669e+00,  1.8015e+00,  3.0830e+00,  4.6786e+00],
        [ 1.9932e+00,  5.4306e+00,  2.6564e+00,  3.9896e+00,  2.9713e+00,
         -4.4742e+00,  3.0714e+00,  1.9850e+00,  5.0565e+00, -5.1447e+00],
        [ 9.7504e-01,  5.0209e+00,  5.1434e+00,  7.9740e+00,  4.0114e+00,
         -8.0306e-01,  3.5290e+00,  1.2679e+00,  4.9996e+00,  4.0012e+00],
        [ 2.9039e+00,  4.2371e+00,  5.1783e+00,  1.4304e+01, -6.2558e-01,
          2.9950e+00, -1.1585e+00,  4.9986e+00,  4.0041e+00,  8.1423e+00],
        [ 2.8765e+00,  3.6266e+00,  3.5521e+00,  3.5769e+00,  3.3101e+00,
          3.4339e+00,  1.9543e+00,  3.7925e+00,  3.5855e+00,  3.3947e+00],
        [ 3.1678e+00,  4.4892e+00,  4.0685e+00,  4.2476e+00,  3.7637e+00,
          2.5998e+00,  2.4894e+00,  4.1890e+00,  4.4521e+00,  2.5758e+00],
        [ 4.6850e+00,  5.1159e+00, -1.6040e+00,  2.1407e+00,  2.4447e+00,
          2.7884e+00, -4.1521e-01,  1.3369e+00,  2.1819e+00, -5.2731e+00],
        [ 4.3464e+00,  4.2727e+00,  1.2831e+00,  9.1247e-01,  4.8015e+00,
          6.7635e+00,  1.5292e+00,  2.7263e+00,  2.6805e+00,  1.8472e+00],
        [ 5.0499e+00,  3.7718e+00,  3.2828e+00,  1.8760e+00,  2.4281e+00,
          4.7329e+00,  9.9891e-01,  7.4524e+00,  4.0032e+00,  1.0007e+00],
        [ 3.1683e+00, -4.8069e+00,  4.1563e+00, -2.2212e+01,  3.1175e+00,
          4.8951e+00,  4.9131e+00,  1.3957e+01,  1.7452e+00, -2.0775e+00],
        [ 4.9331e+00,  9.8587e+00,  2.0322e+00,  6.3511e+00,  1.1053e+00,
         -1.3336e+01,  2.8553e+00,  5.8145e+00,  8.9757e+00, -1.9562e+01],
        [ 9.5013e-01,  2.2910e+00,  4.5609e+00,  2.4319e+00,  3.0765e+00,
          8.9028e-01,  3.0615e+00,  3.1779e+00,  3.5110e+00,  4.0518e+00],
        [ 1.5621e+00,  3.5200e-01,  2.2187e+00, -6.1495e-01,  2.0550e+00,
          5.0016e+00,  1.0059e+00,  3.0014e+00,  9.9065e-01,  5.0016e+00],
        [ 1.0132e+00,  9.9005e-01,  2.9984e+00,  3.0045e+00,  2.0013e+00,
          4.6599e+00,  9.4810e-01,  1.9943e+00,  1.3488e+00,  7.2230e+00],
        [ 1.0710e+00,  3.9048e+00,  7.0985e+00,  9.8046e+00,  2.7144e+00,
          9.9892e-01,  2.8371e+00,  3.9444e+00,  5.1068e+00,  8.5642e+00],
        [ 2.9798e+00,  6.6238e+00,  3.9980e+00,  1.9979e+00,  4.8557e+00,
         -4.9116e+00,  4.9889e+00,  4.0151e+00,  6.8644e+00, -6.7965e+00],
        [ 2.6444e+00,  5.0009e+00,  1.9984e+00,  8.4371e+00,  3.1761e+00,
          4.0003e+00,  5.9719e-01,  1.1233e-01,  2.8453e+00,  4.3426e+00],
        [ 4.9523e+00,  5.0456e+00,  9.8821e-01,  1.1904e+00,  2.4383e+00,
          1.0191e+00,  1.0017e+00,  5.0290e+00,  4.0249e+00, -5.5541e+00],
        [ 1.2343e+00,  2.6635e+00,  6.2834e+00,  2.4751e+00,  2.9971e+00,
         -8.9346e-01,  3.9848e+00,  5.6039e+00,  5.0170e+00,  3.1984e+00],
        [ 7.3295e+00,  4.9896e+00,  3.0382e+00,  2.0068e+00,  4.8380e+00,
          1.1694e+01,  7.3273e-01,  7.9437e+00,  3.8515e+00,  4.9996e+00],
        [-8.1543e-01,  3.9929e+00,  1.9948e+00,  2.0048e+00,  7.6522e+00,
          2.0035e+00,  5.0092e+00, -5.3936e+00,  2.2828e+00,  4.6745e+00],
        [ 2.4622e+00,  5.9762e+00,  5.4107e+00,  9.1516e+00,  4.0038e+00,
          6.4204e-01,  3.0174e+00,  2.9985e+00,  5.6616e+00,  3.9994e+00],
        [ 5.2110e+00,  5.8611e+00,  2.4634e+00,  5.0137e+00,  3.8820e+00,
          5.0464e+00,  1.1397e+00,  4.4904e+00,  4.2950e+00,  9.7386e-01],
        [ 4.5880e-01,  1.0057e+00,  1.2943e+00, -5.0455e+00,  1.2572e+00,
         -5.5712e+00,  2.9910e+00,  2.9993e+00,  2.6805e+00, -7.6303e+00],
        [ 1.7154e+00,  2.7432e+00,  2.2357e+00,  2.1176e+00,  4.0797e+00,
          4.5664e+00,  2.0245e+00,  7.0967e-01,  2.0460e+00,  4.6899e+00],
        [ 2.9886e+00,  1.6741e+00,  9.7626e-01, -4.9624e+00,  3.2646e+00,
          2.9619e+00,  2.0996e+00,  4.0057e+00,  2.0244e+00, -2.1930e+00],
        [-2.9729e+00,  3.1319e-01,  3.7236e+00,  3.3254e+00,  1.0136e+00,
         -5.0190e+00,  2.9824e+00, -1.2713e+00,  1.9980e+00,  2.9977e+00],
        [ 1.5646e+00,  2.5216e+00,  3.5026e+00,  1.0177e+00,  4.0812e+00,
          2.9980e+00,  2.9738e+00,  2.3976e+00,  2.9533e+00,  3.9814e+00],
        [ 1.1377e+00, -7.9534e-02,  3.6606e+00, -1.7493e+00,  1.0072e+00,
          1.0560e+00,  1.8801e+00,  5.4316e+00,  2.2340e+00,  2.2851e+00],
        [ 2.7395e+00,  4.2341e+00,  5.3765e+00,  8.3817e+00,  2.5022e+00,
          3.1207e+00,  1.6137e+00,  4.6686e+00,  4.5147e+00,  6.4826e+00],
        [ 5.0039e+00,  5.2292e+00,  5.3792e+00,  4.9980e+00,  3.9950e+00,
          5.0192e+00,  2.3338e+00,  7.4932e+00,  5.5430e+00,  4.0016e+00],
        [ 4.1034e+00,  4.9254e+00,  2.9669e+00,  3.8318e+00,  4.4845e+00,
          5.2453e+00,  1.9372e+00,  3.6188e+00,  3.8836e+00,  2.9346e+00],
        [ 2.7524e+00,  1.9983e+00,  3.0011e+00, -3.2032e+00,  3.8101e+00,
          3.0059e+00,  3.0024e+00,  4.9954e+00,  3.0806e+00,  5.4398e-01],
        [ 1.7170e+00,  3.1087e+00,  4.7616e+00,  3.3576e+00,  2.0605e+00,
         -1.3493e+00,  2.7543e+00,  4.8920e+00,  4.5341e+00,  9.0290e-01],
        [ 4.0465e+00,  2.5043e+00,  9.9836e-01,  1.0001e+00,  9.9855e-01,
          4.0019e+00, -3.8940e-01,  5.0006e+00,  2.0672e+00, -4.7615e-01],
        [ 4.3963e+00,  4.6748e+00, -2.2637e-01,  1.9547e+01, -5.7685e+00,
          2.9123e+00, -7.2256e+00,  2.8164e+00,  1.2482e+00,  3.0466e+00],
        [ 1.8831e+00,  3.2841e+00,  4.0538e+00,  4.7681e+00,  2.8000e+00,
          1.9749e+00,  2.0825e+00,  3.1375e+00,  3.5871e+00,  4.1210e+00],
        [ 5.2524e+00,  2.9996e+00,  4.9944e+00,  2.0011e+00,  1.5771e+00,
          5.0016e+00,  1.0100e+00,  1.0275e+01,  4.5709e+00,  2.8167e+00],
        [ 4.0196e+00,  9.7914e-01,  7.6036e+00, -8.5030e+00,  5.0027e+00,
          3.6480e+00,  5.8612e+00,  1.2776e+01,  5.7694e+00,  1.9990e+00],
        [ 6.9952e-01,  4.8144e-01,  4.6375e+00, -1.1169e+00,  1.9977e+00,
          2.8582e-01,  2.9994e+00,  5.0373e+00,  3.0041e+00,  2.9873e+00],
        [ 3.0164e+00,  2.7781e+00,  1.4268e+00,  1.0004e+00,  3.1666e+00,
          4.9979e+00,  1.0501e+00,  2.4987e+00,  1.9833e+00,  2.2796e+00],
        [ 5.7559e+00,  4.9924e+00,  9.6477e-01,  7.2380e-01,  5.0034e+00,
          8.2238e+00,  1.1047e+00,  4.0024e+00,  2.9928e+00,  9.9998e-01],
        [ 1.9086e+00,  4.3765e+00,  3.6471e+00, -1.8230e-02,  7.1279e+00,
          3.0536e+00,  5.0289e+00,  1.0045e+00,  4.0867e+00,  2.8153e+00],
        [ 8.0839e-01,  3.2813e+00,  2.8462e+00,  4.1885e+00,  4.5646e+00,
          3.3629e+00,  2.6508e+00, -7.9362e-01,  2.4387e+00,  5.7568e+00],
        [ 2.1391e+00,  2.7862e+00,  2.0157e+00,  3.7075e+00,  1.4357e+00,
          1.5206e+00,  6.5361e-01,  2.5565e+00,  2.4614e+00,  1.2083e+00],
        [ 3.8541e+00,  3.7919e+00,  1.1576e+00, -4.1922e+00,  4.8565e+00,
          2.1025e+00,  3.1566e+00,  3.8267e+00,  3.4599e+00, -4.4144e+00],
        [ 4.4749e+00,  2.6216e+00,  5.2107e+00,  8.0413e-01,  2.6066e+00,
          5.2284e+00,  1.9287e+00,  9.1641e+00,  4.3544e+00,  3.9514e+00],
        [-6.2355e-01,  2.9661e+00,  1.4762e+00, -1.5889e+00,  7.0237e+00,
          1.1637e+00,  5.0129e+00, -3.9864e+00,  1.9879e+00,  1.9999e+00],
        [-2.0532e+00,  9.4436e-01,  1.0788e+00, -1.5112e+00,  5.2766e+00,
          1.0112e+00,  3.9423e+00, -4.9127e+00,  4.3571e-01,  3.9691e+00],
        [ 2.5509e+00,  3.9951e+00,  4.4605e+00,  7.9626e+00,  1.9209e+00,
          2.3589e+00,  1.1325e+00,  3.9963e+00,  4.0115e+00,  4.9989e+00],
        [ 4.4588e+00,  4.1568e+00,  6.3874e-01,  4.7680e+00,  1.7098e+00,
          5.1372e+00, -8.1905e-01,  3.2126e+00,  2.2777e+00,  8.1924e-01],
        [ 4.0590e+00,  4.8974e+00,  2.2936e+00,  5.0399e+00,  3.7705e+00,
          5.3666e+00,  1.0653e+00,  2.9172e+00,  3.3719e+00,  2.9769e+00],
        [ 1.9058e+00,  2.3902e+00,  1.9088e+00, -2.7564e+00,  5.0644e+00,
          3.5114e+00,  3.3203e+00,  1.5425e+00,  2.3176e+00,  1.2948e+00],
        [ 4.5764e+00,  2.9666e+00,  5.4040e+00, -3.4611e+00,  4.9879e+00,
          4.9381e+00,  4.0789e+00,  9.1713e+00,  5.0415e+00,  2.0002e+00],
        [ 8.1217e-01,  9.9974e-01,  3.0004e+00,  2.8712e+00,  6.2371e-01,
          1.0238e+00,  8.6280e-01,  2.9506e+00,  1.9404e+00,  3.5027e+00],
        [ 8.6320e-01,  5.2823e-01,  6.2913e+00,  5.0601e+00,  1.5222e+00,
          4.8221e+00,  1.6089e+00,  5.2303e+00,  2.7037e+00,  1.1437e+01],
        [ 2.4092e+00,  2.3466e+00,  3.1749e+00,  4.7389e+00,  1.4796e+00,
          4.0645e+00,  4.3717e-01,  3.7633e+00,  2.4378e+00,  5.1463e+00],
        [ 2.9657e+00,  1.9680e+00,  4.9938e+00,  2.0152e+00,  5.0274e+00,
          1.0372e+01,  2.3406e+00,  4.5921e+00,  2.5287e+00,  1.1962e+01],
        [ 9.9360e-01,  2.8139e+00,  4.4274e+00,  4.0010e+00,  4.0218e+00,
          2.9971e+00,  2.9780e+00,  1.7462e+00,  3.2108e+00,  6.5915e+00],
        [ 2.0912e+00,  3.0938e+00,  4.2010e+00,  4.0979e+00,  3.1748e+00,
          3.1397e+00,  2.1953e+00,  3.4810e+00,  3.4843e+00,  5.0422e+00],
        [ 9.0708e-01,  2.1028e+00,  3.8487e+00,  4.9650e+00,  1.5964e+00,
          1.2887e+00,  1.4710e+00,  2.5548e+00,  2.7485e+00,  4.8925e+00],
        [ 3.9220e+00,  3.0327e+00,  9.9923e-01,  4.9932e+00,  4.2979e-02,
          3.9924e+00, -1.4696e+00,  4.1899e+00,  1.9725e+00,  1.0117e+00],
        [-5.1639e-01,  2.2394e+00,  3.5183e+00,  4.6464e+00,  1.2360e+00,
         -3.5196e+00,  2.3021e+00,  9.0593e-01,  3.1064e+00,  1.1263e+00],
        [ 1.6037e+00,  5.1307e+00, -8.8829e-01,  3.0027e+00,  4.9017e+00,
          1.0025e+00,  2.0058e+00, -3.8608e+00,  1.9919e+00, -2.1546e+00],
        [ 2.9648e+00,  2.4034e+00,  1.2029e+00, -7.7679e+00,  4.9274e+00,
          1.0164e+00,  3.9814e+00,  3.9833e+00,  3.0510e+00, -5.3062e+00],
        [ 9.9679e-01,  4.1864e+00,  4.2270e+00, -4.6136e+00,  8.7020e+00,
         -2.4003e-01,  7.5830e+00,  1.0008e+00,  5.0024e+00, -6.6820e-01],
        [ 2.2728e+00,  3.6244e+00,  4.1272e+00,  2.2280e+00,  5.0801e+00,
          4.0399e+00,  3.3965e+00,  2.7825e+00,  3.7393e+00,  4.8698e+00],
        [ 1.6791e+00,  3.3230e+00,  1.9598e+00,  1.0041e-01,  4.8143e+00,
          2.2202e+00,  3.1183e+00,  5.4728e-01,  2.7286e+00,  1.0427e+00],
        [ 3.4507e+00,  1.9917e+00,  4.0081e+00,  4.7036e+00,  3.0002e+00,
          1.0496e+01,  2.8058e-01,  4.6939e+00,  1.8953e+00,  1.1558e+01],
        [ 1.5679e+00,  2.5501e+00,  2.5804e+00,  3.3099e+00,  1.7224e+00,
          7.7095e-01,  1.3122e+00,  2.4241e+00,  2.6655e+00,  1.5801e+00],
        [ 7.8105e-01,  1.4697e+00,  4.6599e+00,  3.0228e+00,  1.8672e+00,
          1.1596e+00,  2.2261e+00,  3.7987e+00,  3.0326e+00,  5.1036e+00],
        [ 3.7187e+00,  3.0509e+00,  2.2057e+00,  7.4038e-01,  2.7456e+00,
          4.1141e+00,  1.2110e+00,  4.7131e+00,  2.9046e+00,  9.1481e-01],
        [ 1.7544e+00,  4.5809e+00,  3.3347e+00,  4.7582e+00,  4.2718e+00,
          9.5751e-01,  2.9658e+00,  1.0462e+00,  3.9560e+00,  2.1825e+00],
        [ 2.8734e+00,  4.2801e+00,  4.8296e+00,  2.8850e+00,  4.4548e+00,
          2.1835e+00,  3.4971e+00,  4.6453e+00,  4.8704e+00,  2.7518e+00],
        [ 1.9752e+00,  3.5589e+00,  2.0709e+00,  2.9926e+00,  3.5946e+00,
          2.4313e+00,  1.9568e+00,  9.7326e-01,  2.7168e+00,  1.9824e+00],
        [ 1.1651e+00,  2.4674e+00,  2.7450e+00,  4.1450e+00,  2.2433e+00,
          1.9527e+00,  1.4024e+00,  1.3823e+00,  2.3369e+00,  3.8748e+00],
        [ 3.2635e+00,  4.4776e+00,  1.8077e+00,  2.3946e+00,  4.9019e+00,
          4.8625e+00,  2.1158e+00,  1.4241e+00,  2.9863e+00,  2.1902e+00],
        [ 3.7890e+00,  7.9927e+00,  1.9485e+00,  2.8839e+00,  7.8015e+00,
          1.0679e+00,  4.6564e+00, -6.0809e-02,  5.5080e+00, -3.2856e+00],
        [-4.0094e+00,  9.9961e-01,  3.7105e+00,  6.7202e+00,  1.0018e+00,
         -6.3401e+00,  2.9366e+00, -3.7277e+00,  1.9999e+00,  3.9998e+00],
        [ 4.9758e+00,  5.6941e+00,  1.3000e+00,  3.4613e+00,  3.1975e+00,
          2.6950e+00,  9.7137e-01,  3.9934e+00,  4.0431e+00, -2.8305e+00],
        [-1.2464e+00, -6.5883e+00,  1.1624e+00, -2.1746e+01,  4.2800e+00,
          5.0436e+00,  4.9288e+00,  3.9156e+00, -2.0051e+00,  1.9364e+00],
        [ 1.7446e+00,  2.9185e+00,  1.7926e+00,  9.9024e-01,  3.9916e+00,
          2.9798e+00,  2.2638e+00,  7.4184e-01,  2.2586e+00,  2.0701e+00],
        [ 3.9972e+00,  6.4872e+00,  2.9988e+00,  1.2683e+01,  8.3564e-01,
          1.0029e+00, -5.6647e-01,  3.3638e+00,  4.6541e+00,  1.3542e+00],
        [ 3.6938e+00,  5.4303e+00,  4.3394e+00,  1.9919e+00,  5.0434e+00,
          9.9244e-01,  3.9476e+00,  5.0027e+00,  5.6507e+00, -7.1759e-01],
        [ 3.2622e+00,  5.0049e+00,  9.9177e-01,  3.6759e+00,  5.8119e+00,
          6.9085e+00,  1.8074e+00, -7.1690e-01,  2.3350e+00,  4.0045e+00]],
       grad_fn=&lt;MmBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now use matrix factorization to predict the ratings</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a class for the model</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MatrixFactorization(nn.Module):</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n_users, n_movies, n_factors<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.user_factors <span class="op">=</span> nn.Embedding(n_users, n_factors)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.movie_factors <span class="op">=</span> nn.Embedding(n_movies, n_factors)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, user, movie):</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="va">self</span>.user_factors(user) <span class="op">*</span> <span class="va">self</span>.movie_factors(movie)).<span class="bu">sum</span>(<span class="dv">1</span>)</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> MatrixFactorization(n_users, n_movies, <span class="dv">2</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>MatrixFactorization(
  (user_factors): Embedding(100, 2)
  (movie_factors): Embedding(10, 2)
)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>model(torch.tensor([<span class="dv">0</span>]), torch.tensor([<span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>tensor([2.0891], grad_fn=&lt;SumBackward1&gt;)</code></pre>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>