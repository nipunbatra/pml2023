<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>ES654</title>
<link>https://github.com/nipunbatra/pml2023/notebooks/index.html</link>
<atom:link href="https://github.com/nipunbatra/pml2023/notebooks/index.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.3.361</generator>
<lastBuildDate>Tue, 25 Apr 2023 00:00:00 GMT</lastBuildDate>
<item>
  <title>SVM Soft Margin</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/svm-soft-margin.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> matplotlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> cm</span>
<span id="cb1-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span></code></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.datasets <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> make_blobs</span></code></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">X, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> make_blobs(centers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, n_samples<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, cluster_std<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>cm.autumn)</span>
<span id="cb4-2">plt.gca().set_aspect(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'equal'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-soft-margin_files/figure-html/cell-5-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> svm</span>
<span id="cb5-2">X_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X</span>
<span id="cb5-3">y_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y</span>
<span id="cb5-4">kernel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'linear'</span></span>
<span id="cb5-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> fig_num, C <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>([<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0001</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10e6</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10e10</span>][:]):</span>
<span id="cb5-6">    clf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> svm.SVC(kernel<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>kernel,C <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> C )</span>
<span id="cb5-7">    clf.fit(X, y)</span>
<span id="cb5-8"></span>
<span id="cb5-9">    plt.figure(fig_num)</span>
<span id="cb5-10">    plt.clf()</span>
<span id="cb5-11">    plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y, zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>plt.cm.autumn,</span>
<span id="cb5-12">                edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>,s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb5-13"></span>
<span id="cb5-14"></span>
<span id="cb5-15">    plt.axis(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tight'</span>)</span>
<span id="cb5-16">    x_min <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb5-17">    x_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb5-18">    y_min <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb5-19">    y_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb5-20"></span>
<span id="cb5-21">    XX, YY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mgrid[x_min:x_max:<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">200j</span>, y_min:y_max:<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">200j</span>]</span>
<span id="cb5-22">    Z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> clf.decision_function(np.c_[XX.ravel(), YY.ravel()])</span>
<span id="cb5-23">   </span>
<span id="cb5-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Put the result into a color plot</span></span>
<span id="cb5-25">    Z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Z.reshape(XX.shape)</span>
<span id="cb5-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#plt.pcolormesh(XX, YY, Z &gt; 0, cmap=plt.cm.autumn, alpha=0.2)</span></span>
<span id="cb5-27"></span>
<span id="cb5-28">    plt.contour(XX, YY, Z, colors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>],</span>
<span id="cb5-29">                linestyles<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'-'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>], levels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb5-30">    plt.scatter(clf.support_vectors_[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],</span>
<span id="cb5-31">                clf.support_vectors_[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb5-32">                s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, lw<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>, facecolors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'none'</span>,zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>, edgecolors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'none'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-33"></span>
<span id="cb5-34"></span>
<span id="cb5-35">    plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Linear Kernel with C= </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> Number of support vectors = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(C, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(clf.support_vectors_)))</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-soft-margin_files/figure-html/cell-6-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-soft-margin_files/figure-html/cell-6-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-soft-margin_files/figure-html/cell-6-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-soft-margin_files/figure-html/cell-6-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-soft-margin_files/figure-html/cell-6-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-soft-margin_files/figure-html/cell-6-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-soft-margin_files/figure-html/cell-6-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-soft-margin_files/figure-html/cell-6-output-8.png" class="img-fluid"></p>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/svm-soft-margin.html</guid>
  <pubDate>Tue, 25 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>SVM with RBF kernel Gamma Factor</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf-gamma.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> matplotlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> cm</span>
<span id="cb1-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span></code></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([</span>
<span id="cb2-2">    [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],</span>
<span id="cb2-3">    [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],</span>
<span id="cb2-4">    [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],</span>
<span id="cb2-5">    [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb2-6">    [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb2-7">    [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],</span>
<span id="cb2-8">    [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],</span>
<span id="cb2-9">    [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],</span>
<span id="cb2-10">    [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb2-11">])</span>
<span id="cb2-12">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span></code></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>cm.Paired)</span>
<span id="cb3-2">plt.gca().set_aspect(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'equal'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf-gamma_files/figure-html/cell-4-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb4-2"></span>
<span id="cb4-3">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(X, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x1'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x2'</span>])</span>
<span id="cb4-4">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y</span>
<span id="cb4-5">df</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x1</th>
<th data-quarto-table-cell-role="th">x2</th>
<th data-quarto-table-cell-role="th">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>-1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>-2</td>
<td>0</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2</td>
<td>0</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>0</td>
<td>-2</td>
<td>-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>0</td>
<td>2</td>
<td>-1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.metrics.pairwise <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> rbf_kernel</span>
<span id="cb5-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> seaborn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sns</span>
<span id="cb5-3"></span>
<span id="cb5-4">gamma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parameter for RBF kernel</span></span>
<span id="cb5-5">K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rbf_kernel(X, gamma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gamma)</span>
<span id="cb5-6">sns.heatmap(K, annot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>cm.viridis)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf-gamma_files/figure-html/cell-6-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">gammas <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb7-2">fig, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb7-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> ax, gamma <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(axes.ravel(), gammas):</span>
<span id="cb7-4">    K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rbf_kernel(X, gamma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gamma)</span>
<span id="cb7-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Annotate to 1 decimal digit and use min = 0.0 and max =1.0</span></span>
<span id="cb7-6">    sns.heatmap(K, annot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>cm.viridis, ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax, fmt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.1f'</span>, vmin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, vmax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>)</span>
<span id="cb7-7">    ax.set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gamma = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(gamma))</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf-gamma_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compare with the linear kernel</span></span>
<span id="cb8-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.metrics.pairwise <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> linear_kernel, polynomial_kernel</span>
<span id="cb8-3"></span>
<span id="cb8-4">K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> linear_kernel(X)</span>
<span id="cb8-5">sns.heatmap(K, annot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>cm.viridis, fmt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.1f'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf-gamma_files/figure-html/cell-8-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compare with the polynomial kernel</span></span>
<span id="cb10-2">K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> polynomial_kernel(X, degree<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb10-3">sns.heatmap(K, annot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>cm.viridis, fmt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.1f'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf-gamma_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf-gamma.html</guid>
  <pubDate>Tue, 25 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>SVM with RBF kernel</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> matplotlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> cm</span>
<span id="cb1-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span></code></pre></div>
</div>
<p>Let us now understand how the gamma parameter works. For that, we will look at a different dataset</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datasets</span>
<span id="cb2-2"></span>
<span id="cb2-3">iris <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datasets.load_iris()</span>
<span id="cb2-4">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> iris.data</span>
<span id="cb2-5">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> iris.target</span>
<span id="cb2-6"></span>
<span id="cb2-7">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, :<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb2-8">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y[y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y, zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>plt.cm.Paired,</span>
<span id="cb3-2">                edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f01db469af0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf_files/figure-html/cell-4-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> svm</span></code></pre></div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> plot_contour(clf, X, y):</span>
<span id="cb6-2">    plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y, zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>plt.cm.Paired,</span>
<span id="cb6-3">                edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb6-4"></span>
<span id="cb6-5"></span>
<span id="cb6-6">    plt.axis(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tight'</span>)</span>
<span id="cb6-7">    x_min <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb6-8">    x_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb6-9">    y_min <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb6-10">    y_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb6-11"></span>
<span id="cb6-12">    XX, YY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mgrid[x_min:x_max:<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">200j</span>, y_min:y_max:<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">200j</span>]</span>
<span id="cb6-13">    Z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> clf.decision_function(np.c_[XX.ravel(), YY.ravel()])</span>
<span id="cb6-14"></span>
<span id="cb6-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Put the result into a color plot</span></span>
<span id="cb6-16">    Z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Z.reshape(XX.shape)</span>
<span id="cb6-17">    plt.pcolormesh(XX, YY, Z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>plt.cm.Paired, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span>
<span id="cb6-18"></span>
<span id="cb6-19">    plt.contour(XX, YY, Z, colors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>],</span>
<span id="cb6-20">                linestyles<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'-'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>], levels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span>])</span></code></pre></div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit linear SVM</span></span>
<span id="cb7-2">clf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> svm.SVC(kernel<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'linear'</span>)</span>
<span id="cb7-3">clf.fit(X, y)</span>
<span id="cb7-4">plot_contour(clf, X, y)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit polynomial SVM of degree 2, 3, 4</span></span>
<span id="cb8-2"></span>
<span id="cb8-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> degree <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>):</span>
<span id="cb8-4">    clf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> svm.SVC(kernel<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'poly'</span>, degree<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>degree)</span>
<span id="cb8-5">    clf.fit(X, y)</span>
<span id="cb8-6">    plt.figure()</span>
<span id="cb8-7">    plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'degree = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(degree))</span>
<span id="cb8-8">    plot_contour(clf, X, y)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf_files/figure-html/cell-8-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf_files/figure-html/cell-8-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf_files/figure-html/cell-8-output-4.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">X_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X</span>
<span id="cb9-2">y_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y</span>
<span id="cb9-3">kernel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rbf'</span></span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Store kernel matrix</span></span>
<span id="cb9-5">kms <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb9-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> fig_num, gamma <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>([<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>]):</span>
<span id="cb9-7">    clf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> svm.SVC(kernel<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>kernel, gamma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gamma)</span>
<span id="cb9-8">    clf.fit(X_train, y_train)</span>
<span id="cb9-9"></span>
<span id="cb9-10">    plt.figure(fig_num)</span>
<span id="cb9-11">    plt.clf()</span>
<span id="cb9-12"> </span>
<span id="cb9-13">    plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(gamma))</span>
<span id="cb9-14">    plot_contour(clf, X_train, y_train)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf_files/figure-html/cell-9-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf_files/figure-html/cell-9-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf_files/figure-html/cell-9-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf_files/figure-html/cell-9-output-6.png" class="img-fluid"></p>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/svm-rbf.html</guid>
  <pubDate>Tue, 25 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>SVM Kernel</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/svm-kernel.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> matplotlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> cm</span>
<span id="cb1-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span></code></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]).reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-2">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span></code></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">plt.scatter(X.flatten(), np.zeros_like(X), c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>cm.Paired)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f8e0b18f490&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-kernel_files/figure-html/cell-4-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> phi(x):</span>
<span id="cb5-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> np.hstack([x, x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span></code></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">phi(X)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>array([[-2,  4],
       [-1,  1],
       [ 0,  0],
       [ 1,  1],
       [ 2,  4],
       [ 3,  9],
       [ 4, 16]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">plt.scatter(phi(X)[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], phi(X)[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y,cmap <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cm.Paired)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f8beb7f5fa0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-kernel_files/figure-html/cell-7-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.svm <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> SVC</span></code></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SVC(C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, kernel<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'linear'</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">c.fit(phi(X), y)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>SVC(C=1, kernel='linear')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">plt.scatter(phi(X)[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], phi(X)[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y, zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, cmap <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>cm.Paired, edgecolors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span>
<span id="cb14-2">x_min <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> phi(X)[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb14-3">x_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> phi(X)[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb14-4">y_min <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> phi(X)[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb14-5">y_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> phi(X)[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb14-6"></span>
<span id="cb14-7">XX, YY <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mgrid[x_min:x_max:<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">200j</span>, y_min:y_max:<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">200j</span>]</span>
<span id="cb14-8">Z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> c.decision_function(np.c_[XX.ravel(), YY.ravel()])</span>
<span id="cb14-9"></span>
<span id="cb14-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Put the result into a color plot</span></span>
<span id="cb14-11">Z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Z.reshape(XX.shape)</span>
<span id="cb14-12">plt.pcolormesh(XX, YY, Z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>plt.cm.Paired, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>)</span>
<span id="cb14-13">plt.contour(XX, YY, Z, colors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>],</span>
<span id="cb14-14">            linestyles<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'-'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>], levels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb14-15">plt.xlabel(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$x_1 = X$"</span>)</span>
<span id="cb14-16">plt.ylabel(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$x_2 = X^2$"</span>)</span>
<span id="cb14-17">plt.title(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"Decision surface: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{:0.1f}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">*x_1 + </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{:0.1f}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">*x_2 + </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{:0.1f}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;"> = 0"</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(c.coef_[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], c.coef_[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c.intercept_[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>Text(0.5, 1.0, 'Decision surface: 1.3*x_1 + -0.7*x_2 + 1.0 = 0')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm-kernel_files/figure-html/cell-11-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit a SVM with polynomial kernel</span></span>
<span id="cb16-2"></span>
<span id="cb16-3">c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SVC(C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, kernel<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'poly'</span>, degree<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb16-4"></span>
<span id="cb16-5">c.fit(X, y)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>SVC(C=1, degree=2, kernel='poly')</code></pre>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/svm-kernel.html</guid>
  <pubDate>Thu, 20 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>SVM</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/svm.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> matplotlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> cm</span>
<span id="cb1-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span></code></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Linearly separable data in 2d</span></span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate data</span></span>
<span id="cb2-4">np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-5">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.r_[np.random.randn(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], np.random.randn(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]]</span>
<span id="cb2-6">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot data</span></span>
<span id="cb2-9">plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>cm.Paired)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f8db31dea00&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm_files/figure-html/cell-3-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit SVM</span></span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.svm <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> SVC</span>
<span id="cb4-3">clf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SVC(kernel<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'linear'</span>)</span>
<span id="cb4-4">clf.fit(X, y)</span>
<span id="cb4-5"></span>
<span id="cb4-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot decision boundary</span></span>
<span id="cb4-7">w <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> clf.coef_[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb4-8">a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>w[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> w[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb4-9">xx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb4-10">yy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> xx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (clf.intercept_[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> w[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb4-11">plt.plot(xx, yy, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k-'</span>)</span>
<span id="cb4-12"></span>
<span id="cb4-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot support vectors</span></span>
<span id="cb4-14">plt.scatter(clf.support_vectors_[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], clf.support_vectors_[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>, facecolors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'none'</span>)</span>
<span id="cb4-15"></span>
<span id="cb4-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot margins</span></span>
<span id="cb4-17">b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> clf.support_vectors_[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb4-18">yy_down <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> xx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (b[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb4-19">b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> clf.support_vectors_[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb4-20">yy_up <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> xx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (b[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb4-21">plt.plot(xx, yy_down, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k--'</span>)</span>
<span id="cb4-22">plt.plot(xx, yy_up, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k--'</span>)</span>
<span id="cb4-23"></span>
<span id="cb4-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot data</span></span>
<span id="cb4-25">plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>cm.Paired)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f8b940742b0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/svm_files/figure-html/cell-4-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Magnitude of w</span></span>
<span id="cb6-2">np.linalg.norm(w)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>1.111010607589106</code></pre>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/svm.html</guid>
  <pubDate>Thu, 20 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>KMeans initialisation</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-init.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span>
<span id="cb1-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>config InlineBackend.figure_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retina'</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.datasets <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> make_blobs</span>
<span id="cb2-2"></span>
<span id="cb2-3">X, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> make_blobs(n_samples<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, centers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, n_features<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>, cluster_std<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>)</span>
<span id="cb2-4">plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'viridis'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-init_files/figure-html/cell-3-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run k-means with 3 clusters with various initializations</span></span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.cluster <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> KMeans</span>
<span id="cb3-4">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb3-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i, init <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'random'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k-means++'</span>]):</span>
<span id="cb3-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> j, random_state <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)):</span>
<span id="cb3-7">        km <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> KMeans(n_clusters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, init<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>init)</span>
<span id="cb3-8">        km.fit(X)</span>
<span id="cb3-9">        y_km <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> km.predict(X)</span>
<span id="cb3-10">        ax[i, j].scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y_km, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'viridis'</span>)</span>
<span id="cb3-11">        ax[i, j].scatter(km.cluster_centers_[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], km.cluster_centers_[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'*'</span>, c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>)</span>
<span id="cb3-12">        ax[i, j].set_title(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'init=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>init<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, random_state=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>random_state<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> inertia=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>km<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>inertia_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb3-13">        </span>
<span id="cb3-14">fig.tight_layout()</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-init_files/figure-html/cell-4-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>We get the same result with different initializations!</p>
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans.png" class="img-fluid"></p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run k-means with 3 clusters with various initializations</span></span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.cluster <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> KMeans</span>
<span id="cb4-4">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb4-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i, init <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'random'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k-means++'</span>]):</span>
<span id="cb4-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> j, random_state <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)):</span>
<span id="cb4-7">        km <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> KMeans(n_clusters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, init<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>init,</span>
<span id="cb4-8">                    n_init<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-9">        km.fit(X)</span>
<span id="cb4-10">        y_km <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> km.predict(X)</span>
<span id="cb4-11">        ax[i, j].scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y_km, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'viridis'</span>)</span>
<span id="cb4-12">        ax[i, j].scatter(km.cluster_centers_[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], km.cluster_centers_[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'*'</span>, c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>)</span>
<span id="cb4-13">        ax[i, j].set_title(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'init=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>init<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, random_state=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>random_state<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> inertia=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>km<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>inertia_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb4-14">        </span>
<span id="cb4-15">fig.tight_layout()      </span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-init_files/figure-html/cell-5-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb5-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb5-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.cluster <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> KMeans</span>
<span id="cb5-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.datasets <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> make_blobs</span>
<span id="cb5-5"></span>
<span id="cb5-6">X, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> make_blobs(n_samples<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, centers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, n_features<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>, cluster_std<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>)</span>
<span id="cb5-7"></span>
<span id="cb5-8">random_inertias <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb5-9">kmeans_inertias <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb5-10"></span>
<span id="cb5-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run KMeans with random initialization and KMeans++ initialization</span></span>
<span id="cb5-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for various number of clusters</span></span>
<span id="cb5-13"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> k <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>):</span>
<span id="cb5-14">    random_inertias.append([])</span>
<span id="cb5-15">    kmeans_inertias.append([])</span>
<span id="cb5-16">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>):</span>
<span id="cb5-17">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print(i, k)</span></span>
<span id="cb5-18">        km_random <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> KMeans(n_clusters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>k, init<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'random'</span>, n_init<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>i)</span>
<span id="cb5-19">        km_kmeans <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> KMeans(n_clusters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>k, init<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k-means++'</span>, n_init<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>i)</span>
<span id="cb5-20">        </span>
<span id="cb5-21">        km_random.fit(X)</span>
<span id="cb5-22">        km_kmeans.fit(X)</span>
<span id="cb5-23">        random_inertias[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].append(km_random.inertia_)</span>
<span id="cb5-24">        kmeans_inertias[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].append(km_kmeans.inertia_)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb6-2">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'random'</span>: np.array(random_inertias).mean(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb6-3">                     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'kmeans++'</span>: np.array(kmeans_inertias).mean(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)},</span>
<span id="cb6-4">                    index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>))</span>
<span id="cb6-5">yerr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'random'</span>: np.array(random_inertias).std(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb6-6">                        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'kmeans++'</span>: np.array(kmeans_inertias).std(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)},</span>
<span id="cb6-7">                          index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>))</span>
<span id="cb6-8">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.plot(kind<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bar'</span>, yerr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>yerr, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), rot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb6-9"></span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-init_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Let us rather work in higher dimensions</span></span>
<span id="cb7-2">X, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> make_blobs(n_samples<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, centers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, n_features<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>, cluster_std<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>)</span>
<span id="cb7-3"></span>
<span id="cb7-4">random_inertias <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb7-5">kmeans_inertias <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run KMeans with random initialization and KMeans++ initialization</span></span>
<span id="cb7-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for various number of clusters</span></span>
<span id="cb7-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> k <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>):</span>
<span id="cb7-10">    random_inertias.append([])</span>
<span id="cb7-11">    kmeans_inertias.append([])</span>
<span id="cb7-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>):</span>
<span id="cb7-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print(i, k)</span></span>
<span id="cb7-14">        km_random <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> KMeans(n_clusters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>k, init<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'random'</span>, n_init<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>i)</span>
<span id="cb7-15">        km_kmeans <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> KMeans(n_clusters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>k, init<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k-means++'</span>, n_init<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>i)</span>
<span id="cb7-16">        </span>
<span id="cb7-17">        km_random.fit(X)</span>
<span id="cb7-18">        km_kmeans.fit(X)</span>
<span id="cb7-19">        random_inertias[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].append(km_random.inertia_)</span>
<span id="cb7-20">        kmeans_inertias[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].append(km_kmeans.inertia_)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'random'</span>: np.array(random_inertias).mean(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb8-2">                     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'kmeans++'</span>: np.array(kmeans_inertias).mean(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)},</span>
<span id="cb8-3">                    index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>))</span>
<span id="cb8-4">yerr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'random'</span>: np.array(random_inertias).std(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb8-5">                        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'kmeans++'</span>: np.array(kmeans_inertias).std(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)},</span>
<span id="cb8-6">                          index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>))</span>
<span id="cb8-7">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.plot(kind<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bar'</span>, yerr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>yerr, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), rot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-init_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-init.html</guid>
  <pubDate>Wed, 19 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Number of clusters in K-means</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-num-clusters.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span>
<span id="cb1-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>config InlineBackend.figure_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retina'</span></span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.datasets <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> make_blobs</span>
<span id="cb1-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.cluster <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> KMeans</span></code></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a dataset with K_dataset clusters</span></span>
<span id="cb2-2">K_dataset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb2-3"></span>
<span id="cb2-4">X, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> make_blobs(n_samples<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, centers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>K_dataset, n_features<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-5"></span>
<span id="cb2-6">plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'viridis'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f8e151bfbb0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-num-clusters_files/figure-html/cell-3-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit k-means with different number of clusters</span></span>
<span id="cb4-2">Ks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb4-3">within_cluster_sums <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb4-4">assignments <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb4-5">centroids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb4-6"></span>
<span id="cb4-7"></span>
<span id="cb4-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> K <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> Ks:</span>
<span id="cb4-9">    kmeans <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> KMeans(n_clusters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>K, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb4-10">    kmeans.fit(X)</span>
<span id="cb4-11">    within_cluster_sums[K] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kmeans.inertia_</span>
<span id="cb4-12">    assignments[K] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kmeans.labels_</span>
<span id="cb4-13">    centroids[K] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kmeans.cluster_centers_</span>
<span id="cb4-14"></span>
<span id="cb4-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the results</span></span>
<span id="cb4-16">pd.Series(within_cluster_sums).plot(marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o'</span>)</span>
<span id="cb4-17">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Number of clusters'</span>)</span>
<span id="cb4-18">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Within-cluster sum of squares'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>Text(0, 0.5, 'Within-cluster sum of squares')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-num-clusters_files/figure-html/cell-4-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot assignments</span></span>
<span id="cb6-2">fig, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb6-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> K, ax <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(Ks, axes.ravel()):</span>
<span id="cb6-4">    ax.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>assignments[K], s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'viridis'</span>)</span>
<span id="cb6-5">    ax.set_title(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'K=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>K<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb6-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mark centroids</span></span>
<span id="cb6-7">    ax.scatter(centroids[K][:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], centroids[K][:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-num-clusters_files/figure-html/cell-5-output-1.png" class="img-fluid"></p>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-num-clusters.html</guid>
  <pubDate>Tue, 18 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Hierarchical Clustering</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/hierarchial-clustering.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span>
<span id="cb1-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>config InlineBackend.figure_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retina'</span></span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.datasets <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> make_blobs</span>
<span id="cb1-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.cluster <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> KMeans</span></code></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a dataset with K_dataset clusters</span></span>
<span id="cb2-2">K_dataset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb2-3"></span>
<span id="cb2-4">X, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> make_blobs(n_samples<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, centers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>K_dataset, n_features<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-5"></span>
<span id="cb2-6">plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'viridis'</span>)</span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Annotate sample number</span></span>
<span id="cb2-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(X.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]):</span>
<span id="cb2-9">    plt.annotate(i, (X[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/hierarchial-clustering_files/figure-html/cell-3-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Show after 1 step of hierarchical clustering</span></span>
<span id="cb3-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.cluster.hierarchy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> dendrogram, linkage</span>
<span id="cb3-3"></span>
<span id="cb3-4">Z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> linkage(X, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'average'</span>)</span>
<span id="cb3-5">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb3-6"></span>
<span id="cb3-7">dendrogram(Z, labels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(X.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]), leaf_rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>, leaf_font_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb3-8">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/hierarchial-clustering_files/figure-html/cell-4-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pairwise distance matrix</span></span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.spatial.distance <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pdist, squareform</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the distance matrix</span></span>
<span id="cb4-5">dist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pdist(X, metric<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'euclidean'</span>)</span>
<span id="cb4-6">dist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> squareform(dist)</span>
<span id="cb4-7">X_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"P</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> np.arange(X.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])]</span>
<span id="cb4-8">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(dist, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>X_index, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>X_index)</span>
<span id="cb4-9">df</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">P0</th>
<th data-quarto-table-cell-role="th">P1</th>
<th data-quarto-table-cell-role="th">P2</th>
<th data-quarto-table-cell-role="th">P3</th>
<th data-quarto-table-cell-role="th">P4</th>
<th data-quarto-table-cell-role="th">P5</th>
<th data-quarto-table-cell-role="th">P6</th>
<th data-quarto-table-cell-role="th">P7</th>
<th data-quarto-table-cell-role="th">P8</th>
<th data-quarto-table-cell-role="th">P9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">P0</td>
<td>0.000000</td>
<td>1.468503</td>
<td>5.849187</td>
<td>1.072565</td>
<td>4.001437</td>
<td>4.311101</td>
<td>5.641206</td>
<td>5.617833</td>
<td>4.732056</td>
<td>1.796596</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">P1</td>
<td>1.468503</td>
<td>0.000000</td>
<td>4.427098</td>
<td>0.911272</td>
<td>3.289419</td>
<td>3.124431</td>
<td>5.879548</td>
<td>4.149512</td>
<td>3.283718</td>
<td>0.332095</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">P2</td>
<td>5.849187</td>
<td>4.427098</td>
<td>0.000000</td>
<td>4.904326</td>
<td>3.705648</td>
<td>2.158345</td>
<td>7.350236</td>
<td>1.347556</td>
<td>1.194950</td>
<td>4.132565</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">P3</td>
<td>1.072565</td>
<td>0.911272</td>
<td>4.904326</td>
<td>0.000000</td>
<td>2.966927</td>
<td>3.253476</td>
<td>5.083095</td>
<td>4.830950</td>
<td>3.843925</td>
<td>1.193839</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">P4</td>
<td>4.001437</td>
<td>3.289419</td>
<td>3.705648</td>
<td>2.966927</td>
<td>0.000000</td>
<td>1.575484</td>
<td>3.691478</td>
<td>4.465344</td>
<td>3.299630</td>
<td>3.257210</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">P5</td>
<td>4.311101</td>
<td>3.124431</td>
<td>2.158345</td>
<td>3.253476</td>
<td>1.575484</td>
<td>0.000000</td>
<td>5.263313</td>
<td>2.910477</td>
<td>1.771561</td>
<td>2.937847</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">P6</td>
<td>5.641206</td>
<td>5.879548</td>
<td>7.350236</td>
<td>5.083095</td>
<td>3.691478</td>
<td>5.263313</td>
<td>0.000000</td>
<td>8.154381</td>
<td>6.982831</td>
<td>6.034281</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">P7</td>
<td>5.617833</td>
<td>4.149512</td>
<td>1.347556</td>
<td>4.830950</td>
<td>4.465344</td>
<td>2.910477</td>
<td>8.154381</td>
<td>0.000000</td>
<td>1.180379</td>
<td>3.821671</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">P8</td>
<td>4.732056</td>
<td>3.283718</td>
<td>1.194950</td>
<td>3.843925</td>
<td>3.299630</td>
<td>1.771561</td>
<td>6.982831</td>
<td>1.180379</td>
<td>0.000000</td>
<td>2.976718</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">P9</td>
<td>1.796596</td>
<td>0.332095</td>
<td>4.132565</td>
<td>1.193839</td>
<td>3.257210</td>
<td>2.937847</td>
<td>6.034281</td>
<td>3.821671</td>
<td>2.976718</td>
<td>0.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> seaborn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sns</span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use lower triangle of matrix</span></span>
<span id="cb5-3">mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros_like(dist, dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>np.bool_)</span>
<span id="cb5-4">mask[np.triu_indices_from(mask)] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb5-5">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make heatmap with seaborn and mask, mentining column and row names</span></span>
<span id="cb5-7">sns.heatmap(dist, mask<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>mask, xticklabels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>X_index, yticklabels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>X_index, annot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'viridis'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/hierarchial-clustering_files/figure-html/cell-6-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine closest clusters </span></span>
<span id="cb7-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (i.e. the two clusters with the smallest distance)</span></span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find the two clusters with the smallest distance ignoring the diagonal</span></span>
<span id="cb7-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (i.e. the distance between a cluster and itself)</span></span>
<span id="cb7-6">np.fill_diagonal(dist, np.inf)</span>
<span id="cb7-7">i, j<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.unravel_index(np.argmin(dist), dist.shape)</span>
<span id="cb7-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(i, j)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1 9</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine the two clusters to a single "point"</span></span>
<span id="cb9-2">X_new <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.vstack([X[i], X[j]])</span>
<span id="cb9-3">new_point_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> &amp; </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>j<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span>
<span id="cb9-4">new_point_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X_new.mean(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb9-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(new_point_name, new_point_value)</span>
<span id="cb9-6"></span>
<span id="cb9-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add new point to the dataset, remove the two old points</span></span>
<span id="cb9-8">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.vstack([X, new_point_value])</span>
<span id="cb9-9">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.delete(X, [i, j], axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb9-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(X.shape)</span>
<span id="cb9-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Update X_index to reflect the new point and the removed points</span></span>
<span id="cb9-12">X_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"P</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [i, j]]</span>
<span id="cb9-13">X_index.append(new_point_name)</span>
<span id="cb9-14"></span>
<span id="cb9-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the distance matrix</span></span>
<span id="cb9-16">dist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pdist(X, metric<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'euclidean'</span>)</span>
<span id="cb9-17">dist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> squareform(dist)</span>
<span id="cb9-18">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(dist, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>X_index, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>X_index)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1 &amp; 9 [1.83183315 4.28894623]
(9, 2)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">df</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">P0</th>
<th data-quarto-table-cell-role="th">P2</th>
<th data-quarto-table-cell-role="th">P3</th>
<th data-quarto-table-cell-role="th">P4</th>
<th data-quarto-table-cell-role="th">P5</th>
<th data-quarto-table-cell-role="th">P6</th>
<th data-quarto-table-cell-role="th">P7</th>
<th data-quarto-table-cell-role="th">P8</th>
<th data-quarto-table-cell-role="th">1 &amp; 9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">P0</td>
<td>0.000000</td>
<td>5.849187</td>
<td>1.072565</td>
<td>4.001437</td>
<td>4.311101</td>
<td>5.641206</td>
<td>5.617833</td>
<td>4.732056</td>
<td>1.632347</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">P2</td>
<td>5.849187</td>
<td>0.000000</td>
<td>4.904326</td>
<td>3.705648</td>
<td>2.158345</td>
<td>7.350236</td>
<td>1.347556</td>
<td>1.194950</td>
<td>4.279144</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">P3</td>
<td>1.072565</td>
<td>4.904326</td>
<td>0.000000</td>
<td>2.966927</td>
<td>3.253476</td>
<td>5.083095</td>
<td>4.830950</td>
<td>3.843925</td>
<td>1.048934</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">P4</td>
<td>4.001437</td>
<td>3.705648</td>
<td>2.966927</td>
<td>0.000000</td>
<td>1.575484</td>
<td>3.691478</td>
<td>4.465344</td>
<td>3.299630</td>
<td>3.269140</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">P5</td>
<td>4.311101</td>
<td>2.158345</td>
<td>3.253476</td>
<td>1.575484</td>
<td>0.000000</td>
<td>5.263313</td>
<td>2.910477</td>
<td>1.771561</td>
<td>3.028025</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">P6</td>
<td>5.641206</td>
<td>7.350236</td>
<td>5.083095</td>
<td>3.691478</td>
<td>5.263313</td>
<td>0.000000</td>
<td>8.154381</td>
<td>6.982831</td>
<td>5.955102</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">P7</td>
<td>5.617833</td>
<td>1.347556</td>
<td>4.830950</td>
<td>4.465344</td>
<td>2.910477</td>
<td>8.154381</td>
<td>0.000000</td>
<td>1.180379</td>
<td>3.985504</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">P8</td>
<td>4.732056</td>
<td>1.194950</td>
<td>3.843925</td>
<td>3.299630</td>
<td>1.771561</td>
<td>6.982831</td>
<td>1.180379</td>
<td>0.000000</td>
<td>3.129577</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1 &amp; 9</td>
<td>1.632347</td>
<td>4.279144</td>
<td>1.048934</td>
<td>3.269140</td>
<td>3.028025</td>
<td>5.955102</td>
<td>3.985504</td>
<td>3.129577</td>
<td>0.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros_like(dist, dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>np.bool_)</span>
<span id="cb12-2">mask[np.triu_indices_from(mask)] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb12-3">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb12-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make heatmap with seaborn and mask, mentining column and row names</span></span>
<span id="cb12-5">sns.heatmap(dist, mask<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>mask, xticklabels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>X_index, yticklabels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>X_index, annot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'viridis'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/hierarchial-clustering_files/figure-html/cell-10-output-2.png" class="img-fluid"></p>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/hierarchial-clustering.html</guid>
  <pubDate>Tue, 18 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Curse of Dimensionality</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span>
<span id="cb1-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>config InlineBackend.figure_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retina'</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span>
<span id="cb2-2">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb2-3">np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get `n` points in 1d space uniformly distributed from 0 to 1</span></span>
<span id="cb2-5">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.uniform(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n)</span>
<span id="cb2-6">plt.scatter(x, np.zeros(n), c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f55f7e71d60&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality_files/figure-html/cell-3-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pick a random test point</span></span>
<span id="cb4-2"></span>
<span id="cb4-3">x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.uniform(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-4"></span>
<span id="cb4-5"></span>
<span id="cb4-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mark the nearest point and farthest point</span></span>
<span id="cb4-7">x_nearest <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x[np.argmin(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_test))]</span>
<span id="cb4-8">x_farthest <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x[np.argmax(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_test))]</span>
<span id="cb4-9"></span>
<span id="cb4-10">plt.scatter(x, np.zeros(n), c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb4-11">plt.scatter(x_test, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'*'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test'</span>)</span>
<span id="cb4-12">plt.scatter(x_nearest, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'g'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'nearest'</span>)</span>
<span id="cb4-13">plt.scatter(x_farthest, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'farthest'</span>)</span>
<span id="cb4-14">plt.legend()</span>
<span id="cb4-15"></span>
<span id="cb4-16">ratio <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_nearest) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_farthest)</span>
<span id="cb4-17"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Ratio of distances: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(ratio))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ratio of distances: [0.040316]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality_files/figure-html/cell-4-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Do the above experiment for 1000 times</span></span>
<span id="cb6-2"></span>
<span id="cb6-3">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb6-4">np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb6-5"></span>
<span id="cb6-6">n_exp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb6-7">ratios <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(n_exp)</span>
<span id="cb6-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_exp):</span>
<span id="cb6-9">    x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.uniform(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n)</span>
<span id="cb6-10">    x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.uniform(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-11">    x_nearest <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x[np.argmin(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_test))]</span>
<span id="cb6-12">    x_farthest <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x[np.argmax(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_test))]</span>
<span id="cb6-13">    ratios[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_nearest) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_farthest)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> seaborn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sns</span>
<span id="cb7-2">sns.displot(ratios, kde<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality_files/figure-html/cell-6-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Repeat the experiment in 2d</span></span>
<span id="cb8-2"></span>
<span id="cb8-3">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb8-4">np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb8-5">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.uniform(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, (n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb8-6">plt.scatter(x[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], x[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f53d91c9a60&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality_files/figure-html/cell-7-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pick a random test point</span></span>
<span id="cb10-2"></span>
<span id="cb10-3">x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.uniform(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mark the nearest point and farthest point</span></span>
<span id="cb10-6">x_nearest <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x[np.argmin(np.linalg.norm(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_test, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))]</span>
<span id="cb10-7">x_farthest <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x[np.argmax(np.linalg.norm(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_test, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))]</span>
<span id="cb10-8"></span>
<span id="cb10-9">plt.scatter(x[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], x[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb10-10">plt.scatter(x_test[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], x_test[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'*'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'test'</span>)</span>
<span id="cb10-11">plt.scatter(x_nearest[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], x_nearest[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'g'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'nearest'</span>)</span>
<span id="cb10-12">plt.scatter(x_farthest[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], x_farthest[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'farthest'</span>)</span>
<span id="cb10-13">plt.legend()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>&lt;matplotlib.legend.Legend at 0x7f53d91456a0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality_files/figure-html/cell-8-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find the ratio of distances between the nearest and farthest points in 1000 experiments</span></span>
<span id="cb12-2"></span>
<span id="cb12-3">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb12-4">np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb12-5"></span>
<span id="cb12-6">ratios_2d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(n_exp)</span>
<span id="cb12-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_exp):</span>
<span id="cb12-8">    x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.uniform(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, (n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb12-9">    x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.uniform(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb12-10">    x_nearest <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x[np.argmin(np.linalg.norm(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_test, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))]</span>
<span id="cb12-11">    x_farthest <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x[np.argmax(np.linalg.norm(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_test, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))]</span>
<span id="cb12-12">    ratios_2d[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.norm(x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_nearest) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> np.linalg.norm(x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_farthest)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">sns.displot(ratios_2d, kde<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, let's do the same experiment in dimensions varying from 1 to 20</span></span>
<span id="cb14-2"></span>
<span id="cb14-3">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb14-4">np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb14-5">n_dim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span></span>
<span id="cb14-6">ratios_nd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((n_exp, n_dim))</span>
<span id="cb14-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_exp):</span>
<span id="cb14-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> d <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n_dim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb14-9">        x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.uniform(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, (n, d))</span>
<span id="cb14-10">        x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.uniform(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, d)</span>
<span id="cb14-11">        x_nearest <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x[np.argmin(np.linalg.norm(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_test, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))]</span>
<span id="cb14-12">        x_farthest <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x[np.argmax(np.linalg.norm(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_test, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))]</span>
<span id="cb14-13">        ratios_nd[i, d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.norm(x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_nearest) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> np.linalg.norm(x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_farthest)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the ratio of distances between the nearest and farthest points in 1000 experiments for each dimension</span></span>
<span id="cb15-2"></span>
<span id="cb15-3">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb15-4">plt.plot(np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n_dim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), np.mean(ratios_nd, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o-'</span>)</span>
<span id="cb15-5">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Dimension'</span>)</span>
<span id="cb15-6">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Ratio of distances'</span>)</span>
<span id="cb15-7">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Ratio of distances between the nearest and farthest points in 1000 experiments for each dimension'</span>)</span>
<span id="cb15-8">plt.ylim(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>(0.0, 1.0)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality_files/figure-html/cell-12-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Let us now see what happens if we have more points in higher dimensions</span></span>
<span id="cb17-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1d space: 10 points</span></span>
<span id="cb17-3"></span>
<span id="cb17-4">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb17-5">np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb17-6">n_dim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb17-7">ratios_nd_more_points <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((n_exp, n_dim))</span>
<span id="cb17-8">num_points <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>]</span>
<span id="cb17-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_exp):</span>
<span id="cb17-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> d <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n_dim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb17-11">        x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.uniform(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, (num_points[d<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], d))</span>
<span id="cb17-12">        x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.uniform(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, d)</span>
<span id="cb17-13">        x_nearest <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x[np.argmin(np.linalg.norm(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_test, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))]</span>
<span id="cb17-14">        x_farthest <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x[np.argmax(np.linalg.norm(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_test, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))]</span>
<span id="cb17-15">        ratios_nd_more_points[i, d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.norm(x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_nearest) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> np.linalg.norm(x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_farthest)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the ratio of distances between the nearest and farthest points in 1000 experiments for each dimension</span></span>
<span id="cb18-2"></span>
<span id="cb18-3">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb18-4">plt.plot(np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n_dim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), np.mean(ratios_nd_more_points, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o-'</span>)</span>
<span id="cb18-5">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Dimension'</span>)</span>
<span id="cb18-6">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Ratio of distances'</span>)</span>
<span id="cb18-7">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Ratio of distances between the nearest and farthest points in 1000 experiments for each dimension'</span>)</span>
<span id="cb18-8">plt.ylim(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>(0.0, 1.0)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality_files/figure-html/cell-14-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now showing how linear regression is affected by curse of dimensionality</span></span>
<span id="cb20-2"></span>
<span id="cb20-3">n_points <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb20-4"></span>
<span id="cb20-5">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.uniform(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, (n_points, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb20-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sort the x values</span></span>
<span id="cb20-7">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sort(x, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb20-8">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, (n_points, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb20-9"></span>
<span id="cb20-10">plt.scatter(x, y)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f53d8f5feb0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality_files/figure-html/cell-15-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Let us fit a linear regression model of degree d</span></span>
<span id="cb22-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.linear_model <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> LinearRegression</span>
<span id="cb22-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.preprocessing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> PolynomialFeatures</span>
<span id="cb22-4"></span>
<span id="cb22-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> fit_linear_regression(x, y, d):</span>
<span id="cb22-6">    poly <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PolynomialFeatures(degree<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>d)</span>
<span id="cb22-7">    x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> poly.fit_transform(x)</span>
<span id="cb22-8">    model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LinearRegression()</span>
<span id="cb22-9">    model.fit(x, y)</span>
<span id="cb22-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> model</span>
<span id="cb22-11"></span>
<span id="cb22-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> plot_linear_regression(x, y, d):</span>
<span id="cb22-13">    model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fit_linear_regression(x, y, d)</span>
<span id="cb22-14">    y_pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.predict(PolynomialFeatures(degree<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>d).fit_transform(x))</span>
<span id="cb22-15">    plt.scatter(x, y)</span>
<span id="cb22-16">    plt.plot(x, y_pred, c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>)</span>
<span id="cb22-17">    plt.show()</span></code></pre></div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1">plot_linear_regression(x, y, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1">plot_linear_regression(x, y, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">plot_linear_regression(x, y, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1">plot_linear_regression(x, y, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, we see that if we increase the number of points, the model will fit better</span></span>
<span id="cb27-2"></span>
<span id="cb27-3">n_points <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb27-4"></span>
<span id="cb27-5">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.uniform(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, (n_points, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb27-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sort the x values</span></span>
<span id="cb27-7">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sort(x, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb27-8">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, (n_points, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb27-9"></span>
<span id="cb27-10">plot_linear_regression(x, y, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality_files/figure-html/cell-21-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1">plot_linear_regression(x, y, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1">plot_linear_regression(x, y, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality_files/figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/curse-dimensionality.html</guid>
  <pubDate>Sun, 16 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Image Segmentation using K-Means Clustering</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span>
<span id="cb1-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>config InlineBackend.figure_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retina'</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>wget https:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span>segment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>anything.com<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>assets<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>gallery<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>AdobeStock_94274587_welsh_corgi_pembroke_CD.jpg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>O dog.jpg</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--2023-04-15 11:58:51--  https://segment-anything.com/assets/gallery/AdobeStock_94274587_welsh_corgi_pembroke_CD.jpg
Resolving segment-anything.com (segment-anything.com)... 108.158.245.28, 108.158.245.33, 108.158.245.84, ...
Connecting to segment-anything.com (segment-anything.com)|108.158.245.28|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 221810 (217K) [image/jpeg]
Saving to: dog.jpg

dog.jpg             100%[===================&gt;] 216.61K   348KB/s    in 0.6s    

2023-04-15 11:58:53 (348 KB/s) - dog.jpg saved [221810/221810]
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read image and convert to RGB</span></span>
<span id="cb4-2">img <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.imread(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'dog.jpg'</span>)</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to [0, 1] range</span></span>
<span id="cb4-5"></span>
<span id="cb4-6">img <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span></span>
<span id="cb4-7"></span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot image</span></span>
<span id="cb4-10">plt.imshow(img)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7efc88822340&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation_files/figure-html/cell-4-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">img.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>(1365, 2048, 3)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.cluster <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> KMeans</span>
<span id="cb8-2"></span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reshape image to 2D array</span></span>
<span id="cb8-4">img_2d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img.reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb8-5">pd.DataFrame(img_2d).describe()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>2.795520e+06</td>
<td>2.795520e+06</td>
<td>2.795520e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>5.542249e-01</td>
<td>4.757675e-01</td>
<td>2.935504e-01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>2.068960e-01</td>
<td>1.844162e-01</td>
<td>1.533922e-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>3.921569e-02</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>3.882353e-01</td>
<td>3.176471e-01</td>
<td>1.647059e-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>5.725490e-01</td>
<td>4.705882e-01</td>
<td>2.666667e-01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>7.294118e-01</td>
<td>6.392157e-01</td>
<td>4.078431e-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">img_2d.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>(2795520, 3)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">np.unique(img_2d, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>).shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>(190571, 3)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit KMeans from scikit-learn (slow!)</span></span>
<span id="cb13-2">kmeans <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> KMeans(n_clusters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>).fit(img_2d)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">kmeans.cluster_centers_, kmeans.labels_</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>(array([[0.59260829, 0.48656705, 0.2670584 ],
        [0.24250138, 0.22963615, 0.12538282],
        [0.8270407 , 0.74152134, 0.54547183],
        [0.71622954, 0.62308534, 0.39023071],
        [0.419752  , 0.3354403 , 0.18325719]]),
 array([1, 1, 1, ..., 4, 4, 4], dtype=int32))</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># instead use FAISS with GPU</span></span>
<span id="cb16-2"></span>
<span id="cb16-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> faiss</span>
<span id="cb16-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set up FAISS index</span></span>
<span id="cb16-5">d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img_2d.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Dimension of the feature vectors</span></span>
<span id="cb16-6">n_clusters <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of clusters</span></span>
<span id="cb16-7">n_gpus <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of GPUs to use</span></span>
<span id="cb16-8"></span>
<span id="cb16-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize a multi-GPU IndexFlatL2 index</span></span>
<span id="cb16-10">index_flat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.IndexFlatL2(d)</span>
<span id="cb16-11">index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.index_cpu_to_all_gpus(index_flat, ngpu<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n_gpus)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">kmeans_gpu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.Clustering(d, n_clusters)</span>
<span id="cb17-2">kmeans_gpu.verbose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb17-3">kmeans_gpu.niter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb17-4">kmeans_gpu.train(img_2d.astype(np.float32), index)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sampling a subset of 1280 / 2795520 for training
Clustering 1280 points in 3D to 5 clusters, redo 1 times, 20 iterations
  Preprocessing in 0.03 s
  Iteration 19 (0.22 s, search 0.00 s): objective=12.4307 imbalance=1.031 nsplit=0       </code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">_, I <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> index.search(img_2d.astype(np.float32), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Search for nearest centroid</span></span>
<span id="cb19-2">cluster_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> I.squeeze()</span></code></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create segmented image using cluster centers frmo sklearn</span></span>
<span id="cb20-2">segmented_img <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kmeans.cluster_centers_[kmeans.labels_]</span>
<span id="cb20-3">segmented_img <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> segmented_img.reshape(img.shape)</span>
<span id="cb20-4"></span>
<span id="cb20-5">centroids_gpu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.vector_float_to_array(kmeans_gpu.centroids).reshape(n_clusters, d)</span>
<span id="cb20-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create segmented image using cluster centers from FAISS</span></span>
<span id="cb20-7">segmented_img_faiss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> centroids_gpu[cluster_ids]</span>
<span id="cb20-8"></span>
<span id="cb20-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot segmented image side by side</span></span>
<span id="cb20-10">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb20-11">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].imshow(segmented_img)</span>
<span id="cb20-12">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].imshow(segmented_img_faiss.reshape(img.shape))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7efa51d55250&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation_files/figure-html/cell-14-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, let's try to segment the image using a different number of clusters using FAISS</span></span>
<span id="cb22-2"></span>
<span id="cb22-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> segment_plot(img, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>):</span>
<span id="cb22-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reshape image to 2D array</span></span>
<span id="cb22-5">    img_2d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img.reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb22-6"></span>
<span id="cb22-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set up FAISS index</span></span>
<span id="cb22-8">    d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img_2d.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Dimension of the feature vectors</span></span>
<span id="cb22-9">    n_clusters <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> k   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of clusters</span></span>
<span id="cb22-10">    n_gpus <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of GPUs to use</span></span>
<span id="cb22-11"></span>
<span id="cb22-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize a multi-GPU IndexFlatL2 index</span></span>
<span id="cb22-13">    index_flat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.IndexFlatL2(d)</span>
<span id="cb22-14">    index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.index_cpu_to_all_gpus(index_flat, ngpu<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n_gpus)</span>
<span id="cb22-15"></span>
<span id="cb22-16">    kmeans_gpu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.Clustering(d, n_clusters)</span>
<span id="cb22-17">    kmeans_gpu.verbose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb22-18">    kmeans_gpu.niter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb22-19">    kmeans_gpu.train(img_2d.astype(np.float32), index)</span>
<span id="cb22-20"></span>
<span id="cb22-21">    _, I <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> index.search(img_2d.astype(np.float32), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Search for nearest centroid</span></span>
<span id="cb22-22">    cluster_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> I.squeeze()</span>
<span id="cb22-23"></span>
<span id="cb22-24">    centroids_gpu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.vector_float_to_array(kmeans_gpu.centroids).reshape(n_clusters, d)</span>
<span id="cb22-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create segmented image using cluster centers from FAISS</span></span>
<span id="cb22-26">    segmented_img_faiss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> centroids_gpu[cluster_ids]</span>
<span id="cb22-27"></span>
<span id="cb22-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot segmented image side by side</span></span>
<span id="cb22-29">    fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb22-30">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].imshow(img)</span>
<span id="cb22-31">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].imshow(segmented_img_faiss.reshape(img.shape))</span>
<span id="cb22-32"></span>
<span id="cb22-33">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the color of each cluster</span></span>
<span id="cb22-34">    fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb22-35">    ax.imshow(centroids_gpu.reshape(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n_clusters, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span>
<span id="cb22-36">    </span></code></pre></div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1">segment_plot(img, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sampling a subset of 512 / 2795520 for training
Clustering 512 points in 3D to 2 clusters, redo 1 times, 20 iterations
  Preprocessing in 0.04 s
  Iteration 19 (0.25 s, search 0.00 s): objective=14.8063 imbalance=1.000 nsplit=0       </code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation_files/figure-html/cell-16-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation_files/figure-html/cell-16-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">segment_plot(img, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sampling a subset of 2560 / 2795520 for training
Clustering 2560 points in 3D to 10 clusters, redo 1 times, 20 iterations
  Preprocessing in 0.04 s
  Iteration 19 (0.03 s, search 0.01 s): objective=13.6225 imbalance=1.202 nsplit=0       </code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation_files/figure-html/cell-17-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation_files/figure-html/cell-17-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Modify segmentation function to mask out all but the given cluster</span></span>
<span id="cb27-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> copy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> deepcopy</span>
<span id="cb27-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> segment_plot_mask(img, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>):</span>
<span id="cb27-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reshape image to 2D array</span></span>
<span id="cb27-5">    img_2d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img.reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb27-6"></span>
<span id="cb27-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set up FAISS index</span></span>
<span id="cb27-8">    d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img_2d.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Dimension of the feature vectors</span></span>
<span id="cb27-9">    n_clusters <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> k   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of clusters</span></span>
<span id="cb27-10">    n_gpus <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of GPUs to use</span></span>
<span id="cb27-11"></span>
<span id="cb27-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize a multi-GPU IndexFlatL2 index</span></span>
<span id="cb27-13">    index_flat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.IndexFlatL2(d)</span>
<span id="cb27-14">    index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.index_cpu_to_all_gpus(index_flat, ngpu<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n_gpus)</span>
<span id="cb27-15"></span>
<span id="cb27-16">    kmeans_gpu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.Clustering(d, n_clusters)</span>
<span id="cb27-17">    kmeans_gpu.verbose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb27-18">    kmeans_gpu.niter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span></span>
<span id="cb27-19">    kmeans_gpu.train(img_2d.astype(np.float32), index)</span>
<span id="cb27-20"></span>
<span id="cb27-21">    _, I <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> index.search(img_2d.astype(np.float32), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Search for nearest centroid</span></span>
<span id="cb27-22">    cluster_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> I.squeeze()</span>
<span id="cb27-23"></span>
<span id="cb27-24">    centroids_gpu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.vector_float_to_array(kmeans_gpu.centroids).reshape(n_clusters, d)</span>
<span id="cb27-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create segmented image using cluster centers from FAISS</span></span>
<span id="cb27-26">    segmented_img_faiss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> centroids_gpu[cluster_ids]</span>
<span id="cb27-27"></span>
<span id="cb27-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot segmented image side by side</span></span>
<span id="cb27-29">    fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb27-30">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].imshow(img)</span>
<span id="cb27-31">    segmented_img_faiss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> segmented_img_faiss.reshape(img.shape)</span>
<span id="cb27-32">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].imshow(segmented_img_faiss)</span>
<span id="cb27-33"></span>
<span id="cb27-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, create another figure with number of cluser columns</span></span>
<span id="cb27-35">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and plot each cluster with mask applied to the original image</span></span>
<span id="cb27-36">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The mask is an alpha channel</span></span>
<span id="cb27-37">    </span>
<span id="cb27-38">    fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n_clusters, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(n_clusters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb27-39">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_clusters):</span>
<span id="cb27-40">        img_masked <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> deepcopy(img_2d)</span>
<span id="cb27-41">        img_masked[cluster_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span></span>
<span id="cb27-42">        ax[i].imshow(img_masked.reshape(img.shape))</span>
<span id="cb27-43">        ax[i].set_title(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Cluster </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb27-44">        ax[i].axis(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'off'</span>)</span>
<span id="cb27-45">    </span>
<span id="cb27-46">    </span>
<span id="cb27-47"></span>
<span id="cb27-48">    </span></code></pre></div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1">img.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>(1365, 2048, 3)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1">mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> segment_plot_mask(img, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sampling a subset of 512 / 2795520 for training
Clustering 512 points in 3D to 2 clusters, redo 1 times, 20 iterations
  Preprocessing in 0.02 s
  Iteration 19 (0.46 s, search 0.00 s): objective=14.8063 imbalance=1.000 nsplit=0       </code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation_files/figure-html/cell-21-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation_files/figure-html/cell-21-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1">mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> segment_plot_mask(img, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sampling a subset of 768 / 2795520 for training
Clustering 768 points in 3D to 3 clusters, redo 1 times, 20 iterations
  Preprocessing in 0.02 s
  Iteration 19 (0.46 s, search 0.00 s): objective=12.5181 imbalance=1.009 nsplit=0       </code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation_files/figure-html/cell-22-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation_files/figure-html/cell-22-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1">mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> segment_plot_mask(img, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sampling a subset of 1024 / 2795520 for training
Clustering 1024 points in 3D to 4 clusters, redo 1 times, 20 iterations
  Preprocessing in 0.02 s
  Iteration 19 (0.15 s, search 0.00 s): objective=12.6442 imbalance=1.031 nsplit=0       </code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation_files/figure-html/cell-23-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation_files/figure-html/cell-23-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, let us segment the image using not only RGB but also the spatial coordinates</span></span>
<span id="cb36-2"></span>
<span id="cb36-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reshape image to 2D array</span></span>
<span id="cb36-4">img_2d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img.reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb36-5"></span>
<span id="cb36-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add spatial coordinates</span></span>
<span id="cb36-7">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(img.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb36-8">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(img.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb36-9"></span>
<span id="cb36-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scale the spatial coordinates to be between a and b</span></span>
<span id="cb36-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> scale(x, a, b):</span>
<span id="cb36-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> (b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>a)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>())<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(x.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>x.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> a</span>
<span id="cb36-13"></span>
<span id="cb36-14">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scale(x, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>)</span>
<span id="cb36-15">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scale(y, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>)</span>
<span id="cb36-16"></span>
<span id="cb36-17">xx, yy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.meshgrid(x, y)</span>
<span id="cb36-18">xx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> xx.reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb36-19">yy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> yy.reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb36-20"></span>
<span id="cb36-21">img_2d_spatial <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.hstack((img_2d, xx, yy))</span>
<span id="cb36-22">pd.DataFrame(img_2d_spatial).describe()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>2.795520e+06</td>
<td>2.795520e+06</td>
<td>2.795520e+06</td>
<td>2.795520e+06</td>
<td>2.795520e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>5.542249e-01</td>
<td>4.757675e-01</td>
<td>2.935504e-01</td>
<td>5.000000e-01</td>
<td>5.000000e-01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>2.068960e-01</td>
<td>1.844162e-01</td>
<td>1.533922e-01</td>
<td>1.444434e-01</td>
<td>1.444081e-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>3.921569e-02</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>2.500000e-01</td>
<td>2.500000e-01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>3.882353e-01</td>
<td>3.176471e-01</td>
<td>1.647059e-01</td>
<td>3.750000e-01</td>
<td>3.750000e-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>5.725490e-01</td>
<td>4.705882e-01</td>
<td>2.666667e-01</td>
<td>5.000000e-01</td>
<td>5.000000e-01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>7.294118e-01</td>
<td>6.392157e-01</td>
<td>4.078431e-01</td>
<td>6.250000e-01</td>
<td>6.250000e-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>7.500000e-01</td>
<td>7.500000e-01</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, modify the segment_plot function to include spatial coordinates</span></span>
<span id="cb37-2"></span>
<span id="cb37-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> segment_plot_spatial(img, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>):</span>
<span id="cb37-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reshape image to 2D array</span></span>
<span id="cb37-5">    img_2d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img.reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb37-6"></span>
<span id="cb37-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add spatial coordinates</span></span>
<span id="cb37-8">    x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(img.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb37-9">    y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(img.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb37-10"></span>
<span id="cb37-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Scale the spatial coordinates to be between a and b</span></span>
<span id="cb37-12">    x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scale(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb37-13">    y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scale(y, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb37-14"></span>
<span id="cb37-15">    xx, yy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.meshgrid(x, y)</span>
<span id="cb37-16">    xx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> xx.reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb37-17">    yy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> yy.reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb37-18"></span>
<span id="cb37-19">    img_2d_spatial <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.hstack((img_2d, xx, yy))</span>
<span id="cb37-20"></span>
<span id="cb37-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set up FAISS index</span></span>
<span id="cb37-22">    d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img_2d_spatial.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Dimension of the feature vectors</span></span>
<span id="cb37-23">    n_clusters <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> k   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of clusters</span></span>
<span id="cb37-24">    n_gpus <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of GPUs to use</span></span>
<span id="cb37-25"></span>
<span id="cb37-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize a multi-GPU IndexFlatL2 index</span></span>
<span id="cb37-27">    index_flat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.IndexFlatL2(d)</span>
<span id="cb37-28">    index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.index_cpu_to_all_gpus(index_flat, ngpu<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n_gpus)</span>
<span id="cb37-29"></span>
<span id="cb37-30">    kmeans_gpu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.Clustering(d, n_clusters)</span>
<span id="cb37-31">    kmeans_gpu.verbose <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb37-32">    kmeans_gpu.niter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>    </span>
<span id="cb37-33">    kmeans_gpu.train(img_2d_spatial.astype(np.float32), index)</span>
<span id="cb37-34"></span>
<span id="cb37-35">    _, I <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> index.search(img_2d_spatial.astype(np.float32), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Search for nearest centroid</span></span>
<span id="cb37-36">    cluster_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> I.squeeze()</span>
<span id="cb37-37"></span>
<span id="cb37-38">    centroids_gpu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.vector_float_to_array(kmeans_gpu.centroids).reshape(n_clusters, d)</span>
<span id="cb37-39">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create segmented image using cluster centers from FAISS with spatial coordinates excluded for plotting</span></span>
<span id="cb37-40">    segmented_img_faiss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> centroids_gpu[cluster_ids, :<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb37-41"></span>
<span id="cb37-42">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot segmented image side by side</span></span>
<span id="cb37-43">    fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb37-44">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].imshow(img)</span>
<span id="cb37-45">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].imshow(segmented_img_faiss.reshape(img.shape))</span>
<span id="cb37-46"></span>
<span id="cb37-47">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, create another figure with number of cluser columns</span></span>
<span id="cb37-48">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and plot each cluster with mask applied to the original image</span></span>
<span id="cb37-49">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The mask is an alpha channel</span></span>
<span id="cb37-50">    </span>
<span id="cb37-51">    fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n_clusters, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(n_clusters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb37-52">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_clusters):</span>
<span id="cb37-53">        img_masked <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> deepcopy(img_2d_spatial[:, :<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> ])</span>
<span id="cb37-54">        img_masked[cluster_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span></span>
<span id="cb37-55">        ax[i].imshow(img_masked.reshape(img.shape))</span>
<span id="cb37-56">        ax[i].set_title(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Cluster </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb37-57">        ax[i].axis(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'off'</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1">segment_plot_spatial(img, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sampling a subset of 512 / 2795520 for training
Clustering 512 points in 5D to 2 clusters, redo 1 times, 20 iterations
  Preprocessing in 0.03 s
  Iteration 19 (0.44 s, search 0.00 s): objective=73.9492 imbalance=1.018 nsplit=0       </code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation_files/figure-html/cell-26-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation_files/figure-html/cell-26-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1">segment_plot_mask(img, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sampling a subset of 512 / 2795520 for training
Clustering 512 points in 3D to 2 clusters, redo 1 times, 20 iterations
  Preprocessing in 0.03 s
  Iteration 19 (0.47 s, search 0.00 s): objective=14.8063 imbalance=1.000 nsplit=0       </code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation_files/figure-html/cell-27-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation_files/figure-html/cell-27-output-3.png" class="img-fluid"></p>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/kmeans-segmentation.html</guid>
  <pubDate>Sun, 16 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Image Completion using Matrix Factorization</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/image-completion.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span>
<span id="cb1-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>config InlineBackend.figure_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retina'</span></span>
<span id="cb1-7"></span>
<span id="cb1-8">img <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.imread(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'dog.jpg'</span>)</span>
<span id="cb1-9">plt.imshow(img)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7f662ba10430&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/image-completion_files/figure-html/cell-2-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to grayscale</span></span>
<span id="cb3-2">img <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img.mean(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb3-3">plt.imshow(img, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7f662b94cfd0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/image-completion_files/figure-html/cell-3-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">img <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span></span>
<span id="cb5-2">plt.imshow(img, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7f662b0c4d60&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/image-completion_files/figure-html/cell-4-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">img.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>(1365, 2048)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># MF code with missing values</span></span>
<span id="cb9-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb9-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.nn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> nn</span>
<span id="cb9-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.nn.functional <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> F</span>
<span id="cb9-5"></span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># INIT WELL!</span></span>
<span id="cb9-7"></span>
<span id="cb9-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> factorize(A, k, niter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-3</span>):</span>
<span id="cb9-9">    n, m <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> A.shape</span>
<span id="cb9-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># If we do not init well, our solution is poor</span></span>
<span id="cb9-11">    W <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(torch.randn(n, k)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>).to(A.device)</span>
<span id="cb9-12">    H <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(torch.randn(k, m)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>).to(A.device)</span>
<span id="cb9-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#W = torch.randn(n, k).to(A.device)</span></span>
<span id="cb9-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#H = torch.randn(k, m).to(A.device)</span></span>
<span id="cb9-15">    W.requires_grad <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb9-16">    H.requires_grad <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb9-17"></span>
<span id="cb9-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mask where A is not missing</span></span>
<span id="cb9-19">    mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>torch.isnan(A).to(A.device)</span>
<span id="cb9-20">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(mask.shape)</span>
<span id="cb9-21"></span>
<span id="cb9-22">    optimizer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.optim.Adam([W, H], lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lr)</span>
<span id="cb9-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(niter):</span>
<span id="cb9-24">        optimizer.zero_grad()</span>
<span id="cb9-25">        Ahat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> W <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> H</span>
<span id="cb9-26">        loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.mse_loss(Ahat[mask], A[mask])</span>
<span id="cb9-27">        loss.backward()</span>
<span id="cb9-28">        optimizer.step()</span>
<span id="cb9-29">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb9-30">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(i, loss.item())</span>
<span id="cb9-31">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> W, H</span></code></pre></div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">device <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.device(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cuda'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> torch.cuda.is_available() <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cpu'</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">A <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.from_numpy(img).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>().to(device)</span>
<span id="cb11-2">W, H <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> factorize(A, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, niter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch.Size([1365, 2048])
0 0.06899718195199966
50 0.010017945431172848
100 0.004583133850246668
150 0.0028046893421560526
200 0.0018594106659293175
250 0.001452349592000246
300 0.00131764798425138
350 0.001272885361686349
400 0.0012544193305075169
450 0.0012451813090592623</code></pre>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">W<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>H</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>tensor([[0.2084, 0.2101, 0.2124,  ..., 0.2132, 0.2165, 0.2187],
        [0.2090, 0.2107, 0.2130,  ..., 0.2131, 0.2163, 0.2185],
        [0.2092, 0.2109, 0.2132,  ..., 0.2119, 0.2150, 0.2171],
        ...,
        [0.3419, 0.3364, 0.3296,  ..., 0.3340, 0.3331, 0.3322],
        [0.3406, 0.3352, 0.3286,  ..., 0.3410, 0.3400, 0.3391],
        [0.3399, 0.3348, 0.3284,  ..., 0.3463, 0.3452, 0.3443]],
       device='cuda:0', grad_fn=&lt;MmBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot reconstructed image</span></span>
<span id="cb15-2">plt.imshow((W <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> H).cpu().detach().numpy(), cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7f655c3dc400&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/image-completion_files/figure-html/cell-10-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, remove a rectangular patch from the image</span></span>
<span id="cb17-2"></span>
<span id="cb17-3">patch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">600</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">600</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">900</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>]</span>
<span id="cb17-4">img_copy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img.copy()</span>
<span id="cb17-5"></span>
<span id="cb17-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># NAN the patch region</span></span>
<span id="cb17-7">img_copy[patch[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]:patch[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], patch[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]: patch[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.NaN</span>
<span id="cb17-8">plt.imshow(img_copy,cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7f655c78f0d0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/image-completion_files/figure-html/cell-11-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">A <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.from_numpy(img_copy).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>().to(device)</span>
<span id="cb19-2">W, H <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> factorize(A, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, niter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch.Size([1365, 2048])
0 0.06408126652240753
50 0.009235438890755177
100 0.004174043890088797
150 0.002459741896018386
200 0.0016036551678553224
250 0.0012612321879714727
300 0.001155527075752616
350 0.0011186705669388175
400 0.0011004399275407195
450 0.001089434023015201</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">plt.imshow((W<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>H).cpu().detach().numpy(), cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7f655c76a730&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/image-completion_files/figure-html/cell-13-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1">A <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.from_numpy(img_copy).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>().to(device)</span>
<span id="cb23-2">W, H <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> factorize(A, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, niter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch.Size([1365, 2048])
0 0.745537519454956
50 0.014033811166882515
100 0.006585388910025358
150 0.0039051645435392857
200 0.0023795326706022024
250 0.0014881007373332977
300 0.0009968953672796488
350 0.0007123255636543036
400 0.0005354612949304283
450 0.0004198925453238189
500 0.0003404634480830282
550 0.00028347159968689084
600 0.0002411041350569576
650 0.00020870099251624197
700 0.0001833428832469508
750 0.00016311286890413612
800 0.0001467068213969469
850 0.00013321208825800568
900 0.00012197894102428108
950 0.0001125385460909456</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">plt.imshow((W<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>H).cpu().detach().numpy(), cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7f655c6cfd00&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/image-completion_files/figure-html/cell-15-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy.ma <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> ma</span>
<span id="cb27-2"></span>
<span id="cb27-3">img_copy_mar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img.copy()</span>
<span id="cb27-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mask 50% of the values</span></span>
<span id="cb27-5">mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.rand(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>img_copy_mar.shape) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb27-6">img_copy_mar[mask] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.NaN</span>
<span id="cb27-7"></span>
<span id="cb27-8">plt.imshow(img_copy_mar, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>, interpolation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'none'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7f655c6be8e0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/image-completion_files/figure-html/cell-16-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1">A <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.from_numpy(img_copy_mar).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>().to(device)</span>
<span id="cb29-2">W, H <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> factorize(A, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, niter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch.Size([1365, 2048])
0 0.06749840080738068
50 0.009521582163870335
100 0.004410044755786657
150 0.0026408638805150986
200 0.00173112191259861
250 0.0013635847717523575
300 0.00121410156134516
350 0.001163529814220965
400 0.00114450475666672
450 0.0011350518325343728</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1">plt.imshow((W<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>H).cpu().detach().numpy(), cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7f655c628cd0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/image-completion_files/figure-html/cell-18-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1">img_copy_mar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img.copy()</span>
<span id="cb33-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mask 95% of the values</span></span>
<span id="cb33-3">mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.rand(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>img_copy_mar.shape) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.90</span></span>
<span id="cb33-4">img_copy_mar[mask] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.NaN</span>
<span id="cb33-5"></span>
<span id="cb33-6">plt.imshow(img_copy_mar, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>, interpolation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'none'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7f655c59c790&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/image-completion_files/figure-html/cell-19-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1">A <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.from_numpy(img_copy_mar).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>().to(device)</span>
<span id="cb35-2">W, H <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> factorize(A, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, niter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-2</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch.Size([1365, 2048])
0 0.1652921885251999
50 0.011481668800115585
100 0.010577931068837643
150 0.00767508614808321
200 0.005586703773587942
250 0.004488078411668539
300 0.0038986506406217813
350 0.003568559419363737
400 0.0033569824881851673
450 0.0032061892561614513</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1">plt.imshow((W<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>H).cpu().detach().numpy(), cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7f655c4ff3d0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/image-completion_files/figure-html/cell-21-output-2.png" class="img-fluid"></p>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/image-completion.html</guid>
  <pubDate>Fri, 14 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Movie Recommendation using KNN and Matrix Factorization</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/movie-recommendation-knn-mf.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span>
<span id="cb1-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>config InlineBackend.figure_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retina'</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate some toy user and movie data</span></span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of users</span></span>
<span id="cb2-4">n_users <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb2-5"></span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of movies</span></span>
<span id="cb2-7">n_movies <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of ratings</span></span>
<span id="cb2-10">n_ratings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb2-11"></span>
<span id="cb2-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate random user ids</span></span>
<span id="cb2-13">user_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.randint(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, n_users, n_ratings)</span>
<span id="cb2-14"></span>
<span id="cb2-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate random movie ids</span></span>
<span id="cb2-16">movie_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.randint(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, n_movies, n_ratings)</span>
<span id="cb2-17"></span>
<span id="cb2-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate random ratings</span></span>
<span id="cb2-19">ratings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.randint(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, n_ratings)</span>
<span id="cb2-20"></span>
<span id="cb2-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a dataframe with the data</span></span>
<span id="cb2-22">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'user_id'</span>: user_ids, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'movie_id'</span>: movie_ids, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rating'</span>: ratings})</span>
<span id="cb2-23"></span>
<span id="cb2-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We should not have any duplicate ratings for the same user and movie</span></span>
<span id="cb2-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Drop any rows that have duplicate user_id and movie_id pairs</span></span>
<span id="cb2-26">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.drop_duplicates([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'user_id'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'movie_id'</span>])</span></code></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">df</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">user_id</th>
<th data-quarto-table-cell-role="th">movie_id</th>
<th data-quarto-table-cell-role="th">rating</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>66</td>
<td>7</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>54</td>
<td>7</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>38</td>
<td>5</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>56</td>
<td>6</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>0</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">987</td>
<td>77</td>
<td>8</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">992</td>
<td>99</td>
<td>3</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">994</td>
<td>8</td>
<td>5</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">998</td>
<td>22</td>
<td>2</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">999</td>
<td>88</td>
<td>9</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>642 rows  3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a user-item matrix</span></span>
<span id="cb4-2"></span>
<span id="cb4-3">A <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.pivot(index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'user_id'</span>, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'movie_id'</span>, values<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rating'</span>)</span>
<span id="cb4-4">A</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">movie_id</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">user_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3.0</td>
<td>4.0</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>1.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4.0</td>
<td>2.0</td>
<td>NaN</td>
<td>1.0</td>
<td>NaN</td>
<td>3.0</td>
<td>3.0</td>
<td>5.0</td>
<td>3.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.0</td>
<td>NaN</td>
<td>NaN</td>
<td>4.0</td>
<td>1.0</td>
<td>5.0</td>
<td>NaN</td>
<td>2.0</td>
<td>NaN</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
<td>2.0</td>
<td>NaN</td>
<td>3.0</td>
<td>NaN</td>
<td>2.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>3.0</td>
<td>NaN</td>
<td>NaN</td>
<td>4.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>2.0</td>
<td>3.0</td>
<td>NaN</td>
<td>1.0</td>
<td>NaN</td>
<td>5.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">96</td>
<td>1.0</td>
<td>2.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">97</td>
<td>3.0</td>
<td>1.0</td>
<td>4.0</td>
<td>NaN</td>
<td>3.0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
<td>5.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">98</td>
<td>5.0</td>
<td>3.0</td>
<td>NaN</td>
<td>NaN</td>
<td>2.0</td>
<td>NaN</td>
<td>1.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99</td>
<td>1.0</td>
<td>5.0</td>
<td>2.0</td>
<td>3.0</td>
<td>NaN</td>
<td>2.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>100 rows  10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fill in the missing values with zeros</span></span>
<span id="cb5-2">A <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> A.fillna(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb5-3"></span>
<span id="cb5-4">A</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">movie_id</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">user_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3.0</td>
<td>4.0</td>
<td>0.0</td>
<td>5.0</td>
<td>5.0</td>
<td>1.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4.0</td>
<td>2.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>3.0</td>
<td>3.0</td>
<td>5.0</td>
<td>3.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>1.0</td>
<td>5.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.0</td>
<td>0.0</td>
<td>4.0</td>
<td>2.0</td>
<td>0.0</td>
<td>3.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0.0</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>4.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>1.0</td>
<td>3.0</td>
<td>1.0</td>
<td>2.0</td>
<td>3.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">96</td>
<td>1.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">97</td>
<td>3.0</td>
<td>1.0</td>
<td>4.0</td>
<td>0.0</td>
<td>3.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">98</td>
<td>5.0</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0.0</td>
<td>1.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99</td>
<td>1.0</td>
<td>5.0</td>
<td>2.0</td>
<td>3.0</td>
<td>0.0</td>
<td>2.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>100 rows  10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cosine similarity between U1 and U2</span></span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># User 1</span></span>
<span id="cb6-4">u1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> A.loc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb6-5"></span>
<span id="cb6-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># User 2</span></span>
<span id="cb6-7">u2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> A.loc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb6-8"></span>
<span id="cb6-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the dot product</span></span>
<span id="cb6-10">dot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.dot(u1, u2)</span>
<span id="cb6-11"></span>
<span id="cb6-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the L2 norm</span></span>
<span id="cb6-13">norm_u1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.norm(u1)</span>
<span id="cb6-14">norm_u2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.norm(u2)</span>
<span id="cb6-15"></span>
<span id="cb6-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the cosine similarity</span></span>
<span id="cb6-17">cos_sim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (norm_u1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm_u2)</span>
<span id="cb6-18">cos_sim</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>0.7174278379758501</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate the cosine similarity between users</span></span>
<span id="cb8-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.metrics.pairwise <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> cosine_similarity</span>
<span id="cb8-3"></span>
<span id="cb8-4">sim_matrix <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cosine_similarity(A)</span>
<span id="cb8-5"></span>
<span id="cb8-6">pd.DataFrame(sim_matrix)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">90</th>
<th data-quarto-table-cell-role="th">91</th>
<th data-quarto-table-cell-role="th">92</th>
<th data-quarto-table-cell-role="th">93</th>
<th data-quarto-table-cell-role="th">94</th>
<th data-quarto-table-cell-role="th">95</th>
<th data-quarto-table-cell-role="th">96</th>
<th data-quarto-table-cell-role="th">97</th>
<th data-quarto-table-cell-role="th">98</th>
<th data-quarto-table-cell-role="th">99</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.000000</td>
<td>0.717428</td>
<td>0.663734</td>
<td>0.565794</td>
<td>0.547289</td>
<td>0.742468</td>
<td>0.539472</td>
<td>0.599021</td>
<td>0.748964</td>
<td>0.523832</td>
<td>...</td>
<td>0.876593</td>
<td>0.593722</td>
<td>0.615664</td>
<td>0.722496</td>
<td>0.783190</td>
<td>0.657754</td>
<td>0.665375</td>
<td>0.446627</td>
<td>0.774667</td>
<td>0.703313</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.717428</td>
<td>1.000000</td>
<td>0.650769</td>
<td>0.591169</td>
<td>0.559964</td>
<td>0.585314</td>
<td>0.300491</td>
<td>0.255039</td>
<td>0.693395</td>
<td>0.500193</td>
<td>...</td>
<td>0.609392</td>
<td>0.313893</td>
<td>0.510454</td>
<td>0.550459</td>
<td>0.624622</td>
<td>0.493197</td>
<td>0.644346</td>
<td>0.476288</td>
<td>0.802740</td>
<td>0.781611</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.663734</td>
<td>0.650769</td>
<td>1.000000</td>
<td>0.758954</td>
<td>0.406780</td>
<td>0.372046</td>
<td>0.416654</td>
<td>0.270593</td>
<td>0.746685</td>
<td>0.560180</td>
<td>...</td>
<td>0.519274</td>
<td>0.322243</td>
<td>0.772529</td>
<td>0.253842</td>
<td>0.712485</td>
<td>0.257761</td>
<td>0.322830</td>
<td>0.283373</td>
<td>0.441886</td>
<td>0.459929</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.565794</td>
<td>0.591169</td>
<td>0.758954</td>
<td>1.000000</td>
<td>0.549030</td>
<td>0.540128</td>
<td>0.671775</td>
<td>0.572892</td>
<td>0.611794</td>
<td>0.489225</td>
<td>...</td>
<td>0.424052</td>
<td>0.586110</td>
<td>0.456327</td>
<td>0.506719</td>
<td>0.715831</td>
<td>0.210494</td>
<td>0.506585</td>
<td>0.492312</td>
<td>0.551652</td>
<td>0.424052</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.547289</td>
<td>0.559964</td>
<td>0.406780</td>
<td>0.549030</td>
<td>1.000000</td>
<td>0.354329</td>
<td>0.304478</td>
<td>0.541185</td>
<td>0.821353</td>
<td>0.202287</td>
<td>...</td>
<td>0.667638</td>
<td>0.527306</td>
<td>0.339913</td>
<td>0.435159</td>
<td>0.582943</td>
<td>0.478699</td>
<td>0.417780</td>
<td>0.450063</td>
<td>0.502836</td>
<td>0.741820</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>0.657754</td>
<td>0.493197</td>
<td>0.257761</td>
<td>0.210494</td>
<td>0.478699</td>
<td>0.519615</td>
<td>0.452602</td>
<td>0.571548</td>
<td>0.551553</td>
<td>0.405674</td>
<td>...</td>
<td>0.564076</td>
<td>0.556890</td>
<td>0.604211</td>
<td>0.682793</td>
<td>0.661382</td>
<td>1.000000</td>
<td>0.412568</td>
<td>0.796715</td>
<td>0.678637</td>
<td>0.693008</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">96</td>
<td>0.665375</td>
<td>0.644346</td>
<td>0.322830</td>
<td>0.506585</td>
<td>0.417780</td>
<td>0.853538</td>
<td>0.359095</td>
<td>0.538977</td>
<td>0.351369</td>
<td>0.191776</td>
<td>...</td>
<td>0.498686</td>
<td>0.640033</td>
<td>0.190421</td>
<td>0.690704</td>
<td>0.682163</td>
<td>0.412568</td>
<td>1.000000</td>
<td>0.280141</td>
<td>0.734105</td>
<td>0.581800</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">97</td>
<td>0.446627</td>
<td>0.476288</td>
<td>0.283373</td>
<td>0.492312</td>
<td>0.450063</td>
<td>0.400743</td>
<td>0.709211</td>
<td>0.532239</td>
<td>0.469979</td>
<td>0.566223</td>
<td>...</td>
<td>0.262641</td>
<td>0.446564</td>
<td>0.501441</td>
<td>0.689500</td>
<td>0.637007</td>
<td>0.796715</td>
<td>0.280141</td>
<td>1.000000</td>
<td>0.659366</td>
<td>0.481508</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">98</td>
<td>0.774667</td>
<td>0.802740</td>
<td>0.441886</td>
<td>0.551652</td>
<td>0.502836</td>
<td>0.844146</td>
<td>0.446610</td>
<td>0.473016</td>
<td>0.617575</td>
<td>0.335738</td>
<td>...</td>
<td>0.546861</td>
<td>0.500390</td>
<td>0.305585</td>
<td>0.673754</td>
<td>0.687116</td>
<td>0.678637</td>
<td>0.734105</td>
<td>0.659366</td>
<td>1.000000</td>
<td>0.600213</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99</td>
<td>0.703313</td>
<td>0.781611</td>
<td>0.459929</td>
<td>0.424052</td>
<td>0.741820</td>
<td>0.527274</td>
<td>0.294579</td>
<td>0.578997</td>
<td>0.732042</td>
<td>0.435869</td>
<td>...</td>
<td>0.818182</td>
<td>0.615435</td>
<td>0.581559</td>
<td>0.645439</td>
<td>0.623673</td>
<td>0.693008</td>
<td>0.581800</td>
<td>0.481508</td>
<td>0.600213</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

<p>100 rows  100 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> seaborn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sns</span>
<span id="cb9-2"></span>
<span id="cb9-3">sns.heatmap(sim_matrix, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Greys'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/movie-recommendation-knn-mf_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find the most similar users to user u </span></span>
<span id="cb11-2"></span>
<span id="cb11-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> k_nearest_neighbors(A, u, k):</span>
<span id="cb11-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Find the k nearest neighbors for user u"""</span></span>
<span id="cb11-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find the index of the user in the matrix</span></span>
<span id="cb11-6">    u_index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> A.index.get_loc(u)</span>
<span id="cb11-7">    </span>
<span id="cb11-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the similarity between the user and all other users</span></span>
<span id="cb11-9">    sim_matrix <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cosine_similarity(A)</span>
<span id="cb11-10"></span>
<span id="cb11-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find the k most similar users</span></span>
<span id="cb11-12">    k_nearest <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.argsort(sim_matrix[u_index])[::<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb11-13">    </span>
<span id="cb11-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Return the user ids</span></span>
<span id="cb11-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> A.index[k_nearest]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">k_nearest_neighbors(A, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>Int64Index([28, 46, 90, 32, 87], dtype='int64', name='user_id')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Show matrix of movie ratings for u and k nearest neighbors</span></span>
<span id="cb14-2"></span>
<span id="cb14-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> show_neighbors(A, u, k):</span>
<span id="cb14-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Show the movie ratings for user u and k nearest neighbors"""</span></span>
<span id="cb14-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the user ids of the k nearest neighbors</span></span>
<span id="cb14-6">    neighbors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> k_nearest_neighbors(A, u, k)</span>
<span id="cb14-7">    </span>
<span id="cb14-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the movie ratings for user u and the k nearest neighbors</span></span>
<span id="cb14-9">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> A.loc[[u] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(neighbors)]</span>
<span id="cb14-10">    </span>
<span id="cb14-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Return the dataframe</span></span>
<span id="cb14-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> df</span></code></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">show_neighbors(A, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">movie_id</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">user_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3.0</td>
<td>4.0</td>
<td>0.0</td>
<td>5.0</td>
<td>5.0</td>
<td>1.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">28</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>4.0</td>
<td>2.0</td>
<td>1.0</td>
<td>4.0</td>
<td>0.0</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>3.0</td>
<td>0.0</td>
<td>2.0</td>
<td>5.0</td>
<td>5.0</td>
<td>1.0</td>
<td>0.0</td>
<td>4.0</td>
<td>2.0</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">90</td>
<td>1.0</td>
<td>5.0</td>
<td>1.0</td>
<td>5.0</td>
<td>2.0</td>
<td>0.0</td>
<td>2.0</td>
<td>4.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
<td>0.0</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">87</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>5.0</td>
<td>4.0</td>
<td>0.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rating for user u for movie 0 is: (4.0 + 3.0) / 2 = 3.5 (Discard 0s)</span></span>
<span id="cb16-2"></span>
<span id="cb16-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> predict_rating(A, u, m, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>):</span>
<span id="cb16-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Predict the rating for user u for movie m"""</span></span>
<span id="cb16-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the user ids of the k nearest neighbors</span></span>
<span id="cb16-6">    neighbors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> k_nearest_neighbors(A, u, k)</span>
<span id="cb16-7">    </span>
<span id="cb16-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the movie ratings for user u and the k nearest neighbors</span></span>
<span id="cb16-9">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> A.loc[[u] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(neighbors)]</span>
<span id="cb16-10">    </span>
<span id="cb16-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the ratings for movie m</span></span>
<span id="cb16-12">    ratings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[m]</span>
<span id="cb16-13">    </span>
<span id="cb16-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate the mean of the ratings</span></span>
<span id="cb16-15">    mean <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ratings[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:][ratings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].mean()</span>
<span id="cb16-16">    </span>
<span id="cb16-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Return the mean</span></span>
<span id="cb16-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> mean</span></code></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">predict_rating(A, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>2.6666666666666665</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now working with real data</span></span>
<span id="cb19-2"></span>
<span id="cb19-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load the data</span></span>
<span id="cb19-4"></span>
<span id="cb19-5">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_excel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mov-rec.xlsx"</span>)</span>
<span id="cb19-6">df.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Timestamp</th>
<th data-quarto-table-cell-role="th">Your name</th>
<th data-quarto-table-cell-role="th">Sholay</th>
<th data-quarto-table-cell-role="th">Swades (We The People)</th>
<th data-quarto-table-cell-role="th">The Matrix (I)</th>
<th data-quarto-table-cell-role="th">Interstellar</th>
<th data-quarto-table-cell-role="th">Dangal</th>
<th data-quarto-table-cell-role="th">Taare Zameen Par</th>
<th data-quarto-table-cell-role="th">Shawshank Redemption</th>
<th data-quarto-table-cell-role="th">The Dark Knight</th>
<th data-quarto-table-cell-role="th">Notting Hill</th>
<th data-quarto-table-cell-role="th">Uri: The Surgical Strike</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2023-04-11 10:58:44.990</td>
<td>Nipun</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2023-04-11 10:59:49.617</td>
<td>Gautam Vashishtha</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>1.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2023-04-11 11:12:44.033</td>
<td>Eshan Gujarathi</td>
<td>4.0</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2023-04-11 11:13:48.674</td>
<td>Sai Krishna Avula</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2023-04-11 11:13:55.658</td>
<td>Ankit Yadav</td>
<td>3.0</td>
<td>3.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Discard the timestamp column</span></span>
<span id="cb20-2"></span>
<span id="cb20-3">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.drop(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Timestamp'</span>, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb20-4"></span>
<span id="cb20-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make the "Your Name" column the index</span></span>
<span id="cb20-6"></span>
<span id="cb20-7">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.set_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Your name'</span>)</span>
<span id="cb20-8">df</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sholay</th>
<th data-quarto-table-cell-role="th">Swades (We The People)</th>
<th data-quarto-table-cell-role="th">The Matrix (I)</th>
<th data-quarto-table-cell-role="th">Interstellar</th>
<th data-quarto-table-cell-role="th">Dangal</th>
<th data-quarto-table-cell-role="th">Taare Zameen Par</th>
<th data-quarto-table-cell-role="th">Shawshank Redemption</th>
<th data-quarto-table-cell-role="th">The Dark Knight</th>
<th data-quarto-table-cell-role="th">Notting Hill</th>
<th data-quarto-table-cell-role="th">Uri: The Surgical Strike</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Your name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Nipun</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gautam Vashishtha</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>1.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Eshan Gujarathi</td>
<td>4.0</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Sai Krishna Avula</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Ankit Yadav</td>
<td>3.0</td>
<td>3.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Dhruv</td>
<td>NaN</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Saatvik Rao</td>
<td>4.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Zeel B Patel</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>NaN</td>
<td>2.0</td>
<td>NaN</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Neel</td>
<td>4.0</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Sachin Jalan</td>
<td>4.0</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>NaN</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Ayush Shrivastava</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">....</td>
<td>4.0</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Hari Hara Sudhan</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Etikikota Hrushikesh</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>1.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Chirag</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>2.0</td>
<td>3.0</td>
<td>4.0</td>
<td>2.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aaryan Darad</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Hetvi Patel</td>
<td>4.0</td>
<td>3.0</td>
<td>2.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Kalash Kankaria</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Rachit Verma</td>
<td>NaN</td>
<td>NaN</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">shriraj</td>
<td>3.0</td>
<td>2.0</td>
<td>5.0</td>
<td>4.0</td>
<td>2.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bhavini Korthi</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4.0</td>
<td>5.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Hitarth Gandhi</td>
<td>3.0</td>
<td>NaN</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Radhika Joglekar</td>
<td>3.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Medhansh Singh</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Arun Mani</td>
<td>NaN</td>
<td>NaN</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Satyam</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Karan Kumar</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">R Yeeshu Dhurandhar</td>
<td>5.0</td>
<td>NaN</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Satyam Gupta</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
<td>NaN</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">rushali</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">shridhar</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Tanvi Jain</td>
<td>4.0</td>
<td>3.0</td>
<td>NaN</td>
<td>NaN</td>
<td>4.0</td>
<td>5.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Manish Prabhubhai Salvi</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>4.0</td>
<td>NaN</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Varun Barala</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Kevin Shah</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Inderjeet</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Gangaram Siddam</td>
<td>4.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aditi</td>
<td>4.0</td>
<td>4.0</td>
<td>NaN</td>
<td>5.0</td>
<td>1.0</td>
<td>3.0</td>
<td>5.0</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Madhuri Awachar</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Anupam</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Jinay</td>
<td>3.0</td>
<td>1.0</td>
<td>4.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Shrutimoy</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aadesh Desai</td>
<td>4.0</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Dhairya</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>5.0</td>
<td>NaN</td>
<td>4.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Rahul C</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">df.index</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>Index(['Nipun', 'Gautam Vashishtha', 'Eshan Gujarathi', 'Sai Krishna Avula',
       'Ankit Yadav ', 'Dhruv', 'Saatvik Rao ', 'Zeel B Patel', 'Neel ',
       'Sachin Jalan ', 'Ayush Shrivastava', '....', 'Hari Hara Sudhan',
       'Etikikota Hrushikesh', 'Chirag', 'Aaryan Darad', 'Hetvi Patel',
       'Kalash Kankaria', 'Rachit Verma', 'shriraj', 'Bhavini Korthi ',
       'Hitarth Gandhi ', 'Radhika Joglekar ', 'Medhansh Singh', 'Arun Mani',
       'Satyam ', 'Karan Kumar ', 'R Yeeshu Dhurandhar', 'Satyam Gupta',
       'rushali', 'shridhar', 'Tanvi Jain ', 'Manish Prabhubhai Salvi ',
       'Varun Barala', 'Kevin Shah ', 'Inderjeet', 'Gangaram Siddam ', 'Aditi',
       'Madhuri Awachar', 'Anupam', 'Jinay', 'Shrutimoy', 'Aadesh Desai',
       'Dhairya', 'Rahul C'],
      dtype='object', name='Your name')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get index for user and movie</span></span>
<span id="cb23-2">user <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Rahul C'</span></span>
<span id="cb23-3"></span>
<span id="cb23-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(user <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> df.index)</span>
<span id="cb23-5"></span>
<span id="cb23-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the movie ratings for user</span></span>
<span id="cb23-7">user_ratings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.loc[user]</span>
<span id="cb23-8">user_ratings</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>Sholay                      3.0
Swades (We The People)      3.0
The Matrix (I)              4.0
Interstellar                4.0
Dangal                      4.0
Taare Zameen Par            4.0
Shawshank Redemption        4.0
The Dark Knight             5.0
Notting Hill                NaN
Uri: The Surgical Strike    NaN
Name: Rahul C, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1">df_copy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.copy()</span>
<span id="cb26-2">df_copy.fillna(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb26-3">show_neighbors(df_copy, user, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sholay</th>
<th data-quarto-table-cell-role="th">Swades (We The People)</th>
<th data-quarto-table-cell-role="th">The Matrix (I)</th>
<th data-quarto-table-cell-role="th">Interstellar</th>
<th data-quarto-table-cell-role="th">Dangal</th>
<th data-quarto-table-cell-role="th">Taare Zameen Par</th>
<th data-quarto-table-cell-role="th">Shawshank Redemption</th>
<th data-quarto-table-cell-role="th">The Dark Knight</th>
<th data-quarto-table-cell-role="th">Notting Hill</th>
<th data-quarto-table-cell-role="th">Uri: The Surgical Strike</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Your name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Rahul C</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Shrutimoy</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>0.0</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Hitarth Gandhi</td>
<td>3.0</td>
<td>0.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">R Yeeshu Dhurandhar</td>
<td>5.0</td>
<td>0.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">shridhar</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Sachin Jalan</td>
<td>4.0</td>
<td>0.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>0.0</td>
<td>3.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1">df.describe()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sholay</th>
<th data-quarto-table-cell-role="th">Swades (We The People)</th>
<th data-quarto-table-cell-role="th">The Matrix (I)</th>
<th data-quarto-table-cell-role="th">Interstellar</th>
<th data-quarto-table-cell-role="th">Dangal</th>
<th data-quarto-table-cell-role="th">Taare Zameen Par</th>
<th data-quarto-table-cell-role="th">Shawshank Redemption</th>
<th data-quarto-table-cell-role="th">The Dark Knight</th>
<th data-quarto-table-cell-role="th">Notting Hill</th>
<th data-quarto-table-cell-role="th">Uri: The Surgical Strike</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>39.000000</td>
<td>32.000000</td>
<td>38.000000</td>
<td>43.000000</td>
<td>45.000000</td>
<td>44.000000</td>
<td>35.000000</td>
<td>40.000000</td>
<td>21.000000</td>
<td>39.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>4.102564</td>
<td>3.718750</td>
<td>4.131579</td>
<td>4.581395</td>
<td>3.644444</td>
<td>3.977273</td>
<td>4.400000</td>
<td>4.250000</td>
<td>3.476190</td>
<td>4.230769</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.753758</td>
<td>0.958304</td>
<td>0.991070</td>
<td>0.793802</td>
<td>1.003529</td>
<td>1.067242</td>
<td>0.976187</td>
<td>1.080123</td>
<td>0.813575</td>
<td>0.902089</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>3.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>2.000000</td>
<td>2.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>4.000000</td>
<td>3.000000</td>
<td>4.000000</td>
<td>4.000000</td>
<td>3.000000</td>
<td>3.000000</td>
<td>4.000000</td>
<td>4.000000</td>
<td>3.000000</td>
<td>4.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>4.000000</td>
<td>4.000000</td>
<td>4.000000</td>
<td>5.000000</td>
<td>4.000000</td>
<td>4.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>3.000000</td>
<td>4.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>5.000000</td>
<td>4.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>4.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>4.000000</td>
<td>5.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
<td>5.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Predict the rating for user u for movie m</span></span>
<span id="cb28-2"></span>
<span id="cb28-3">predict_rating(df_copy, user, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'The Dark Knight'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>4.8</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1">predict_rating(df_copy, user, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Sholay'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>4.4</code></pre>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generic Matrix Factorization (without missing values)</span></span>
<span id="cb32-2"></span>
<span id="cb32-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb32-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.nn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> nn</span>
<span id="cb32-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.nn.functional <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> F</span>
<span id="cb32-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.optim <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> optim</span>
<span id="cb32-7"></span>
<span id="cb32-8"></span>
<span id="cb32-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A is a matrix of size (n_users, n_movies) randomly generated values between 1 and 5</span></span>
<span id="cb32-10">A <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.randint(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, (n_users, n_movies), dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>torch.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>)</span>
<span id="cb32-11">A</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>tensor([[1., 5., 4., 3., 4., 3., 1., 3., 3., 4.],
        [3., 3., 4., 4., 4., 2., 5., 2., 2., 4.],
        [2., 5., 5., 3., 3., 1., 4., 5., 2., 5.],
        [4., 2., 1., 5., 1., 5., 1., 1., 5., 1.],
        [4., 3., 5., 3., 4., 1., 2., 4., 1., 5.],
        [1., 2., 2., 1., 2., 4., 1., 1., 3., 3.],
        [4., 2., 2., 3., 5., 3., 3., 2., 5., 2.],
        [2., 2., 1., 1., 2., 4., 5., 1., 4., 3.],
        [1., 3., 2., 1., 3., 4., 1., 5., 5., 1.],
        [4., 4., 2., 4., 1., 4., 2., 1., 4., 4.],
        [1., 3., 1., 2., 3., 1., 3., 2., 4., 4.],
        [5., 3., 5., 1., 4., 5., 4., 2., 1., 5.],
        [5., 1., 5., 3., 4., 4., 4., 2., 2., 2.],
        [1., 1., 2., 3., 5., 4., 3., 1., 1., 1.],
        [3., 2., 5., 4., 3., 5., 2., 4., 4., 3.],
        [2., 2., 4., 1., 2., 3., 2., 4., 3., 5.],
        [4., 2., 4., 5., 2., 2., 1., 2., 1., 1.],
        [4., 3., 2., 1., 1., 1., 5., 2., 1., 1.],
        [2., 1., 2., 1., 1., 1., 5., 5., 1., 4.],
        [1., 3., 5., 1., 5., 5., 5., 5., 2., 2.],
        [1., 2., 2., 5., 1., 1., 5., 4., 2., 5.],
        [5., 1., 2., 2., 1., 5., 2., 3., 5., 2.],
        [2., 2., 1., 5., 5., 5., 5., 3., 4., 3.],
        [1., 1., 4., 1., 2., 5., 5., 5., 2., 1.],
        [5., 3., 3., 1., 2., 3., 3., 2., 2., 3.],
        [2., 4., 5., 1., 2., 3., 5., 3., 1., 5.],
        [2., 1., 1., 1., 2., 2., 5., 5., 2., 1.],
        [3., 1., 1., 3., 3., 3., 2., 1., 3., 2.],
        [4., 4., 4., 5., 1., 3., 4., 3., 2., 2.],
        [4., 4., 4., 5., 2., 5., 2., 1., 4., 3.],
        [3., 3., 5., 1., 4., 3., 3., 3., 3., 2.],
        [2., 4., 2., 3., 4., 2., 4., 3., 3., 3.],
        [5., 4., 1., 5., 4., 3., 5., 1., 3., 4.],
        [3., 5., 3., 2., 4., 2., 5., 1., 2., 5.],
        [2., 5., 4., 1., 1., 5., 1., 5., 2., 4.],
        [1., 3., 3., 4., 4., 5., 2., 5., 3., 5.],
        [3., 3., 5., 3., 4., 1., 3., 1., 1., 3.],
        [2., 4., 1., 3., 5., 1., 5., 2., 4., 1.],
        [5., 2., 2., 3., 1., 4., 5., 5., 4., 2.],
        [5., 3., 5., 1., 5., 4., 3., 1., 1., 3.],
        [4., 2., 2., 2., 2., 1., 2., 1., 1., 3.],
        [2., 2., 1., 4., 1., 4., 5., 2., 5., 1.],
        [3., 4., 2., 1., 3., 1., 2., 5., 3., 5.],
        [1., 3., 3., 5., 3., 2., 1., 2., 5., 1.],
        [3., 4., 2., 4., 2., 3., 4., 1., 1., 1.],
        [1., 1., 5., 1., 3., 2., 5., 5., 5., 4.],
        [4., 4., 4., 4., 4., 3., 1., 4., 1., 1.],
        [3., 4., 5., 4., 1., 5., 2., 3., 1., 3.],
        [5., 2., 5., 5., 2., 4., 5., 4., 4., 5.],
        [3., 5., 5., 4., 1., 5., 1., 2., 5., 1.],
        [2., 4., 3., 5., 4., 5., 2., 5., 3., 3.],
        [3., 2., 3., 1., 1., 4., 1., 1., 2., 1.],
        [4., 1., 2., 4., 4., 3., 2., 2., 2., 4.],
        [2., 2., 3., 2., 3., 2., 2., 5., 4., 3.],
        [4., 2., 3., 4., 4., 1., 1., 4., 2., 3.],
        [2., 2., 3., 2., 2., 1., 4., 3., 5., 4.],
        [5., 5., 5., 4., 2., 1., 3., 1., 3., 3.],
        [2., 4., 5., 1., 2., 2., 5., 3., 3., 1.],
        [1., 4., 3., 2., 3., 5., 3., 2., 4., 4.],
        [1., 3., 2., 1., 2., 3., 2., 2., 5., 2.],
        [4., 5., 5., 3., 1., 2., 1., 3., 4., 4.],
        [4., 2., 3., 2., 3., 4., 5., 1., 4., 3.],
        [3., 2., 1., 3., 2., 2., 5., 5., 5., 1.],
        [2., 5., 5., 2., 3., 5., 3., 4., 3., 2.],
        [1., 2., 2., 4., 4., 5., 5., 2., 5., 1.],
        [4., 4., 1., 5., 2., 4., 4., 2., 4., 2.],
        [4., 1., 5., 3., 1., 4., 5., 2., 2., 2.],
        [3., 2., 2., 1., 1., 1., 2., 4., 2., 2.],
        [1., 1., 3., 2., 2., 4., 3., 3., 2., 2.],
        [2., 4., 3., 1., 1., 2., 4., 2., 5., 2.],
        [1., 4., 3., 5., 4., 2., 4., 2., 2., 5.],
        [4., 4., 5., 5., 4., 3., 4., 1., 4., 5.],
        [5., 2., 2., 1., 4., 4., 3., 5., 5., 5.],
        [3., 1., 3., 1., 2., 5., 5., 4., 3., 1.],
        [5., 5., 5., 3., 5., 3., 3., 3., 3., 3.],
        [5., 3., 3., 3., 4., 3., 5., 4., 5., 1.],
        [5., 5., 3., 5., 4., 1., 2., 1., 3., 2.],
        [5., 3., 4., 1., 5., 2., 4., 4., 2., 1.],
        [1., 2., 1., 2., 1., 3., 4., 1., 2., 1.],
        [5., 3., 3., 1., 5., 1., 4., 5., 5., 1.],
        [2., 2., 5., 2., 3., 5., 1., 5., 4., 2.],
        [3., 3., 1., 2., 5., 5., 4., 4., 4., 5.],
        [5., 3., 5., 3., 5., 5., 3., 4., 1., 4.],
        [5., 3., 2., 5., 1., 2., 4., 3., 1., 4.],
        [5., 2., 5., 2., 4., 3., 2., 2., 4., 5.],
        [2., 3., 5., 2., 4., 5., 3., 1., 4., 3.],
        [3., 3., 1., 4., 5., 2., 1., 3., 4., 4.],
        [5., 2., 3., 4., 2., 2., 5., 4., 2., 1.],
        [3., 1., 1., 2., 5., 1., 5., 1., 5., 3.],
        [3., 5., 1., 5., 3., 4., 5., 5., 4., 3.],
        [2., 4., 1., 5., 4., 1., 4., 5., 1., 4.],
        [5., 5., 4., 1., 2., 2., 2., 5., 1., 3.],
        [5., 2., 3., 3., 4., 3., 3., 4., 3., 2.],
        [1., 5., 4., 4., 5., 3., 4., 2., 4., 1.],
        [2., 4., 1., 1., 4., 2., 1., 1., 3., 4.],
        [4., 4., 2., 3., 2., 2., 3., 5., 4., 1.],
        [5., 4., 3., 4., 5., 4., 5., 1., 5., 5.],
        [1., 1., 1., 1., 4., 4., 5., 2., 4., 2.],
        [2., 4., 1., 2., 4., 3., 5., 1., 4., 4.],
        [2., 5., 2., 1., 3., 5., 5., 4., 1., 4.]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1">A.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>torch.Size([100, 10])</code></pre>
</div>
</div>
<p>Let us decompose A as WH. W is of shape (n, k) and H is of shape (k, n). We can write the above equation as: A = WH</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Randomly initialize A and B</span></span>
<span id="cb36-2"></span>
<span id="cb36-3">W <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.randn(n_users, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, requires_grad<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb36-4">H <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.randn(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, n_movies, requires_grad<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb36-5"></span>
<span id="cb36-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the loss</span></span>
<span id="cb36-7"></span>
<span id="cb36-8">loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.norm(torch.mm(W, H) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> A)</span>
<span id="cb36-9">loss</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>tensor(110.7991, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1">pd.DataFrame(torch.mm(W, H).detach().numpy())</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-1.733831</td>
<td>2.962563</td>
<td>-0.009936</td>
<td>-0.591927</td>
<td>2.442282</td>
<td>-0.533001</td>
<td>-0.500535</td>
<td>-0.777075</td>
<td>-0.427938</td>
<td>-0.050505</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-1.605388</td>
<td>2.875087</td>
<td>0.171515</td>
<td>-0.770741</td>
<td>2.594427</td>
<td>-0.652586</td>
<td>-0.512620</td>
<td>-0.953935</td>
<td>-0.329276</td>
<td>-0.023146</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.159360</td>
<td>-0.289060</td>
<td>-0.022038</td>
<td>0.082685</td>
<td>-0.266777</td>
<td>0.069192</td>
<td>0.052250</td>
<td>0.101196</td>
<td>0.030828</td>
<td>0.001642</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>-3.637741</td>
<td>4.346515</td>
<td>-2.580031</td>
<td>1.911339</td>
<td>0.407374</td>
<td>1.134387</td>
<td>-0.353923</td>
<td>1.689442</td>
<td>-1.846117</td>
<td>-0.440421</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1.706123</td>
<td>-2.207651</td>
<td>0.978520</td>
<td>-0.611154</td>
<td>-0.617788</td>
<td>-0.328235</td>
<td>0.228982</td>
<td>-0.492014</td>
<td>0.780051</td>
<td>0.176302</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>1.362280</td>
<td>-2.751892</td>
<td>-0.572962</td>
<td>1.180665</td>
<td>-2.989312</td>
<td>0.929992</td>
<td>0.551276</td>
<td>1.363935</td>
<td>0.121039</td>
<td>-0.036218</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">96</td>
<td>1.432943</td>
<td>-1.514237</td>
<td>1.287248</td>
<td>-1.086741</td>
<td>0.338909</td>
<td>-0.685343</td>
<td>0.065700</td>
<td>-1.016967</td>
<td>0.827599</td>
<td>0.208897</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">97</td>
<td>0.381086</td>
<td>0.345669</td>
<td>1.366953</td>
<td>-1.551476</td>
<td>1.978570</td>
<td>-1.084161</td>
<td>-0.261282</td>
<td>-1.599606</td>
<td>0.599750</td>
<td>0.189461</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">98</td>
<td>-3.364117</td>
<td>6.450801</td>
<td>0.942667</td>
<td>-2.333749</td>
<td>6.511645</td>
<td>-1.880903</td>
<td>-1.232884</td>
<td>-2.755594</td>
<td>-0.473888</td>
<td>0.027722</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99</td>
<td>0.877697</td>
<td>-1.631227</td>
<td>-0.175042</td>
<td>0.521516</td>
<td>-1.568212</td>
<td>0.428319</td>
<td>0.302370</td>
<td>0.626961</td>
<td>0.149908</td>
<td>0.002033</td>
</tr>
</tbody>
</table>

<p>100 rows  10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1">pd.DataFrame(A)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
<td>1.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>1.0</td>
<td>4.0</td>
<td>5.0</td>
<td>2.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4.0</td>
<td>2.0</td>
<td>1.0</td>
<td>5.0</td>
<td>1.0</td>
<td>5.0</td>
<td>1.0</td>
<td>1.0</td>
<td>5.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>1.0</td>
<td>2.0</td>
<td>4.0</td>
<td>1.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">95</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>5.0</td>
<td>4.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">96</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>1.0</td>
<td>5.0</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">97</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>2.0</td>
<td>4.0</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">98</td>
<td>2.0</td>
<td>4.0</td>
<td>1.0</td>
<td>2.0</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>1.0</td>
<td>4.0</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>1.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>1.0</td>
<td>4.0</td>
</tr>
</tbody>
</table>

<p>100 rows  10 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optimizer</span></span>
<span id="cb40-2"></span>
<span id="cb40-3">optimizer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> optim.Adam([W, H], lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb40-4"></span>
<span id="cb40-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train the model</span></span>
<span id="cb40-6"></span>
<span id="cb40-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>):</span>
<span id="cb40-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the loss</span></span>
<span id="cb40-9">    loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.norm(torch.mm(W, H) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> A)</span>
<span id="cb40-10">    </span>
<span id="cb40-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Zero the gradients</span></span>
<span id="cb40-12">    optimizer.zero_grad()</span>
<span id="cb40-13">    </span>
<span id="cb40-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Backpropagate</span></span>
<span id="cb40-15">    loss.backward()</span>
<span id="cb40-16">    </span>
<span id="cb40-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Update the parameters</span></span>
<span id="cb40-18">    optimizer.step()</span>
<span id="cb40-19">    </span>
<span id="cb40-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print the loss</span></span>
<span id="cb40-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb40-22">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(loss.item())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>110.79912567138672
108.5261001586914
106.6722412109375
104.86959075927734
102.57525634765625
99.17333984375
94.17224884033203
87.41124725341797
79.23120880126953
70.51470184326172
62.338897705078125
55.442466735839844
50.24897003173828
46.78135681152344
44.567237854003906
43.125022888183594
42.18255615234375
41.56866455078125
41.16780471801758
40.899253845214844
40.70838928222656
40.56161117553711
40.439727783203125
40.33248519897461
40.23463821411133
40.143455505371094
40.05741500854492
39.9755744934082
39.89726638793945
39.82197952270508
39.749305725097656
39.678890228271484
39.610443115234375
39.54371643066406
39.478515625
39.4146842956543
39.35213088989258
39.290809631347656
39.23072052001953
39.17192077636719
39.114505767822266
39.058589935302734
39.00433349609375
38.95188903808594
38.90142059326172
38.85308837890625
38.8070182800293
38.76333999633789
38.722137451171875
38.6834716796875
38.64735412597656
38.61379623413086
38.5827522277832
38.554161071777344
38.527931213378906
38.503971099853516
38.482154846191406
38.46236038208008
38.444454193115234
38.42829132080078
38.41374588012695
38.40068435668945
38.38897705078125
38.378501892089844
38.36914825439453
38.36080551147461
38.35336685180664
38.34674835205078
38.34086608886719
38.33564376831055
38.330997467041016
38.326881408691406
38.3232307434082
38.31999206542969
38.31712341308594
38.314579010009766
38.31232833862305
38.310325622558594
38.308555603027344
38.30698013305664
38.30558776855469
38.30434799194336
38.30324935913086
38.30227279663086
38.301395416259766
38.300621032714844
38.2999267578125
38.29930114746094
38.29874801635742
38.298248291015625
38.29779815673828
38.297393798828125
38.297027587890625
38.29669189453125
38.29639434814453
38.296119689941406
38.295867919921875
38.29563903808594
38.29542922973633
38.29523468017578</code></pre>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1">pd.DataFrame(torch.mm(W, H).detach().numpy()).head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3.622862</td>
<td>3.536414</td>
<td>3.945925</td>
<td>2.985436</td>
<td>2.999869</td>
<td>2.749094</td>
<td>2.605484</td>
<td>2.758482</td>
<td>2.209353</td>
<td>3.361388</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3.622746</td>
<td>3.547434</td>
<td>3.798462</td>
<td>3.133817</td>
<td>3.271342</td>
<td>3.176287</td>
<td>3.221505</td>
<td>3.073355</td>
<td>2.856927</td>
<td>3.383140</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1">pd.DataFrame(A).head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
<td>1.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> factorize(A, k):</span>
<span id="cb44-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Factorize the matrix A into W and H</span></span>
<span id="cb44-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    A: input matrix of size (n_users, n_movies)</span></span>
<span id="cb44-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    k: number of latent features</span></span>
<span id="cb44-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb44-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Returns W and H</span></span>
<span id="cb44-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    W: matrix of size (n_users, k)</span></span>
<span id="cb44-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    H: matrix of size (k, n_movies)</span></span>
<span id="cb44-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb44-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Randomly initialize W and H</span></span>
<span id="cb44-11">    W <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.randn(A.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], k, requires_grad<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb44-12">    H <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.randn(k, A.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], requires_grad<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb44-13">    </span>
<span id="cb44-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optimizer</span></span>
<span id="cb44-15">    optimizer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> optim.Adam([W, H], lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb44-16">    </span>
<span id="cb44-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train the model</span></span>
<span id="cb44-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>):</span>
<span id="cb44-19">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the loss</span></span>
<span id="cb44-20">        loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.norm(torch.mm(W, H) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> A)</span>
<span id="cb44-21">        </span>
<span id="cb44-22">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Zero the gradients</span></span>
<span id="cb44-23">        optimizer.zero_grad()</span>
<span id="cb44-24">        </span>
<span id="cb44-25">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Backpropagate</span></span>
<span id="cb44-26">        loss.backward()</span>
<span id="cb44-27">        </span>
<span id="cb44-28">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Update the parameters</span></span>
<span id="cb44-29">        optimizer.step()</span>
<span id="cb44-30">        </span>
<span id="cb44-31">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> W, H, loss</span></code></pre></div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> k <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>]:</span>
<span id="cb45-2">    W, H, loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> factorize(A, k)</span>
<span id="cb45-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(k, loss.item())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1 42.103797912597656
2 38.35541534423828
3 34.45906448364258
4 30.72266387939453
5 27.430004119873047
6 23.318540573120117
9 9.963604927062988
10 0.16205351054668427
11 0.18895108997821808</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1">pd.DataFrame(torch.mm(W,H).detach().numpy()).head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.014621</td>
<td>5.012642</td>
<td>4.012176</td>
<td>3.013239</td>
<td>4.012656</td>
<td>3.010292</td>
<td>1.012815</td>
<td>3.011410</td>
<td>3.015494</td>
<td>4.012996</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.987797</td>
<td>2.986945</td>
<td>3.989305</td>
<td>3.987498</td>
<td>3.988829</td>
<td>1.989375</td>
<td>4.989910</td>
<td>1.987138</td>
<td>1.986990</td>
<td>3.987026</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1">pd.DataFrame(A).head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
<td>1.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>2.0</td>
<td>4.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># With missing values</span></span>
<span id="cb49-2"></span>
<span id="cb49-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Randomly replace some entries with NaN</span></span>
<span id="cb49-4"></span>
<span id="cb49-5">A <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.randint(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, (n_users, n_movies), dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>torch.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>)</span>
<span id="cb49-6">A[torch.rand(A.shape) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'nan'</span>)</span>
<span id="cb49-7">A</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>tensor([[nan, 5., 5., nan, 1., 1., 4., 2., nan, 4.],
        [nan, 2., 2., 1., nan, nan, nan, nan, 3., nan],
        [nan, nan, 5., 1., nan, nan, 2., nan, nan, nan],
        [nan, nan, nan, 1., 4., 2., nan, 2., nan, 4.],
        [nan, nan, 2., nan, 3., 1., nan, nan, 4., 4.],
        [nan, 2., 5., nan, 2., nan, 1., nan, 3., nan],
        [nan, nan, nan, nan, 2., 1., nan, 3., nan, 5.],
        [nan, 4., nan, 1., 5., nan, 4., 5., 4., nan],
        [nan, nan, 2., 5., nan, nan, 5., nan, nan, 2.],
        [nan, nan, 3., 2., nan, 1., 1., 4., 5., nan],
        [nan, nan, 5., nan, nan, nan, 2., 2., nan, 3.],
        [nan, 5., 4., 2., nan, nan, nan, 1., 4., 3.],
        [nan, nan, 1., nan, 4., 4., nan, nan, 3., nan],
        [nan, 1., nan, nan, 3., nan, nan, nan, nan, 5.],
        [4., nan, 2., nan, nan, nan, nan, nan, 4., 3.],
        [4., nan, 3., nan, 3., nan, 4., 1., 1., nan],
        [5., nan, 3., nan, 3., nan, nan, 1., nan, nan],
        [2., 5., nan, 5., 3., 4., 3., 3., 5., 5.],
        [3., 3., nan, nan, nan, nan, nan, nan, 4., nan],
        [1., nan, 1., 3., 4., 1., nan, nan, 2., nan],
        [nan, nan, 5., nan, nan, nan, 2., nan, 1., nan],
        [3., 3., nan, nan, 2., 2., 3., 4., 4., nan],
        [2., nan, nan, 2., nan, nan, nan, nan, nan, 4.],
        [nan, 2., nan, 4., 5., 5., nan, 3., 5., nan],
        [2., 2., 2., 4., nan, 4., nan, 1., nan, nan],
        [5., 4., 5., 1., nan, 3., 5., 5., 1., 4.],
        [2., nan, nan, 2., nan, nan, nan, nan, nan, nan],
        [nan, 1., 5., nan, nan, nan, 2., 2., nan, nan],
        [2., 3., 4., nan, nan, nan, 1., 4., 4., nan],
        [2., nan, 1., 4., 1., 1., nan, 5., nan, 1.],
        [5., nan, 3., 1., 5., nan, nan, nan, 2., nan],
        [nan, 3., 4., nan, nan, 3., nan, 5., 5., nan],
        [4., 3., 2., 3., nan, nan, nan, nan, 1., nan],
        [1., 1., nan, 5., 1., 5., nan, nan, 5., nan],
        [4., 5., nan, nan, nan, 3., nan, 2., 5., 5.],
        [nan, 5., 5., nan, nan, nan, nan, 4., nan, nan],
        [5., nan, 4., 2., 3., 3., nan, nan, 2., 1.],
        [nan, nan, nan, nan, 5., nan, 2., 2., 4., nan],
        [3., 5., 1., 5., 3., nan, 5., nan, 2., 4.],
        [nan, 2., 4., nan, 1., 4., nan, 5., nan, 3.],
        [5., 5., 2., 5., nan, 4., nan, 2., nan, 3.],
        [5., nan, nan, 5., 1., 5., nan, nan, 3., 3.],
        [nan, 4., 2., 5., nan, 2., 3., nan, nan, 1.],
        [nan, nan, 4., 5., 5., nan, nan, 4., nan, 2.],
        [nan, nan, nan, nan, nan, nan, nan, 1., 3., nan],
        [3., 3., 1., 1., 1., 4., nan, nan, nan, 2.],
        [nan, nan, nan, 4., 5., nan, nan, 3., nan, nan],
        [5., nan, 5., 2., 4., nan, nan, nan, 5., nan],
        [nan, 1., 1., nan, 3., 1., nan, 1., nan, 1.],
        [nan, nan, 1., 2., nan, 3., nan, 2., 2., 4.],
        [nan, nan, 5., 1., 3., 2., 2., nan, 1., nan],
        [nan, 2., 2., nan, 4., nan, nan, nan, 3., nan],
        [nan, nan, nan, nan, 5., 4., nan, 3., nan, nan],
        [nan, 2., nan, nan, nan, nan, nan, 3., nan, nan],
        [nan, 2., 5., 2., nan, 3., 4., nan, 1., 2.],
        [1., nan, 1., nan, nan, 3., 4., 2., nan, 1.],
        [nan, 4., 4., 1., nan, nan, 5., nan, nan, 2.],
        [nan, nan, 3., nan, nan, 4., 1., nan, 3., nan],
        [nan, 1., nan, 3., 2., 3., nan, 2., nan, 4.],
        [2., 3., 3., nan, 1., 4., 3., nan, nan, 1.],
        [5., nan, 3., 1., 1., nan, 4., nan, 3., nan],
        [5., nan, nan, nan, nan, nan, 4., nan, nan, nan],
        [2., nan, nan, 2., nan, nan, 2., 3., nan, 4.],
        [3., nan, 4., 5., nan, nan, nan, 1., nan, 3.],
        [3., 3., 1., nan, 2., 5., 5., nan, 2., nan],
        [1., 1., 3., 1., nan, nan, 4., 3., 4., 5.],
        [4., nan, nan, 5., 2., nan, 1., nan, nan, nan],
        [nan, nan, 2., nan, 5., nan, 2., 1., nan, 4.],
        [nan, 5., nan, 4., 3., 2., 2., 1., nan, 4.],
        [nan, nan, 1., nan, nan, nan, 2., nan, nan, nan],
        [1., nan, nan, 4., 5., 3., nan, 2., nan, nan],
        [2., nan, 5., 1., 3., nan, 5., nan, nan, nan],
        [3., 5., nan, nan, nan, 5., 2., nan, nan, 2.],
        [nan, 2., 5., nan, nan, nan, 2., nan, 1., 2.],
        [nan, 3., 2., nan, nan, 4., nan, 2., nan, 5.],
        [nan, 4., 5., 2., 5., nan, nan, nan, nan, 5.],
        [3., 1., 5., 3., nan, nan, nan, 3., nan, 4.],
        [nan, 5., nan, 5., nan, 5., 1., 1., 3., 1.],
        [2., nan, nan, nan, 5., nan, nan, 4., nan, 4.],
        [nan, 3., 4., 2., nan, 2., nan, 2., nan, nan],
        [nan, 5., nan, 2., 2., 4., 5., 5., nan, nan],
        [nan, nan, nan, nan, nan, 5., nan, nan, 5., 4.],
        [nan, nan, nan, nan, nan, 2., 2., 2., 2., 4.],
        [nan, nan, nan, 2., 5., 3., 3., nan, nan, nan],
        [1., 2., 4., 2., nan, 2., 5., 4., nan, 5.],
        [4., nan, nan, 5., 4., nan, 5., 1., 3., nan],
        [4., nan, 1., 4., nan, nan, 2., nan, 4., 3.],
        [4., 2., 1., 3., nan, nan, 1., nan, nan, 1.],
        [nan, 1., 3., 1., 2., nan, 3., nan, 5., nan],
        [nan, 1., 1., nan, 1., 1., nan, 4., nan, nan],
        [nan, nan, nan, nan, 1., 5., nan, 5., 3., nan],
        [3., 4., nan, 4., 3., nan, 2., 1., nan, nan],
        [1., 1., nan, 2., nan, nan, nan, 2., 4., 1.],
        [nan, 4., 2., nan, 3., nan, 2., 1., nan, 2.],
        [2., nan, 5., nan, 3., nan, 5., 1., nan, nan],
        [3., 3., nan, nan, 3., 3., nan, 4., 2., nan],
        [2., nan, 5., nan, 5., 3., nan, nan, 5., nan],
        [nan, nan, nan, nan, 5., nan, nan, nan, nan, 5.],
        [4., nan, nan, 1., 4., 5., 1., nan, 2., 4.],
        [1., nan, nan, nan, 2., nan, 4., nan, nan, nan]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1">W, H, loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> factorize(A, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb51-2">loss</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>tensor(nan, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<p>As expected, the above function does not work. Our current loss function does not handle missing values.</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb53" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1">mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>torch.isnan(A)</span>
<span id="cb53-2">mask</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>tensor([[False,  True,  True, False,  True,  True,  True,  True, False,  True],
        [False,  True,  True,  True, False, False, False, False,  True, False],
        [False, False,  True,  True, False, False,  True, False, False, False],
        [False, False, False,  True,  True,  True, False,  True, False,  True],
        [False, False,  True, False,  True,  True, False, False,  True,  True],
        [False,  True,  True, False,  True, False,  True, False,  True, False],
        [False, False, False, False,  True,  True, False,  True, False,  True],
        [False,  True, False,  True,  True, False,  True,  True,  True, False],
        [False, False,  True,  True, False, False,  True, False, False,  True],
        [False, False,  True,  True, False,  True,  True,  True,  True, False],
        [False, False,  True, False, False, False,  True,  True, False,  True],
        [False,  True,  True,  True, False, False, False,  True,  True,  True],
        [False, False,  True, False,  True,  True, False, False,  True, False],
        [False,  True, False, False,  True, False, False, False, False,  True],
        [ True, False,  True, False, False, False, False, False,  True,  True],
        [ True, False,  True, False,  True, False,  True,  True,  True, False],
        [ True, False,  True, False,  True, False, False,  True, False, False],
        [ True,  True, False,  True,  True,  True,  True,  True,  True,  True],
        [ True,  True, False, False, False, False, False, False,  True, False],
        [ True, False,  True,  True,  True,  True, False, False,  True, False],
        [False, False,  True, False, False, False,  True, False,  True, False],
        [ True,  True, False, False,  True,  True,  True,  True,  True, False],
        [ True, False, False,  True, False, False, False, False, False,  True],
        [False,  True, False,  True,  True,  True, False,  True,  True, False],
        [ True,  True,  True,  True, False,  True, False,  True, False, False],
        [ True,  True,  True,  True, False,  True,  True,  True,  True,  True],
        [ True, False, False,  True, False, False, False, False, False, False],
        [False,  True,  True, False, False, False,  True,  True, False, False],
        [ True,  True,  True, False, False, False,  True,  True,  True, False],
        [ True, False,  True,  True,  True,  True, False,  True, False,  True],
        [ True, False,  True,  True,  True, False, False, False,  True, False],
        [False,  True,  True, False, False,  True, False,  True,  True, False],
        [ True,  True,  True,  True, False, False, False, False,  True, False],
        [ True,  True, False,  True,  True,  True, False, False,  True, False],
        [ True,  True, False, False, False,  True, False,  True,  True,  True],
        [False,  True,  True, False, False, False, False,  True, False, False],
        [ True, False,  True,  True,  True,  True, False, False,  True,  True],
        [False, False, False, False,  True, False,  True,  True,  True, False],
        [ True,  True,  True,  True,  True, False,  True, False,  True,  True],
        [False,  True,  True, False,  True,  True, False,  True, False,  True],
        [ True,  True,  True,  True, False,  True, False,  True, False,  True],
        [ True, False, False,  True,  True,  True, False, False,  True,  True],
        [False,  True,  True,  True, False,  True,  True, False, False,  True],
        [False, False,  True,  True,  True, False, False,  True, False,  True],
        [False, False, False, False, False, False, False,  True,  True, False],
        [ True,  True,  True,  True,  True,  True, False, False, False,  True],
        [False, False, False,  True,  True, False, False,  True, False, False],
        [ True, False,  True,  True,  True, False, False, False,  True, False],
        [False,  True,  True, False,  True,  True, False,  True, False,  True],
        [False, False,  True,  True, False,  True, False,  True,  True,  True],
        [False, False,  True,  True,  True,  True,  True, False,  True, False],
        [False,  True,  True, False,  True, False, False, False,  True, False],
        [False, False, False, False,  True,  True, False,  True, False, False],
        [False,  True, False, False, False, False, False,  True, False, False],
        [False,  True,  True,  True, False,  True,  True, False,  True,  True],
        [ True, False,  True, False, False,  True,  True,  True, False,  True],
        [False,  True,  True,  True, False, False,  True, False, False,  True],
        [False, False,  True, False, False,  True,  True, False,  True, False],
        [False,  True, False,  True,  True,  True, False,  True, False,  True],
        [ True,  True,  True, False,  True,  True,  True, False, False,  True],
        [ True, False,  True,  True,  True, False,  True, False,  True, False],
        [ True, False, False, False, False, False,  True, False, False, False],
        [ True, False, False,  True, False, False,  True,  True, False,  True],
        [ True, False,  True,  True, False, False, False,  True, False,  True],
        [ True,  True,  True, False,  True,  True,  True, False,  True, False],
        [ True,  True,  True,  True, False, False,  True,  True,  True,  True],
        [ True, False, False,  True,  True, False,  True, False, False, False],
        [False, False,  True, False,  True, False,  True,  True, False,  True],
        [False,  True, False,  True,  True,  True,  True,  True, False,  True],
        [False, False,  True, False, False, False,  True, False, False, False],
        [ True, False, False,  True,  True,  True, False,  True, False, False],
        [ True, False,  True,  True,  True, False,  True, False, False, False],
        [ True,  True, False, False, False,  True,  True, False, False,  True],
        [False,  True,  True, False, False, False,  True, False,  True,  True],
        [False,  True,  True, False, False,  True, False,  True, False,  True],
        [False,  True,  True,  True,  True, False, False, False, False,  True],
        [ True,  True,  True,  True, False, False, False,  True, False,  True],
        [False,  True, False,  True, False,  True,  True,  True,  True,  True],
        [ True, False, False, False,  True, False, False,  True, False,  True],
        [False,  True,  True,  True, False,  True, False,  True, False, False],
        [False,  True, False,  True,  True,  True,  True,  True, False, False],
        [False, False, False, False, False,  True, False, False,  True,  True],
        [False, False, False, False, False,  True,  True,  True,  True,  True],
        [False, False, False,  True,  True,  True,  True, False, False, False],
        [ True,  True,  True,  True, False,  True,  True,  True, False,  True],
        [ True, False, False,  True,  True, False,  True,  True,  True, False],
        [ True, False,  True,  True, False, False,  True, False,  True,  True],
        [ True,  True,  True,  True, False, False,  True, False, False,  True],
        [False,  True,  True,  True,  True, False,  True, False,  True, False],
        [False,  True,  True, False,  True,  True, False,  True, False, False],
        [False, False, False, False,  True,  True, False,  True,  True, False],
        [ True,  True, False,  True,  True, False,  True,  True, False, False],
        [ True,  True, False,  True, False, False, False,  True,  True,  True],
        [False,  True,  True, False,  True, False,  True,  True, False,  True],
        [ True, False,  True, False,  True, False,  True,  True, False, False],
        [ True,  True, False, False,  True,  True, False,  True,  True, False],
        [ True, False,  True, False,  True,  True, False, False,  True, False],
        [False, False, False, False,  True, False, False, False, False,  True],
        [ True, False, False,  True,  True,  True,  True, False,  True,  True],
        [ True, False, False, False,  True, False,  True, False, False, False]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb55" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1">mask.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>tensor(517)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb57" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1">W <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.randn(A.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], k, requires_grad<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb57-2">H <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.randn(k, A.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],  requires_grad<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb57-3"></span>
<span id="cb57-4">diff_matrix <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.mm(W, H)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>A</span>
<span id="cb57-5">diff_matrix.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>torch.Size([100, 10])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb59" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mask the matrix</span></span>
<span id="cb59-2">diff_matrix[mask].shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>torch.Size([517])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb61" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Modify the loss function to ignore NaN values</span></span>
<span id="cb61-2"></span>
<span id="cb61-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> factorize(A, k):</span>
<span id="cb61-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Factorize the matrix D into A and B"""</span></span>
<span id="cb61-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Randomly initialize A and B</span></span>
<span id="cb61-6">    W <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.randn(A.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], k, requires_grad<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb61-7">    H <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.randn(k, A.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], requires_grad<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb61-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optimizer</span></span>
<span id="cb61-9">    optimizer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> optim.Adam([W, H], lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb61-10">    </span>
<span id="cb61-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train the model</span></span>
<span id="cb61-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>):</span>
<span id="cb61-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the loss</span></span>
<span id="cb61-14">        diff_matrix <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.mm(W, H) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> A</span>
<span id="cb61-15">        diff_vector <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> diff_matrix[mask]</span>
<span id="cb61-16">        loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.norm(diff_vector)</span>
<span id="cb61-17">        </span>
<span id="cb61-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Zero the gradients</span></span>
<span id="cb61-19">        optimizer.zero_grad()</span>
<span id="cb61-20">        </span>
<span id="cb61-21">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Backpropagate</span></span>
<span id="cb61-22">        loss.backward()</span>
<span id="cb61-23">        </span>
<span id="cb61-24">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Update the parameters</span></span>
<span id="cb61-25">        optimizer.step()</span>
<span id="cb61-26">        </span>
<span id="cb61-27">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> W, H, loss</span></code></pre></div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb62" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1">W, H, loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> factorize(A, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb62-2">loss</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>tensor(7.1147, grad_fn=&lt;LinalgVectorNormBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb64" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1">torch.mm(W, H)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>tensor([[-3.7026e+00,  5.1163e+00,  4.9660e+00, -5.8455e-01,  1.0200e+00,
          9.1470e-01,  3.8727e+00,  2.2007e+00,  1.3782e+01,  3.9267e+00],
        [ 6.4588e-02,  2.0002e+00,  1.9979e+00,  1.0001e+00,  3.6942e+00,
          1.1512e+00,  3.8181e+00,  3.5421e+00,  3.0014e+00,  5.0035e+00],
        [-3.3540e-01, -1.0050e+00,  5.0000e+00,  1.0010e+00,  1.7959e-01,
          8.6454e-01,  1.9994e+00,  2.9560e+00,  1.0767e+01, -3.4057e-01],
        [ 2.6321e+00,  3.5523e+00,  2.1706e+00,  9.9769e-01,  3.9995e+00,
          2.0030e+00,  2.8652e+00,  2.0006e+00,  3.5503e-02,  3.9991e+00],
        [ 5.3195e-02, -1.3399e+00,  1.9455e+00,  2.2700e+00,  3.0539e+00,
          1.0086e+00,  3.8842e+00,  5.1128e+00,  4.0248e+00,  3.9763e+00],
        [ 5.5045e+00,  2.0044e+00,  4.9388e+00,  1.6216e+00,  2.0865e+00,
          2.8957e+00,  9.2770e-01,  8.8714e-01,  3.0420e+00, -9.2438e-01],
        [ 6.1366e-01, -1.3394e+00, -6.3292e+00,  4.0202e+00,  2.0028e+00,
          1.0014e+00,  2.1030e+00,  3.0001e+00, -1.0639e+01,  4.9979e+00],
        [ 1.6036e+00,  3.6518e+00,  3.7664e+00,  1.2319e+00,  5.1780e+00,
          2.1295e+00,  4.7475e+00,  4.0635e+00,  4.0645e+00,  5.9223e+00],
        [-4.1593e+00, -1.1450e+01,  2.0064e+00,  5.0104e+00,  1.7877e-01,
         -6.8356e-01,  4.9576e+00,  1.0525e+01,  1.2403e+01,  2.0250e+00],
        [ 1.7769e+00, -4.9137e+00,  3.1228e+00,  2.2575e+00,  5.8793e-01,
          6.6961e-01,  1.2031e+00,  3.7871e+00,  4.9702e+00, -1.4083e+00],
        [ 9.1273e+00,  1.4212e+00,  5.0018e+00, -1.0804e+00,  8.9608e+00,
          1.6892e+00,  2.0130e+00,  1.9936e+00, -7.2410e+00,  2.9931e+00],
        [ 3.2326e+00,  5.2245e+00,  3.8534e+00,  1.8050e+00,  2.7570e+00,
          3.2246e+00,  2.7488e+00,  1.4501e+00,  3.9743e+00,  2.7026e+00],
        [ 9.2220e-01,  6.5451e+00,  9.9373e-01,  4.2199e+00,  4.0030e+00,
          4.0019e+00,  5.8552e+00,  4.3514e+00,  3.0028e+00,  8.0414e+00],
        [-2.3552e+00,  1.0013e+00,  9.6726e-01, -4.6631e-01,  3.0005e+00,
         -4.1134e-01,  3.3274e+00,  3.0678e+00,  3.0946e+00,  4.9978e+00],
        [ 4.0009e+00,  5.9036e+00,  1.9983e+00,  6.0610e+00,  1.0184e+00,
          5.6167e+00,  3.5338e+00,  2.5504e+00,  4.0003e+00,  3.0002e+00],
        [ 4.1839e+00,  9.1531e+00,  2.5008e+00,  3.1248e+00,  3.4309e+00,
          4.8701e+00,  3.6236e+00,  9.7109e-01,  1.3077e+00,  4.9725e+00],
        [ 5.0034e+00, -2.6358e+00,  2.9996e+00, -3.1773e-01,  2.9981e+00,
          3.3085e-01, -3.0125e-01,  1.0002e+00, -2.6015e+00, -1.5107e+00],
        [ 2.1562e+00,  5.1078e+00,  2.3091e+00,  4.3035e+00,  2.3000e+00,
          4.1470e+00,  4.2497e+00,  3.3351e+00,  4.7425e+00,  4.5406e+00],
        [ 2.9999e+00,  2.9999e+00,  3.0624e+00,  4.4992e+00,  4.5262e+00,
          3.8824e+00,  5.4591e+00,  5.5541e+00,  4.0005e+00,  5.9015e+00],
        [ 8.1177e-01, -2.9699e+00,  1.2606e+00,  3.0946e+00,  3.9370e+00,
          1.0488e+00,  4.3280e+00,  6.3317e+00,  1.8619e+00,  4.5940e+00],
        [ 2.1477e+00,  2.4168e+00,  5.0014e+00, -3.6888e+00,  5.9741e+00,
         -5.6343e-01,  1.9977e+00,  9.9599e-01,  1.0008e+00,  3.2156e+00],
        [ 2.5660e+00,  2.4872e+00,  2.9711e+00,  3.0048e+00,  2.5035e+00,
          2.9551e+00,  3.2466e+00,  3.1642e+00,  4.0380e+00,  2.8930e+00],
        [ 2.0003e+00,  1.1864e+01, -1.4367e+00,  1.9999e+00,  4.6078e-01,
          4.1701e+00,  1.3254e+00, -3.0082e+00, -2.7641e+00,  3.9993e+00],
        [ 1.0449e+01,  2.0032e+00,  8.9659e+00,  3.6977e+00,  4.8085e+00,
          5.2882e+00,  2.4920e+00,  3.2403e+00,  4.9395e+00, -8.7002e-01],
        [ 2.0717e+00,  2.1115e+00,  2.0717e+00,  4.2801e+00, -2.0380e+00,
          3.5172e+00,  9.3884e-01,  9.7155e-01,  6.2354e+00, -1.3328e+00],
        [ 5.2955e+00,  3.4266e+00,  5.1299e+00,  1.4202e+00,  6.8671e+00,
          2.9375e+00,  4.3992e+00,  3.9995e+00,  1.2817e+00,  5.0996e+00],
        [ 2.0001e+00,  1.4791e+00,  2.3388e+00,  2.0000e+00, -6.6995e-01,
          2.1166e+00,  4.5259e-01,  3.8568e-01,  4.1443e+00, -1.1447e+00],
        [ 2.9065e+00,  1.0088e+00,  5.0003e+00, -4.4267e-01,  3.6696e+00,
          1.0351e+00,  1.9735e+00,  2.0205e+00,  3.8361e+00,  1.3199e+00],
        [ 2.3390e+00,  2.3721e+00,  3.7185e+00,  1.3874e+00,  2.8777e+00,
          2.1103e+00,  2.7381e+00,  2.4701e+00,  4.1805e+00,  2.4318e+00],
        [ 1.7971e+00, -4.8495e+00,  9.1239e-01,  3.9631e+00,  1.2733e+00,
          1.2781e+00,  2.2735e+00,  5.0206e+00,  1.8186e+00,  7.7334e-01],
        [ 4.4556e+00,  1.2257e+01,  3.8113e+00,  1.3722e+00,  4.8218e+00,
          4.8774e+00,  3.8956e+00, -1.3451e-01,  1.5725e+00,  6.1126e+00],
        [ 2.3871e+00,  3.0010e+00,  3.9991e+00,  2.8334e+00,  4.8395e+00,
          2.9996e+00,  5.1329e+00,  5.0009e+00,  5.0012e+00,  5.6052e+00],
        [ 3.9920e+00,  3.0004e+00,  2.0131e+00,  3.0049e+00,  1.3189e+00,
          3.2595e+00,  1.5054e+00,  1.0929e+00,  9.9195e-01,  8.6129e-01],
        [ 1.3517e+00,  1.3225e+00,  1.2075e+00,  5.6267e+00,  9.9029e-01,
          3.6713e+00,  4.0205e+00,  4.6894e+00,  5.0908e+00,  3.3918e+00],
        [ 3.9141e+00,  5.4294e+00,  6.3565e+00,  3.9410e-02,  5.9122e+00,
          2.6582e+00,  4.0295e+00,  2.6446e+00,  4.8764e+00,  4.5279e+00],
        [ 5.9703e+00,  5.0000e+00,  5.0006e+00,  5.4552e+00,  3.4764e+00,
          5.7107e+00,  4.4197e+00,  3.9984e+00,  5.4614e+00,  3.3112e+00],
        [ 4.9808e+00,  2.5274e+00,  4.0592e+00,  2.0167e+00,  2.9650e+00,
          2.9926e+00,  1.9145e+00,  1.7219e+00,  1.9706e+00,  1.0164e+00],
        [ 3.3675e+00,  7.9931e-01,  6.4143e+00, -1.9437e+00,  5.0061e+00,
          3.9840e-01,  1.9918e+00,  2.0016e+00,  4.0036e+00,  1.4088e+00],
        [ 3.1524e+00,  4.8411e+00,  1.3102e+00,  5.0749e+00,  2.6352e+00,
          4.5228e+00,  4.2075e+00,  3.4787e+00,  2.0158e+00,  4.7858e+00],
        [ 1.1647e+00,  2.0442e+00,  3.9774e+00,  5.2040e+00,  1.0064e+00,
          3.9541e+00,  4.5550e+00,  5.0695e+00,  1.0370e+01,  2.9545e+00],
        [ 4.9155e+00,  4.8887e+00,  1.8611e+00,  4.5726e+00,  2.4214e+00,
          4.6615e+00,  2.9405e+00,  2.1223e+00,  4.9785e-01,  2.9426e+00],
        [ 4.6095e+00,  7.0277e+00,  2.3640e+00,  4.9826e+00,  1.3639e+00,
          5.4668e+00,  2.9430e+00,  1.3600e+00,  2.9275e+00,  2.6572e+00],
        [-9.4300e+00,  3.9400e+00,  1.8115e+00,  4.6790e+00, -7.7135e+00,
          2.3401e+00,  3.3902e+00,  2.5588e+00,  2.3759e+01,  7.8572e-01],
        [ 8.8489e+00,  1.3677e+00,  4.0011e+00,  4.9984e+00,  5.0002e+00,
          4.8811e+00,  3.1127e+00,  4.0020e+00, -1.6249e+00,  1.9996e+00],
        [-5.3638e+00, -1.6611e+01, -1.2622e+00, -2.9465e+00, -5.3122e+00,
         -6.6081e+00, -4.5960e+00,  1.0021e+00,  3.0004e+00, -8.7048e+00],
        [ 2.9505e+00,  3.4944e+00,  1.0966e+00,  2.0104e+00,  1.4645e+00,
          2.5452e+00,  1.3437e+00,  4.9608e-01, -3.2980e-01,  1.5523e+00],
        [ 8.8610e+00,  3.4098e+00,  5.4534e+00,  4.0010e+00,  5.0039e+00,
          5.0527e+00,  2.9819e+00,  2.9969e+00,  4.8445e-01,  1.7580e+00],
        [ 4.7645e+00,  7.2438e+00,  5.3527e+00,  2.1598e+00,  3.9257e+00,
          4.3363e+00,  3.5150e+00,  1.6544e+00,  4.8212e+00,  3.4858e+00],
        [ 3.6301e+00,  8.2968e-01,  1.0952e+00,  5.1852e-01,  2.9273e+00,
          1.1501e+00,  7.9266e-01,  7.6517e-01, -3.4503e+00,  1.2149e+00],
        [ 1.2349e+00,  4.7494e+00,  1.1553e+00,  2.2902e+00,  2.1858e+00,
          2.6806e+00,  3.0526e+00,  1.8136e+00,  1.9800e+00,  4.0943e+00],
        [ 5.4207e+00,  4.6174e-01,  4.6315e+00,  1.0934e+00,  3.5323e+00,
          2.1171e+00,  1.4216e+00,  1.9254e+00,  1.2497e+00,  1.5768e-01],
        [ 8.0981e-01,  1.9982e+00,  1.9823e+00,  2.3342e+00,  4.0156e+00,
          1.9755e+00,  4.5111e+00,  4.4963e+00,  3.0107e+00,  5.5846e+00],
        [ 3.4230e+00,  6.7811e+00,  1.3001e+00,  3.2712e+00,  5.0004e+00,
          4.0008e+00,  4.7148e+00,  2.9985e+00, -8.9564e-01,  6.9733e+00],
        [ 4.3992e+00,  1.9999e+00,  1.7722e+00,  3.3742e+00,  3.4675e+00,
          3.1595e+00,  2.8761e+00,  3.0001e+00, -8.2256e-01,  3.0558e+00],
        [ 6.3852e+00,  1.8676e+00,  5.1417e+00,  2.1083e+00,  5.4183e+00,
          3.1672e+00,  3.1282e+00,  3.3945e+00,  1.0754e+00,  2.5551e+00],
        [ 8.1366e-01,  2.6100e+00,  1.2431e+00,  4.6053e+00, -7.3305e-01,
          3.4299e+00,  2.5706e+00,  2.4739e+00,  5.9303e+00,  1.5624e+00],
        [-1.5185e+01,  3.9601e+00,  4.1178e+00,  1.1159e+00, -7.8194e+00,
         -2.6153e-01,  4.5528e+00,  3.2349e+00,  3.2557e+01,  2.2662e+00],
        [ 4.1539e+00,  6.2482e+00,  3.0004e+00,  2.5108e+00,  4.1870e-01,
          4.0017e+00,  9.9885e-01, -7.3851e-01,  2.9998e+00,  1.7461e-01],
        [ 2.4292e+00,  1.3324e+00, -2.4186e+00,  3.4744e+00,  2.2288e+00,
          2.2009e+00,  2.0940e+00,  2.1399e+00, -5.7555e+00,  3.6885e+00],
        [ 2.2950e+00,  2.9436e+00,  3.1712e+00,  4.1268e+00,  5.4157e-01,
          3.7216e+00,  2.8408e+00,  2.7181e+00,  6.7460e+00,  1.4747e+00],
        [ 5.0664e+00,  4.5652e+01,  2.7328e+00,  1.0374e+00,  1.2891e+00,
          1.3143e+01,  3.7184e+00, -1.3608e+01,  3.1697e+00,  1.1363e+01],
        [ 5.0006e+00,  6.9239e+00,  9.1918e-01,  7.2628e+00,  1.5445e+00,
          6.5242e+00,  4.0004e+00,  2.7856e+00,  1.5080e+00,  4.0918e+00],
        [ 2.0015e+00, -1.7211e+00, -2.6718e+00,  1.9970e+00,  3.6355e+00,
          4.8944e-01,  2.0002e+00,  3.0038e+00, -7.9397e+00,  3.9988e+00],
        [ 2.9915e+00,  1.0068e+01,  4.0126e+00,  5.0140e+00,  2.1576e-01,
          6.2162e+00,  3.6692e+00,  9.8564e-01,  9.0477e+00,  2.9998e+00],
        [ 3.1704e+00,  3.0173e+00,  6.3333e-01,  6.8363e+00,  2.2725e+00,
          4.9317e+00,  4.7652e+00,  5.0099e+00,  2.2206e+00,  4.9007e+00],
        [ 7.5330e-01,  1.4262e+00,  3.0599e+00,  8.5747e-01,  4.0712e+00,
          1.1776e+00,  3.8169e+00,  3.8298e+00,  3.8094e+00,  4.5052e+00],
        [ 4.0428e+00, -2.0650e+01,  2.4385e+00,  4.9425e+00,  1.9279e+00,
         -1.5739e+00,  1.0876e+00,  1.0297e+01,  9.8782e-01, -4.4288e+00],
        [ 1.0773e+00,  2.2150e+00,  2.0096e+00, -2.4710e+00,  4.9950e+00,
         -5.0779e-01,  1.9650e+00,  1.0100e+00, -1.8899e+00,  4.0205e+00],
        [ 3.4996e+00,  4.5594e+00, -2.5208e+00,  3.3402e+00,  2.6908e+00,
          3.0928e+00,  2.0393e+00,  8.1359e-01, -7.3751e+00,  4.3822e+00],
        [-4.8442e+00,  3.4518e+00,  9.9972e-01, -1.2881e+00, -3.5755e-01,
         -5.3701e-01,  1.9997e+00,  4.9337e-01,  7.5069e+00,  3.0513e+00],
        [ 1.0026e+00,  7.6105e+00, -7.1104e+00,  3.9509e+00,  4.9733e+00,
          3.0444e+00,  4.5575e+00,  2.0356e+00, -1.3359e+01,  1.0958e+01],
        [ 1.9708e+00,  2.2459e+01,  5.0115e+00,  1.0357e+00,  3.0386e+00,
          7.0322e+00,  4.9501e+00, -3.0939e+00,  8.5776e+00,  8.3022e+00],
        [ 3.0000e+00,  5.0024e+00, -1.4123e+00,  6.3346e+00, -9.3349e-01,
          4.9944e+00,  2.0182e+00,  1.1012e+00, -1.8768e-01,  1.9884e+00],
        [ 4.4226e+00,  2.0069e+00,  5.0098e+00, -8.1680e-01,  5.0611e+00,
          1.2995e+00,  1.9966e+00,  1.6425e+00,  9.9608e-01,  1.9906e+00],
        [ 1.1858e+01,  3.1806e+00,  1.9399e+00,  2.0242e+00,  9.7272e+00,
          3.8295e+00,  2.5867e+00,  2.2628e+00, -1.4185e+01,  4.8150e+00],
        [ 3.0139e+00,  4.0015e+00,  4.9996e+00,  2.0000e+00,  5.0004e+00,
          3.0423e+00,  4.6969e+00,  4.0977e+00,  5.4217e+00,  4.9981e+00],
        [ 3.1070e+00,  1.5608e+00,  4.4961e+00,  2.4194e+00,  3.9092e+00,
          2.6510e+00,  3.8237e+00,  4.1656e+00,  5.0091e+00,  3.2677e+00],
        [ 3.6123e+00,  5.0130e+00,  1.2513e+00,  5.0780e+00, -6.2890e-01,
          4.7738e+00,  1.7050e+00,  7.5555e-01,  2.9369e+00,  7.0034e-01],
        [ 1.9988e+00, -1.0755e+00,  2.1010e+00,  4.8154e-01,  5.0034e+00,
          4.1238e-01,  3.1198e+00,  4.0017e+00, -6.4504e-01,  3.9979e+00],
        [-2.4511e+00,  3.0049e+00,  4.0049e+00,  2.0168e+00, -1.7567e+00,
          1.9773e+00,  2.5612e+00,  1.9963e+00,  1.3746e+01,  7.7954e-01],
        [ 1.2900e+00,  4.8906e+00,  1.2285e+01,  2.0178e+00,  2.0017e+00,
          4.0381e+00,  5.2765e+00,  4.7427e+00,  2.3263e+01,  1.4459e+00],
        [ 3.4409e+00,  1.6323e+00,  2.1447e+00,  7.1434e+00,  2.1349e+00,
          4.9995e+00,  4.9455e+00,  5.8905e+00,  5.0000e+00,  4.0006e+00],
        [-8.3402e+00,  1.6671e+00, -9.7906e+00,  7.5550e+00, -7.1860e+00,
          1.9594e+00,  2.1880e+00,  1.9448e+00,  1.9841e+00,  3.9175e+00],
        [ 6.1855e+00,  1.0277e+00,  6.0344e+00,  2.0010e+00,  5.0009e+00,
          2.9985e+00,  3.0008e+00,  3.6213e+00,  3.0914e+00,  1.7165e+00],
        [ 9.9264e-01,  2.2125e+00,  3.9075e+00,  1.8425e+00,  4.0571e+00,
          2.0497e+00,  4.5854e+00,  4.5379e+00,  6.0676e+00,  4.9087e+00],
        [ 4.1464e+00,  1.4062e+01,  2.4284e+00,  4.7693e+00,  3.6919e+00,
          6.9404e+00,  5.3224e+00,  1.0755e+00,  2.9501e+00,  7.6420e+00],
        [ 3.7800e+00,  1.9199e+01,  1.3223e+00,  4.2259e+00, -1.6001e+00,
          7.9395e+00,  1.7065e+00, -4.9606e+00,  3.8810e+00,  3.1246e+00],
        [ 4.0234e+00,  2.0156e+00,  9.3090e-01,  2.9352e+00,  1.4458e+00,
          2.8364e+00,  1.1944e+00,  1.0778e+00, -1.3489e+00,  8.8513e-01],
        [ 2.9993e-01,  1.0106e+00,  2.8743e+00,  1.0596e+00,  2.1897e+00,
          1.1528e+00,  2.7986e+00,  2.9140e+00,  5.0939e+00,  2.6367e+00],
        [-2.7522e+00,  1.0011e+00,  9.9939e-01,  2.1638e+00,  9.9803e-01,
          9.9864e-01,  3.8559e+00,  4.0029e+00,  6.9205e+00,  4.3317e+00],
        [ 4.8687e+00, -1.5672e-01,  1.6703e+00,  7.5356e+00,  9.9502e-01,
          4.9990e+00,  3.3880e+00,  5.0098e+00,  2.9938e+00,  1.4576e+00],
        [ 3.0192e+00,  3.9819e+00, -5.9198e+00,  3.9832e+00,  2.9753e+00,
          2.7502e+00,  2.0750e+00,  9.5908e-01, -1.2959e+01,  5.9251e+00],
        [ 1.0148e+00,  9.7130e-01,  1.9768e+00,  2.0122e+00,  6.6718e-01,
          1.7201e+00,  1.7755e+00,  1.9466e+00,  4.0138e+00,  1.0400e+00],
        [ 5.3930e+00,  4.0298e+00,  2.0109e+00,  2.7548e+00,  2.9962e+00,
          3.5641e+00,  1.8677e+00,  1.0778e+00, -1.7539e+00,  2.0255e+00],
        [ 1.9953e+00,  1.2843e+01,  5.0056e+00,  2.5516e+00,  2.9983e+00,
          5.4422e+00,  5.0090e+00,  9.8768e-01,  8.9960e+00,  6.2394e+00],
        [ 2.8324e+00,  2.8434e+00,  1.9018e+00,  3.8000e+00,  3.1922e+00,
          3.3458e+00,  3.8883e+00,  3.7678e+00,  2.0126e+00,  4.2686e+00],
        [ 2.0652e+00,  8.7485e+00,  4.9003e+00, -7.1472e-02,  5.0456e+00,
          2.9448e+00,  4.2957e+00,  1.4602e+00,  5.0622e+00,  6.0046e+00],
        [ 1.2368e+00, -8.0124e-01,  4.5406e-01,  5.8132e-01,  5.0025e+00,
          1.8401e-01,  3.2316e+00,  3.9075e+00, -2.7376e+00,  4.9980e+00],
        [ 4.4707e+00,  1.3100e+01,  3.8913e+00,  5.0670e-01,  3.1494e+00,
          4.7096e+00,  2.2617e+00, -2.3287e+00,  1.8589e+00,  3.9039e+00],
        [ 9.9929e-01,  1.5253e+01,  2.1834e-03,  2.6820e+00,  2.0005e+00,
          5.3245e+00,  3.9995e+00, -1.3442e+00,  1.4326e+00,  7.5636e+00]],
       grad_fn=&lt;MmBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb66" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now use matrix factorization to predict the ratings</span></span>
<span id="cb66-2"></span>
<span id="cb66-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb66-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.nn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> nn</span>
<span id="cb66-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.nn.functional <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> F</span>
<span id="cb66-6"></span>
<span id="cb66-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a class for the model</span></span>
<span id="cb66-8"></span>
<span id="cb66-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> MatrixFactorization(nn.Module):</span>
<span id="cb66-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, n_users, n_movies, n_factors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>):</span>
<span id="cb66-11">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>()</span>
<span id="cb66-12">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.user_factors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Embedding(n_users, n_factors)</span>
<span id="cb66-13">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.movie_factors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Embedding(n_movies, n_factors)</span>
<span id="cb66-14"></span>
<span id="cb66-15">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> forward(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, user, movie):</span>
<span id="cb66-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.user_factors(user) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.movie_factors(movie)).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)      </span></code></pre></div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb67" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MatrixFactorization(n_users, n_movies, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb67-2">model</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>MatrixFactorization(
  (user_factors): Embedding(100, 2)
  (movie_factors): Embedding(10, 2)
)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb69" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1">model(torch.tensor([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]), torch.tensor([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>tensor([-0.0271], grad_fn=&lt;SumBackward1&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb71" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1">A[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>tensor(5.)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb73" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span>(A)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>torch.Tensor</code></pre>
</div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb75" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1">mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>torch.isnan(A)</span>
<span id="cb75-2"></span>
<span id="cb75-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the indices of the non-NaN values</span></span>
<span id="cb75-4">i, j <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.where(mask)</span>
<span id="cb75-5"></span>
<span id="cb75-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the values of the non-NaN values</span></span>
<span id="cb75-7">v <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> A[mask]</span>
<span id="cb75-8"></span>
<span id="cb75-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Store in PyTorch tensors</span></span>
<span id="cb75-10">users <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> i.to(torch.int64)</span>
<span id="cb75-11">movies <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> j.to(torch.int64)</span>
<span id="cb75-12">ratings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> v.to(torch.float32)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb76" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1">pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'user'</span>: users, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'movie'</span>: movies, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rating'</span>: ratings})</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">user</th>
<th data-quarto-table-cell-role="th">movie</th>
<th data-quarto-table-cell-role="th">rating</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>1</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>2</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>4</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>5</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>6</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">512</td>
<td>98</td>
<td>8</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">513</td>
<td>98</td>
<td>9</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">514</td>
<td>99</td>
<td>0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">515</td>
<td>99</td>
<td>4</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">516</td>
<td>99</td>
<td>6</td>
<td>4.0</td>
</tr>
</tbody>
</table>

<p>517 rows  3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb77" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit the Matrix Factorization model</span></span>
<span id="cb77-2">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MatrixFactorization(n_users, n_movies, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb77-3">optimizer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> optim.Adam(model.parameters(), lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb77-4"></span>
<span id="cb77-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>):</span>
<span id="cb77-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the loss</span></span>
<span id="cb77-7">    pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(users, movies)</span>
<span id="cb77-8">    loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.mse_loss(pred, ratings)</span>
<span id="cb77-9">    </span>
<span id="cb77-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Zero the gradients</span></span>
<span id="cb77-11">    optimizer.zero_grad()</span>
<span id="cb77-12">    </span>
<span id="cb77-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Backpropagate</span></span>
<span id="cb77-14">    loss.backward()</span>
<span id="cb77-15">    </span>
<span id="cb77-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Update the parameters</span></span>
<span id="cb77-17">    optimizer.step()</span>
<span id="cb77-18">    </span>
<span id="cb77-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print the loss</span></span>
<span id="cb77-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb77-21">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(loss.item())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>14.604362487792969
4.332712650299072
1.0960761308670044
0.6966323852539062
0.5388827919960022
0.45243579149246216
0.4012693464756012
0.3728969395160675
0.35568001866340637
0.34289655089378357</code></pre>
</div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb79" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1">model(users, movies)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>tensor([3.5693, 4.5338, 2.6934, 1.8316, 4.8915, 2.0194, 2.7778, 1.8601, 2.1124,
        1.1378, 2.9079, 5.0470, 0.9911, 1.9791, 1.0050, 3.9618, 2.0085, 2.0034,
        4.0113, 1.9218, 2.9801, 1.0432, 3.8993, 4.1292, 1.9357, 3.8285, 3.5266,
        1.3640, 2.3989, 2.4166, 0.8559, 3.3685, 4.4493, 3.4018, 1.4722, 4.8378,
        4.6684, 4.4473, 4.3097, 2.0022, 5.0147, 5.0113, 1.9599, 2.8305, 1.4493,
        1.6750, 0.9520, 3.8460, 5.1279, 4.7453, 2.1484, 1.8009, 3.2104, 4.2068,
        4.5473, 2.9229, 1.1817, 3.1108, 3.2157, 1.2238, 3.6272, 3.9029, 3.2554,
        0.9945, 3.0062, 5.0030, 4.1144, 1.6314, 3.7945, 3.3091, 4.0727, 3.6212,
        2.4359, 3.5707, 1.2826, 0.9663, 4.9973, 3.0163, 2.9916, 1.0014, 3.1734,
        3.8712, 4.3364, 3.7119, 4.5313, 2.3875, 4.0274, 4.7121, 4.3851, 2.8072,
        3.2066, 3.9684, 0.9307, 1.4160, 2.7484, 2.8771, 1.2753, 2.5825, 4.9857,
        2.0109, 1.0080, 2.2618, 2.7936, 2.5859, 3.0972, 3.1443, 3.8655, 3.2023,
        2.0061, 1.9866, 4.0068, 2.7861, 4.2803, 4.5452, 3.8177, 2.9951, 5.6040,
        1.9013, 2.4498, 1.9155, 4.3239, 3.2993, 1.1275, 4.1460, 4.3619, 4.5913,
        1.1365, 3.0865, 6.0992, 3.9207, 1.8325, 3.8526, 2.0000, 2.0000, 1.0255,
        5.0484, 1.9858, 1.9716, 2.0854, 2.7726, 3.5053, 1.7365, 3.2607, 4.7006,
        1.8830, 0.3378, 2.6222, 0.6491, 3.1144, 3.8404, 2.0632, 4.3311, 4.6138,
        1.6119, 3.0444, 2.4498, 2.7860, 4.0832, 3.2681, 5.0069, 4.8745, 3.6048,
        3.5065, 1.8871, 2.9108, 0.9982, 0.6787, 1.4787, 5.6890, 1.5117, 4.0205,
        4.6624, 4.1051, 4.5437, 3.5410, 1.8761, 4.6653, 5.2577, 5.0311, 4.9531,
        4.0022, 4.7229, 4.0406, 2.5056, 3.2014, 2.9312, 1.3051, 1.3258, 4.9233,
        2.0871, 1.8761, 4.1304, 3.9279, 4.5547, 1.6639, 4.3163, 1.8149, 4.7431,
        3.4398, 3.5483, 3.2541, 2.8282, 1.5230, 2.8214, 4.9214, 3.5371, 4.4522,
        4.7928, 2.4932, 4.8619, 4.7693, 2.3121, 2.3021, 4.6609, 4.7478, 1.7768,
        5.3910, 2.8929, 2.4920, 4.1654, 1.8382, 3.4456, 3.7108, 2.3989, 1.0480,
        4.2870, 5.2730, 3.8976, 3.2956, 3.1010, 0.9666, 3.0227, 2.9491, 3.2218,
        1.4033, 1.7050, 0.5457, 3.1223, 2.1794, 3.9939, 5.0190, 2.9944, 4.5670,
        5.4131, 2.4720, 4.0239, 4.5689, 0.9386, 1.1827, 2.1553, 1.4232, 0.4127,
        1.7502, 1.5601, 2.0953, 2.3530, 2.7085, 2.7157, 2.7900, 4.6793, 1.1711,
        3.4493, 1.7701, 2.1576, 0.8294, 1.9908, 2.1975, 3.6396, 3.1952, 4.9882,
        4.0091, 2.9998, 1.9985, 3.0063, 3.7149, 4.2018, 1.1992, 2.2550, 3.5132,
        1.3794, 2.4434, 2.0220, 0.6691, 1.9927, 3.4666, 2.8342, 1.0393, 4.1834,
        4.0819, 0.8652, 4.8585, 2.0225, 2.9662, 3.9794, 1.0412, 3.0180, 1.0117,
        3.1728, 2.6027, 2.5184, 2.5120, 3.3483, 3.0602, 3.2139, 1.9144, 1.4899,
        2.8253, 2.9160, 1.6410, 3.8484, 2.9637, 2.1272, 2.0490, 4.4915, 1.6853,
        5.0641, 3.9315, 1.8812, 2.1028, 2.1203, 2.8898, 4.0215, 3.3032, 3.6131,
        4.8380, 0.7513, 3.4182, 3.0527, 3.6200, 1.3040, 1.1657, 4.2705, 4.8569,
        2.7037, 0.9142, 1.5261, 3.3970, 0.6980, 3.1131, 3.8348, 3.4478, 4.9488,
        4.0077, 4.9673, 2.0816, 0.9995, 3.4965, 3.2899, 1.0624, 1.4977, 4.3810,
        4.2225, 3.1540, 4.0191, 3.4060, 2.0160, 1.2814, 2.9608, 1.1513, 1.9530,
        0.9872, 3.9914, 4.9865, 3.0477, 1.9701, 2.5473, 4.6173, 0.5252, 3.4813,
        4.7750, 3.5971, 4.1422, 5.2524, 2.0691, 2.0039, 2.1420, 5.0156, 1.8481,
        0.7781, 2.2183, 2.6443, 2.2889, 4.3373, 2.2449, 4.5594, 3.8624, 5.2333,
        2.1537, 4.7373, 5.0298, 2.1322, 2.7047, 4.2308, 2.4907, 2.3259, 4.7678,
        5.0266, 5.2597, 4.7697, 0.9911, 1.0440, 2.7818, 1.1585, 2.1967, 4.4422,
        3.4151, 4.8498, 2.8759, 4.0001, 1.8111, 2.3611, 1.9162, 4.3893, 2.4916,
        2.0815, 3.9944, 5.5013, 4.6856, 4.9904, 4.9865, 4.0133, 1.7178, 2.2895,
        1.9270, 2.6042, 3.5529, 2.0969, 4.9558, 2.9138, 3.0347, 1.6650, 2.2754,
        3.7474, 0.9570, 2.3175, 4.1652, 4.4857, 5.1715, 5.4181, 3.7923, 4.0080,
        3.5960, 2.1456, 2.9088, 3.2796, 1.2589, 4.6664, 2.3447, 3.6577, 2.8478,
        2.8383, 2.9852, 0.9179, 3.0814, 1.2291, 0.7621, 0.8185, 2.3877, 1.1364,
        2.8636, 3.2811, 4.5790, 0.7829, 1.2192, 0.8060, 1.2341, 3.9681, 1.1422,
        4.9521, 5.1383, 2.8294, 3.6377, 3.8734, 3.5638, 2.9749, 1.5051, 1.4258,
        0.5846, 1.0630, 2.7671, 1.7912, 2.8734, 1.8916, 3.9858, 2.5439, 2.6786,
        1.6704, 1.3576, 1.7701, 2.0514, 5.1632, 2.6842, 4.8280, 1.1577, 2.9727,
        3.3256, 2.7693, 2.6430, 4.0140, 2.2755, 2.1973, 4.6792, 5.3522, 2.8058,
        4.9664, 5.2983, 4.7749, 3.8326, 2.4944, 4.2989, 2.8784, 2.0605, 2.8428,
        3.1081, 1.0411, 1.9078, 3.9594], grad_fn=&lt;SumBackward1&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb81" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, let's predict the ratings for our df dataframe</span></span>
<span id="cb81-2"></span>
<span id="cb81-3">A <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.from_numpy(df.values)</span>
<span id="cb81-4">A.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>torch.Size([45, 10])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb83" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1">mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>torch.isnan(A)</span>
<span id="cb83-2"></span>
<span id="cb83-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the indices of the non-NaN values</span></span>
<span id="cb83-4">i, j <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.where(mask)</span>
<span id="cb83-5"></span>
<span id="cb83-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the values of the non-NaN values</span></span>
<span id="cb83-7">v <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> A[mask]</span>
<span id="cb83-8"></span>
<span id="cb83-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Store in PyTorch tensors</span></span>
<span id="cb83-10">users <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> i.to(torch.int64)</span>
<span id="cb83-11">movies <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> j.to(torch.int64)</span>
<span id="cb83-12">ratings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> v.to(torch.float32)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb84" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1">pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'user'</span>: users, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'movie'</span>: movies, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'rating'</span>: ratings})</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">user</th>
<th data-quarto-table-cell-role="th">movie</th>
<th data-quarto-table-cell-role="th">rating</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>1</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>2</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>3</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>4</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">371</td>
<td>44</td>
<td>3</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">372</td>
<td>44</td>
<td>4</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">373</td>
<td>44</td>
<td>5</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">374</td>
<td>44</td>
<td>6</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">375</td>
<td>44</td>
<td>7</td>
<td>5.0</td>
</tr>
</tbody>
</table>

<p>376 rows  3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb85" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit the Matrix Factorization model</span></span>
<span id="cb85-2">n_users <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> A.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb85-3">n_movies <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> A.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb85-4">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MatrixFactorization(n_users, n_movies, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb85-5">optimizer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> optim.Adam(model.parameters(), lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb85-6"></span>
<span id="cb85-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>):</span>
<span id="cb85-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the loss</span></span>
<span id="cb85-9">    pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(users, movies)</span>
<span id="cb85-10">    loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.mse_loss(pred, ratings)</span>
<span id="cb85-11">    </span>
<span id="cb85-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Zero the gradients</span></span>
<span id="cb85-13">    optimizer.zero_grad()</span>
<span id="cb85-14">    </span>
<span id="cb85-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Backpropagate</span></span>
<span id="cb85-16">    loss.backward()</span>
<span id="cb85-17">    </span>
<span id="cb85-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Update the parameters</span></span>
<span id="cb85-19">    optimizer.step()</span>
<span id="cb85-20">    </span>
<span id="cb85-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print the loss</span></span>
<span id="cb85-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb85-23">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(loss.item())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>19.889324188232422
3.1148574352264404
0.6727441549301147
0.5543633103370667
0.5081750750541687
0.4629250764846802
0.4147825837135315
0.36878159642219543
0.32987719774246216
0.29975879192352295</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb87" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, let us predict the ratings for any user and movie from df for which we already have the ratings</span></span>
<span id="cb87-2"></span>
<span id="cb87-3">username <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Dhruv'</span></span>
<span id="cb87-4">movie <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'The Dark Knight'</span></span>
<span id="cb87-5"></span>
<span id="cb87-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the user and movie indices</span></span>
<span id="cb87-7">user_idx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.index.get_loc(username)</span>
<span id="cb87-8">movie_idx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.columns.get_loc(movie)</span>
<span id="cb87-9"></span>
<span id="cb87-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Predict the rating</span></span>
<span id="cb87-11">pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(torch.tensor([user_idx]), torch.tensor([movie_idx]))</span>
<span id="cb87-12">pred.item(), df.loc[username, movie]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>(5.259384632110596, 5.0)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb89" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1">df.loc[username]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>Sholay                      NaN
Swades (We The People)      NaN
The Matrix (I)              5.0
Interstellar                5.0
Dangal                      3.0
Taare Zameen Par            NaN
Shawshank Redemption        5.0
The Dark Knight             5.0
Notting Hill                4.0
Uri: The Surgical Strike    5.0
Name: Dhruv, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb91" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, let us predict the ratings for any user and movie from df for which we do not have the ratings</span></span>
<span id="cb91-2"></span>
<span id="cb91-3">username <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Dhruv'</span></span>
<span id="cb91-4">movie <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Sholay'</span></span>
<span id="cb91-5"></span>
<span id="cb91-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the user and movie indices</span></span>
<span id="cb91-7">user_idx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.index.get_loc(username)</span>
<span id="cb91-8">movie_idx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.columns.get_loc(movie)</span>
<span id="cb91-9"></span>
<span id="cb91-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Predict the rating</span></span>
<span id="cb91-11">pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(torch.tensor([user_idx]), torch.tensor([movie_idx]))</span>
<span id="cb91-12">pred, df.loc[username, movie]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>(tensor([3.7885], grad_fn=&lt;SumBackward1&gt;), nan)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb93" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Complete the matrix</span></span>
<span id="cb93-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> torch.no_grad():</span>
<span id="cb93-3">    completed_matrix <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(model.user_factors.weight <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> model.movie_factors.weight.t(), index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df.index, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df.columns)</span>
<span id="cb93-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># round to nearest integer</span></span>
<span id="cb93-5">    completed_matrix <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> completed_matrix.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>()</span></code></pre></div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb94" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1">completed_matrix.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sholay</th>
<th data-quarto-table-cell-role="th">Swades (We The People)</th>
<th data-quarto-table-cell-role="th">The Matrix (I)</th>
<th data-quarto-table-cell-role="th">Interstellar</th>
<th data-quarto-table-cell-role="th">Dangal</th>
<th data-quarto-table-cell-role="th">Taare Zameen Par</th>
<th data-quarto-table-cell-role="th">Shawshank Redemption</th>
<th data-quarto-table-cell-role="th">The Dark Knight</th>
<th data-quarto-table-cell-role="th">Notting Hill</th>
<th data-quarto-table-cell-role="th">Uri: The Surgical Strike</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Your name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Nipun</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gautam Vashishtha</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>2.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Eshan Gujarathi</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Sai Krishna Avula</td>
<td>4.0</td>
<td>4.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>6.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Ankit Yadav</td>
<td>3.0</td>
<td>2.0</td>
<td>3.0</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb95" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1">df.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Sholay</th>
<th data-quarto-table-cell-role="th">Swades (We The People)</th>
<th data-quarto-table-cell-role="th">The Matrix (I)</th>
<th data-quarto-table-cell-role="th">Interstellar</th>
<th data-quarto-table-cell-role="th">Dangal</th>
<th data-quarto-table-cell-role="th">Taare Zameen Par</th>
<th data-quarto-table-cell-role="th">Shawshank Redemption</th>
<th data-quarto-table-cell-role="th">The Dark Knight</th>
<th data-quarto-table-cell-role="th">Notting Hill</th>
<th data-quarto-table-cell-role="th">Uri: The Surgical Strike</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Your name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Nipun</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gautam Vashishtha</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>3.0</td>
<td>1.0</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Eshan Gujarathi</td>
<td>4.0</td>
<td>NaN</td>
<td>5.0</td>
<td>5.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>5.0</td>
<td>NaN</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Sai Krishna Avula</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
<td>4.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Ankit Yadav</td>
<td>3.0</td>
<td>3.0</td>
<td>2.0</td>
<td>5.0</td>
<td>2.0</td>
<td>5.0</td>
<td>5.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/movie-recommendation-knn-mf.html</guid>
  <pubDate>Fri, 14 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Parametric v/s Non-Parametric</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/parametric-non-parametric.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.linear_model <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> LinearRegression, LogisticRegression</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.neighbors <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> KNeighborsClassifier, KNeighborsRegressor</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.tree <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DecisionTreeClassifier, DecisionTreeRegressor</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.neural_network <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> MLPClassifier, MLPRegressor</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span>
<span id="cb1-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>config InlineBackend.figure_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retina'</span></span></code></pre></div>
</div>
<p>Aim:</p>
<p>Given Dataset (X, y), learn a function <code>f</code> that maps <code>X</code> to <code>y</code>, i.e.&nbsp;<code>y = f(X)</code>.</p>
<p>We will consider two cases: - Parametric: <code>f</code> is a function of a fixed number of parameters, e.g.&nbsp;<code>f(x) = ax + b</code> - Non-parametric: <code>f</code> is a function of number of parameters that grows with the size of the dataset.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Dataset for classification. Trivial dataset with 1 point in each class.</span></span>
<span id="cb2-2"></span>
<span id="cb2-3">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span>
<span id="cb2-4">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span></code></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the dataset</span></span>
<span id="cb3-2"></span>
<span id="cb3-3">plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'viridis'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f772d036640&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/parametric-non-parametric_files/figure-html/cell-4-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the decision boundary of a logistic regression classifier, KNN classifier, decision tree classifier, and a neural network classifier.</span></span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> plot_decision_boundary(model, X, y):</span>
<span id="cb5-4">    h <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span></span>
<span id="cb5-5">    x_min, x_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span>, X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span></span>
<span id="cb5-6">    y_min, y_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span>, X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span></span>
<span id="cb5-7">    xx, yy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.meshgrid(np.arange(x_min, x_max, h), np.arange(y_min, y_max, h))</span>
<span id="cb5-8">    Z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.predict(np.c_[xx.ravel(), yy.ravel()])</span>
<span id="cb5-9">    Z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Z.reshape(xx.shape)</span>
<span id="cb5-10">    plt.contourf(xx, yy, Z, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'viridis'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>)</span>
<span id="cb5-11">    plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'viridis'</span>)</span>
<span id="cb5-12">    plt.xlim(xx.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(), xx.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>())</span>
<span id="cb5-13">    plt.ylim(yy.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(), yy.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>())</span>
<span id="cb5-14"></span>
<span id="cb5-15">    </span></code></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Instantiate the models</span></span>
<span id="cb6-2"></span>
<span id="cb6-3">lr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LogisticRegression()</span>
<span id="cb6-4">knn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> KNeighborsClassifier(n_neighbors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-5">dt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DecisionTreeClassifier()</span>
<span id="cb6-6">nn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MLPClassifier(hidden_layer_sizes<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), activation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'logistic'</span>, max_iter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>)</span>
<span id="cb6-7"></span>
<span id="cb6-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the decision boundaries</span></span>
<span id="cb6-9"></span>
<span id="cb6-10">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>))</span>
<span id="cb6-11"></span>
<span id="cb6-12"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i, model <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>([lr, knn, dt, nn]):</span>
<span id="cb6-13">    plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-14">    model.fit(X, y)</span>
<span id="cb6-15">    plot_decision_boundary(model, X, y)</span>
<span id="cb6-16">    plt.title(model.__class__.<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/parametric-non-parametric_files/figure-html/cell-6-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="learnt-functions" class="level2">
<h2 class="anchored" data-anchor-id="learnt-functions">Learnt functions</h2>
<section id="logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression">Logistic Regression</h3>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">logits <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> w <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b</span>
<span id="cb7-2">prob <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sigmoid(logits)</span>
<span id="cb7-3">y_pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> prob <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span></code></pre></div>
</section>
<section id="decision-tree" class="level3">
<h3 class="anchored" data-anchor-id="decision-tree">Decision Tree</h3>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.tree <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> export_graphviz</span>
<span id="cb8-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> graphviz</span>
<span id="cb8-3"></span>
<span id="cb8-4">dot_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> export_graphviz(dt, out_file<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, feature_names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x1'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x2'</span>], class_names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'0'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'1'</span>], filled<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, rounded<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, special_characters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb8-5">graph <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> graphviz.Source(dot_data)</span>
<span id="cb8-6">graph</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/parametric-non-parametric_files/figure-html/cell-7-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="mlp" class="level3">
<h3 class="anchored" data-anchor-id="mlp">MLP</h3>
<pre><code>logits = nn.predict(X)
probs = sigmoid(logits)
y_pred = probs&gt;0.5</code></pre>
</section>
<section id="knn" class="level3">
<h3 class="anchored" data-anchor-id="knn">KNN</h3>
<pre><code>if X1 &lt; 0.5 and X2 &lt; 0.5:
    y = 0
elif X1 &lt; 0.5 and X2 &gt;= 0.5:
    ...</code></pre>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sophisticated dataset with 2 classes</span></span>
<span id="cb11-2"></span>
<span id="cb11-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.datasets <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> make_blobs</span>
<span id="cb11-4"></span>
<span id="cb11-5">X, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> make_blobs(n_samples<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, centers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, n_features<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, cluster_std<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb11-6"></span>
<span id="cb11-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the dataset</span></span>
<span id="cb11-8"></span>
<span id="cb11-9">plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'viridis'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f7a011d2d30&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/parametric-non-parametric_files/figure-html/cell-8-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">lr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LogisticRegression()</span>
<span id="cb13-2">knn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> KNeighborsClassifier(n_neighbors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-3">dt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DecisionTreeClassifier()</span>
<span id="cb13-4">nn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MLPClassifier(hidden_layer_sizes<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), activation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'logistic'</span>, max_iter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>)</span>
<span id="cb13-5"></span>
<span id="cb13-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the decision boundaries</span></span>
<span id="cb13-7"></span>
<span id="cb13-8">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>))</span>
<span id="cb13-9"></span>
<span id="cb13-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i, model <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>([lr, knn, dt, nn]):</span>
<span id="cb13-11">    plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-12">    model.fit(X, y)</span>
<span id="cb13-13">    plot_decision_boundary(model, X, y)</span>
<span id="cb13-14">    plt.title(model.__class__.<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/parametric-non-parametric_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">dot_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> export_graphviz(dt, out_file<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, feature_names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x1'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x2'</span>], class_names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'0'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'1'</span>], filled<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, rounded<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, special_characters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb14-2">graph <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> graphviz.Source(dot_data)</span>
<span id="cb14-3">graph</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/parametric-non-parametric_files/figure-html/cell-10-output-1.svg" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">dt.get_depth(), dt.get_n_leaves()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>(9, 24)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">lr.coef_</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>array([[ 0.19758375, -0.7298237 ]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, more noise</span></span>
<span id="cb19-2"></span>
<span id="cb19-3">X, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> make_blobs(n_samples<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, centers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, n_features<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, cluster_std<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb19-4"></span>
<span id="cb19-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the dataset</span></span>
<span id="cb19-6"></span>
<span id="cb19-7">plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y, cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'viridis'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f772abcffa0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/parametric-non-parametric_files/figure-html/cell-13-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">lr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LogisticRegression()</span>
<span id="cb21-2">knn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> KNeighborsClassifier(n_neighbors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb21-3">dt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DecisionTreeClassifier()</span>
<span id="cb21-4">nn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MLPClassifier(hidden_layer_sizes<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), activation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'logistic'</span>, max_iter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>)</span>
<span id="cb21-5"></span>
<span id="cb21-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the decision boundaries</span></span>
<span id="cb21-7"></span>
<span id="cb21-8">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>))</span>
<span id="cb21-9"></span>
<span id="cb21-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i, model <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>([lr, knn, dt, nn]):</span>
<span id="cb21-11">    plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb21-12">    model.fit(X, y)</span>
<span id="cb21-13">    plot_decision_boundary(model, X, y)</span>
<span id="cb21-14">    plt.title(model.__class__.<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/parametric-non-parametric_files/figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1">dot_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> export_graphviz(dt, out_file<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, feature_names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x1'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x2'</span>], class_names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'0'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'1'</span>], filled<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, rounded<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, special_characters<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb22-2">graph <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> graphviz.Source(dot_data)</span>
<span id="cb22-3">graph</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/parametric-non-parametric_files/figure-html/cell-15-output-1.svg" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1">dt.get_depth(), dt.get_n_leaves()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>(11, 36)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">lr.coef_</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>array([[ 0.03933004, -0.10323595]])</code></pre>
</div>
</div>


</section>
</section>

 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/parametric-non-parametric.html</guid>
  <pubDate>Thu, 13 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>1d CNN</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/1d-cnn.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.nn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> nn</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.nn.functional <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> F</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.optim <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> optim</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> torch.utils.data <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DataLoader, TensorDataset</span>
<span id="cb1-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> seaborn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sns</span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span>
<span id="cb1-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>config InlineBackend.figure_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retina'</span></span>
<span id="cb1-14"></span>
<span id="cb1-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set random seed for reproducibility</span></span>
<span id="cb1-16">torch.manual_seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb1-17"></span>
<span id="cb1-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Torch version</span></span>
<span id="cb1-19">torch.__version__</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>'2.0.0+cu118'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simple 1d dataset</span></span>
<span id="cb3-2"></span>
<span id="cb3-3">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.Tensor([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb3-4">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(y))</span>
<span id="cb3-5"></span>
<span id="cb3-6">plt.plot(x, y, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o-'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/1d-cnn_files/figure-html/cell-3-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter 1 (detect silence)</span></span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> torch.no_grad():</span>
<span id="cb4-4">    f1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Conv1d(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, padding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-5">    f1.weight.data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.Tensor([[[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]])</span>
<span id="cb4-6">    f1.bias.data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.Tensor([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb4-7">    y1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.relu(f1(y.view(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))).view(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-8"></span>
<span id="cb4-9">plt.plot(x, y, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o-'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'original'</span>)</span>
<span id="cb4-10">plt.plot(x, y1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o-'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'filtered f1 (silence)'</span>)</span>
<span id="cb4-11">plt.legend()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>&lt;matplotlib.legend.Legend at 0x7efecfcccb80&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/1d-cnn_files/figure-html/cell-4-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter 2 (detect falling edge)</span></span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> torch.no_grad():</span>
<span id="cb6-4">    f2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Conv1d(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, padding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-5">    f2.weight.data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.Tensor([[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]])</span>
<span id="cb6-6">    f2.bias.data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.Tensor([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb6-7">    y2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.relu(f2(y.view(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))).view(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-8"></span>
<span id="cb6-9">plt.plot(x, y, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o-'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'original'</span>)</span>
<span id="cb6-10">plt.plot(x, y2, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o-'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'filtered f2 (falling edge)'</span>)</span>
<span id="cb6-11">plt.legend()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>&lt;matplotlib.legend.Legend at 0x7efecfbc7250&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/1d-cnn_files/figure-html/cell-5-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter 3 (detect rising edge)</span></span>
<span id="cb8-2"></span>
<span id="cb8-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> torch.no_grad():</span>
<span id="cb8-4">    f3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Conv1d(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, padding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-5">    f3.weight.data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.Tensor([[[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]])</span>
<span id="cb8-6">    f3.bias.data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.Tensor([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb8-7">    y3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.relu(f3(y.view(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))).view(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-8"></span>
<span id="cb8-9">plt.plot(x, y, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o-'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'original'</span>)</span>
<span id="cb8-10">plt.plot(x, y3, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o-'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'filtered f3 (rising edge)'</span>)</span>
<span id="cb8-11">plt.legend()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>&lt;matplotlib.legend.Legend at 0x7efecfbb88e0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/1d-cnn_files/figure-html/cell-6-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter 4 (detect high amplitude)</span></span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> torch.no_grad():</span>
<span id="cb10-4">    f4 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Conv1d(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, padding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-5">    f4.weight.data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.Tensor([[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]])</span>
<span id="cb10-6">    f4.bias.data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.Tensor([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb10-7">    y4 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.relu(f4(y.view(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))).view(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-8"></span>
<span id="cb10-9">plt.plot(x, y, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o-'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'original'</span>) </span>
<span id="cb10-10">plt.plot(x, y4, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o-'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'filtered f4 (high amplitude)'</span>)</span>
<span id="cb10-11">plt.legend()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>&lt;matplotlib.legend.Legend at 0x7efecfb2dfd0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/1d-cnn_files/figure-html/cell-7-output-2.png" class="img-fluid"></p>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/1d-cnn.html</guid>
  <pubDate>Tue, 04 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Autodiff</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/autodiff-helper.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.nn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> nn</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.nn.functional <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> F</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.optim <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> optim</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> torch.utils.data <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DataLoader, TensorDataset</span>
<span id="cb1-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> seaborn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sns</span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span>
<span id="cb1-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>config InlineBackend.figure_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retina'</span></span>
<span id="cb1-14"></span>
<span id="cb1-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set random seed for reproducibility</span></span>
<span id="cb1-16">torch.manual_seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb1-17"></span>
<span id="cb1-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Torch version</span></span>
<span id="cb1-19">torch.__version__</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>'2.0.0+cu118'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">theta_0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.tensor(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, requires_grad<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb3-2">theta_1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.tensor(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, requires_grad<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb3-3">theta_2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.tensor(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span>, requires_grad<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb3-4"></span>
<span id="cb3-5">x1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.tensor(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>)</span>
<span id="cb3-6">x2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.tensor(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span>)</span>
<span id="cb3-7"></span>
<span id="cb3-8">f1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> theta_1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x1</span>
<span id="cb3-9">f2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> theta_2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x2</span>
<span id="cb3-10"></span>
<span id="cb3-11">f3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> f2</span>
<span id="cb3-12"></span>
<span id="cb3-13">f4 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> theta_0</span>
<span id="cb3-14"></span>
<span id="cb3-15">f5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f4<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-16"></span>
<span id="cb3-17">f6 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.exp(f5)</span>
<span id="cb3-18"></span>
<span id="cb3-19">f7 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> f6</span>
<span id="cb3-20"></span>
<span id="cb3-21">f8 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>f7</span>
<span id="cb3-22"></span>
<span id="cb3-23">f9 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.log(f8)</span>
<span id="cb3-24"></span>
<span id="cb3-25">L <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f9<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-26"></span>
<span id="cb3-27">all_nodes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"theta_0"</span>: theta_0, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"theta_1"</span>: theta_1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"theta_2"</span>: theta_2,  </span>
<span id="cb3-28">             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f1"</span>: f1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f2"</span>: f2, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f3"</span>: f3, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f4"</span>: f4, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f5"</span>: f5, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f6"</span>: f6, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f7"</span>: f7, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f8"</span>: f8, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f9"</span>: f9, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"L"</span>: L}</span>
<span id="cb3-29"></span>
<span id="cb3-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retain grad for all nodes</span></span>
<span id="cb3-31"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> node <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_nodes.values():</span>
<span id="cb3-32">    node.retain_grad()</span></code></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print out the function evaluation for all nodes along with name of the node</span></span>
<span id="cb4-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> name, node <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_nodes.items():</span>
<span id="cb4-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>node<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>item()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>theta_0: 1.0
theta_1: 1.0
theta_2: 2.0
f1: 1.0
f2: 4.0
f3: 5.0
f4: 6.0
f5: -6.0
f6: 0.0024787522852420807
f7: 1.0024787187576294
f8: 0.9975274205207825
f9: -0.0024756414350122213
L: 0.0024756414350122213</code></pre>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">L.backward()</span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print out the gradient for all nodes along with name of the node</span></span>
<span id="cb6-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> name, node <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> all_nodes.items():</span>
<span id="cb6-5">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>node<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>grad<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>item()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>theta_0: -0.00247262348420918
theta_1: -0.00247262348420918
theta_2: -0.00494524696841836
f1: -0.00247262348420918
f2: -0.00247262348420918
f3: -0.00247262348420918
f4: -0.00247262348420918
f5: 0.00247262348420918
f6: 0.9975274801254272
f7: 0.9975274801254272
f8: -1.0024787187576294
f9: -1.0
L: 1.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(f7<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00247</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>tensor(0.9975, grad_fn=&lt;MulBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">torch.exp(f5)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9975</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>tensor(0.0025, grad_fn=&lt;MulBackward0&gt;)</code></pre>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/autodiff-helper.html</guid>
  <pubDate>Tue, 04 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>KNN LSH</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/knn-lsh.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span>
<span id="cb1-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>config InlineBackend.figure_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retina'</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate some data</span></span>
<span id="cb2-2"></span>
<span id="cb2-3">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.randn(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the data</span></span>
<span id="cb2-6"></span>
<span id="cb2-7">plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f321da32c10&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/knn-lsh_files/figure-html/cell-3-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Naive KNN</span></span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> naive_knn_for_loop(X, x_test, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>):</span>
<span id="cb4-4">    dists <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(X.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb4-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(X.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]): <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># N iterations (N = number of data points)</span></span>
<span id="cb4-6">        dists[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.dot(X[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_test, X[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_test) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Time complexity: O(D)</span></span>
<span id="cb4-7">    </span>
<span id="cb4-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Time complexity to create the distance array: O(N*D)</span></span>
<span id="cb4-9"></span>
<span id="cb4-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, we need to find the k smallest distances</span></span>
<span id="cb4-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> np.argpartition(dists, k)[:k] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Time complexity: O(Nk) or O(N) depending on the implementation</span></span>
<span id="cb4-12">  </span></code></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">naive_knn_for_loop(X, np.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>array([2529,  958,  804])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">X[naive_knn_for_loop(X, np.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]))]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>array([[-0.02103967,  0.02703294],
       [ 0.0092843 ,  0.02548091],
       [-0.03094897,  0.01750535]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>timeit naive_knn_for_loop(X, np.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>12.3 ms  47.7 s per loop (mean  std. dev. of 7 runs, 100 loops each)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Implement using numpy</span></span>
<span id="cb11-2"></span>
<span id="cb11-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> naive_knn_numpy(X, x_test, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>):</span>
<span id="cb11-4">    dists <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>((X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_test)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb11-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#return np.partition(dists, k)[:k]</span></span>
<span id="cb11-6">    sorted_dists <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.argsort(dists)</span>
<span id="cb11-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> sorted_dists[:k]</span></code></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">naive_knn_numpy(X, np.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]))</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>array([ 958, 2529,  804])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>timeit naive_knn_numpy(X, np.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>240 s  631 ns per loop (mean  std. dev. of 7 runs, 1,000 loops each)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Implement using numpy</span></span>
<span id="cb16-2"></span>
<span id="cb16-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> naive_knn_numpy(X, x_test, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>):</span>
<span id="cb16-4">    dists <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>((X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_test)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb16-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> np.argpartition(dists, k)[:k]</span>
<span id="cb16-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#sorted_dists = np.argsort(dists)</span></span>
<span id="cb16-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#return sorted_dists[:k]</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>timeit naive_knn_numpy(X, np.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>84.6 s  607 ns per loop (mean  std. dev. of 7 runs, 10,000 loops each)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Show LSH implementation step by step</span></span>
<span id="cb19-2"></span>
<span id="cb19-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Creating a random separating hyperplane</span></span>
<span id="cb19-4"></span>
<span id="cb19-5">w <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.randn(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb19-6">b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.randn(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.0</span></span>
<span id="cb19-7"></span>
<span id="cb19-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the separating hyperplane</span></span>
<span id="cb19-9"></span>
<span id="cb19-10">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb19-11">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(w[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> w[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb19-12"></span>
<span id="cb19-13">plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span>
<span id="cb19-14">plt.plot(x, y, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb19-15"></span>
<span id="cb19-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Color the points based on which side of the hyperplane they are on</span></span>
<span id="cb19-17"></span>
<span id="cb19-18">colors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>w[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>w[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb19-19"></span>
<span id="cb19-20">plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>colors)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f31106b4ac0&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/knn-lsh_files/figure-html/cell-13-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create three random hyperplanes and color the points based on which side of the hyperplane they are on. </span></span>
<span id="cb21-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># there should be 2^3 = 8 different colors</span></span>
<span id="cb21-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># each separating hyperplane corresponds to a bit in the hash</span></span>
<span id="cb21-4"></span>
<span id="cb21-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">hash</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((X.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)).astype(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>)</span>
<span id="cb21-6">ws <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb21-7">bs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb21-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cost for creating the hash table: O(N*H*D) </span></span>
<span id="cb21-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> H <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>): <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># H = number of hyperplanes</span></span>
<span id="cb21-10">    w <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.randn(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb21-11">    b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.randn(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.0</span></span>
<span id="cb21-12">    ws.append(w)</span>
<span id="cb21-13">    bs.append(b)</span>
<span id="cb21-14">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">hash</span>[:, H] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>w[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>w[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># D computations per iteration</span></span>
<span id="cb21-15"></span>
<span id="cb21-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert the hash to a decimal number</span></span>
<span id="cb21-17"></span>
<span id="cb21-18">hash_dec <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">hash</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)[::<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb21-19"></span>
<span id="cb21-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the hash</span></span>
<span id="cb21-21"></span>
<span id="cb21-22">plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">hash</span>)</span>
<span id="cb21-23"></span>
<span id="cb21-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the hash with the separating hyperplanes</span></span>
<span id="cb21-25"></span>
<span id="cb21-26">plt.scatter(X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>hash_dec)</span>
<span id="cb21-27"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> w, b <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(ws, bs):</span>
<span id="cb21-28">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(w, b)</span>
<span id="cb21-29">    x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb21-30">    y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(w[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> w[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb21-31">    plt.plot(x, y, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>)</span>
<span id="cb21-32"></span>
<span id="cb21-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mark the test point</span></span>
<span id="cb21-34"></span>
<span id="cb21-35">x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb21-36">plt.scatter(x_test[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], x_test[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[-1.78798897 -1.3408181 ] [-0.08094113]
[ 0.9447324  -2.47059549] [0.09350769]
[0.20531227 0.97521902] [-0.22471283]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f31105bf280&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/knn-lsh_files/figure-html/cell-14-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">hash</span>)</span>
<span id="cb24-2">df.columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'h1'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'h2'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'h3'</span>]</span>
<span id="cb24-3">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'hash_dec'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> hash_dec</span>
<span id="cb24-4">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb24-5">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb24-6"></span>
<span id="cb24-7">df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">h1</th>
<th data-quarto-table-cell-role="th">h2</th>
<th data-quarto-table-cell-role="th">h3</th>
<th data-quarto-table-cell-role="th">hash_dec</th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>6</td>
<td>-1.289013</td>
<td>-0.497073</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>6</td>
<td>0.721631</td>
<td>-1.923390</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>6</td>
<td>0.042595</td>
<td>-0.177549</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>6</td>
<td>0.148706</td>
<td>-0.452442</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>6</td>
<td>-0.047372</td>
<td>-0.431685</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>6</td>
<td>-0.478764</td>
<td>-0.304759</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>2</td>
<td>0.812057</td>
<td>-0.574337</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>5</td>
<td>-1.493164</td>
<td>1.209339</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>2</td>
<td>0.820065</td>
<td>-0.575965</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1.045276</td>
<td>1.143788</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"></span>
<span id="cb25-2">pd.DataFrame(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">hash</span>).value_counts()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>0  1  2
1  1  0    846
0  0  1    827
   1  0    491
1  0  0    346
      1    243
0  1  1    210
   0  0     37
dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Predict the K nearest neighbors using LSH</span></span>
<span id="cb27-2"></span>
<span id="cb27-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the hash for the test point</span></span>
<span id="cb27-4"></span>
<span id="cb27-5">x_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb27-6">hash_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x_test[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>ws[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> x_test[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>ws[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb27-7"></span>
<span id="cb27-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#convert to decimal</span></span>
<span id="cb27-9">hash_test_dec <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(hash_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)[::<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb27-10"></span>
<span id="cb27-11">hash_test_dec</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find subset of points with the same hash</span></span>
<span id="cb29-2"></span>
<span id="cb29-3">X_subset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[hash_dec <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> hash_test_dec]</span>
<span id="cb29-4">X_subset.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>(37, 2)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, we can use the naive KNN implementation to find the K nearest neighbors</span></span>
<span id="cb31-2"></span>
<span id="cb31-3">ix <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> naive_knn_numpy(X_subset, x_test, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb31-4">X_subset[ix]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>array([[-0.04090763,  0.07013394],
       [-0.00419256,  0.08614131],
       [-0.05284791,  0.06786371]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>timeit naive_knn_numpy(X_subset, x_test, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>10.5 s  31.4 ns per loop (mean  std. dev. of 7 runs, 100,000 loops each)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Using FAISS from Facebook</span></span>
<span id="cb35-2"></span>
<span id="cb35-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> faiss</span>
<span id="cb35-4"></span>
<span id="cb35-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create an index</span></span>
<span id="cb35-6">index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.IndexFlatL2(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># build the index</span></span>
<span id="cb35-7"></span>
<span id="cb35-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the data to the index</span></span>
<span id="cb35-9">index.add(X.astype(np.float32))                  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add vectors to the index</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Search for the K nearest neighbors</span></span>
<span id="cb36-2">D, I <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> index.search(x_test.astype(np.float32).reshape(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># actual search</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1">D</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>array([[0.00073547, 0.00117345, 0.00126428]], dtype=float32)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1">I</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>array([[ 958, 2529,  804]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1">X[I[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>array([[ 0.0092843 ,  0.02548091],
       [-0.02103967,  0.02703294],
       [-0.03094897,  0.01750535]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>timeit index.search(x_test.astype(np.float32).reshape(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>50.9 s  212 ns per loop (mean  std. dev. of 7 runs, 10,000 loops each)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, run on GPU</span></span>
<span id="cb45-2"></span>
<span id="cb45-3">res <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.StandardGpuResources()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use a single GPU</span></span>
<span id="cb45-4"></span>
<span id="cb45-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create an index</span></span>
<span id="cb45-6">index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.IndexFlatL2(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># build the index</span></span>
<span id="cb45-7"></span>
<span id="cb45-8">gpu_index_flat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> faiss.index_cpu_to_gpu(res, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, index)</span>
<span id="cb45-9"></span>
<span id="cb45-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the data to the index</span></span>
<span id="cb45-11">gpu_index_flat.add(X.astype(np.float32))                  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># add vectors to the index</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>timeit gpu_index_flat.search(x_test.astype(np.float32).reshape(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>79.8 s  674 ns per loop (mean  std. dev. of 7 runs, 10,000 loops each)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The above is slow because</span></span>
<span id="cb48-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. We are copying the data to the GPU</span></span>
<span id="cb48-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. We are copying the data back to the CPU</span></span>
<span id="cb48-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Not enough data and low dimensional data</span></span></code></pre></div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/knn-lsh.html</guid>
  <pubDate>Tue, 04 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>CNN</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/cnn.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.nn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> nn</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.nn.functional <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> F</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.optim <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> optim</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> torch.utils.data <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DataLoader, TensorDataset</span>
<span id="cb1-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> seaborn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sns</span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span>
<span id="cb1-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>config InlineBackend.figure_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retina'</span></span>
<span id="cb1-14"></span>
<span id="cb1-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set random seed for reproducibility</span></span>
<span id="cb1-16">torch.manual_seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb1-17"></span>
<span id="cb1-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Torch version</span></span>
<span id="cb1-19">torch.__version__</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>'2.0.0+cu118'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># MNIST dataset</span></span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> torchvision <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datasets, transforms</span>
<span id="cb3-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torchvision</span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Split MNIST into train, validation, and test sets</span></span>
<span id="cb3-7">train_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datasets.MNIST(root<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>, train<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, download<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, transform<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>transforms.ToTensor())</span>
<span id="cb3-8">test_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datasets.MNIST(root<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>, train<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, download<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, transform<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>transforms.ToTensor())</span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Split train_data into train and validation sets</span></span>
<span id="cb3-11">val_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.utils.data.Subset(train_data, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51000</span>))</span>
<span id="cb3-12"></span>
<span id="cb3-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reduce the size of the training set to 5,000</span></span>
<span id="cb3-14">train_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.utils.data.Subset(train_data, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>))</span></code></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data loaders</span></span>
<span id="cb4-2">batch_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span></span>
<span id="cb4-3"></span>
<span id="cb4-4">train_loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataLoader(train_data, batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>batch_size, shuffle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb4-5">val_loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataLoader(val_data, batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>batch_size, shuffle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb4-6">test_loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataLoader(test_data, batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>batch_size, shuffle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">img, target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">next</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">iter</span>(train_loader))</span>
<span id="cb5-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(img.shape)</span>
<span id="cb5-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(target.shape)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch.Size([64, 1, 28, 28])
torch.Size([64])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">plt.imshow(img[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].numpy().squeeze(), cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray_r'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-6-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">img[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>torch.Size([1, 28, 28])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a simple LeNet like CNN</span></span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> LeNet5(nn.Module):</span>
<span id="cb10-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb10-5">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>(LeNet5, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>).<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>()</span>
<span id="cb10-6">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 input image channel, 6 output channels, 5x5 square convolution</span></span>
<span id="cb10-7">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.conv1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Conv2d(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) </span>
<span id="cb10-8">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 6 input image channel, 16 output channels, 5x5 square convolution</span></span>
<span id="cb10-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.conv2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Conv2d(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb10-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fc1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Linear(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>)</span>
<span id="cb10-11">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fc2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Linear(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">84</span>)</span>
<span id="cb10-12">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fc3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Linear(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">84</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb10-13">        </span>
<span id="cb10-14">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> forward(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, x):</span>
<span id="cb10-15">        x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.conv1(x) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 28x28x1 -&gt; 24x24x6</span></span>
<span id="cb10-16">        x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.max_pool2d(F.relu(x), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 24x24x6 -&gt; 12x12x6</span></span>
<span id="cb10-17">        x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.conv2(x) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 12x12x6 -&gt; 8x8x16</span></span>
<span id="cb10-18">        x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.max_pool2d(F.relu(x), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 8x8x16 -&gt; 4x4x16</span></span>
<span id="cb10-19">        x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x.view(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.num_flat_features(x)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4x4x16 -&gt; 256</span></span>
<span id="cb10-20">        x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fc1(x) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 256 -&gt; 120</span></span>
<span id="cb10-21">        x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.relu(x)</span>
<span id="cb10-22">        x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fc2(x) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 120 -&gt; 84</span></span>
<span id="cb10-23">        x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.relu(x)</span>
<span id="cb10-24">        x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fc3(x) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 84 -&gt; 10</span></span>
<span id="cb10-25">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> x</span>
<span id="cb10-26">    </span>
<span id="cb10-27">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> num_flat_features(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, x):</span>
<span id="cb10-28">        size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x.size()[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:]</span>
<span id="cb10-29">        num_features <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb10-30">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> size:</span>
<span id="cb10-31">            num_features <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*=</span> s</span>
<span id="cb10-32">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> num_features</span></code></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a model</span></span>
<span id="cb11-2"></span>
<span id="cb11-3">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LeNet5()</span>
<span id="cb11-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(model)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>LeNet5(
  (conv1): Conv2d(1, 6, kernel_size=(5, 5), stride=(1, 1))
  (conv2): Conv2d(6, 16, kernel_size=(5, 5), stride=(1, 1))
  (fc1): Linear(in_features=256, out_features=120, bias=True)
  (fc2): Linear(in_features=120, out_features=84, bias=True)
  (fc3): Linear(in_features=84, out_features=10, bias=True)
)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train the model</span></span>
<span id="cb13-2"></span>
<span id="cb13-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define the loss and optimizer</span></span>
<span id="cb13-4">criterion <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.CrossEntropyLoss()</span>
<span id="cb13-5">optimizer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> optim.Adam(model.parameters(), lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>)</span>
<span id="cb13-6"></span>
<span id="cb13-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train the model</span></span>
<span id="cb13-8">n_epochs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb13-9"></span>
<span id="cb13-10">train_losses <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb13-11">val_losses <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb13-12"></span>
<span id="cb13-13"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> epoch <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_epochs):</span>
<span id="cb13-14">    train_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb13-15">    val_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb13-16">    </span>
<span id="cb13-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train the model</span></span>
<span id="cb13-18">    model.train()</span>
<span id="cb13-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> data, target <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> train_loader:</span>
<span id="cb13-20">        optimizer.zero_grad()</span>
<span id="cb13-21">        output <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(data)</span>
<span id="cb13-22">        loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> criterion(output, target)</span>
<span id="cb13-23">        loss.backward()</span>
<span id="cb13-24">        optimizer.step()</span>
<span id="cb13-25">        train_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> loss.item()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>data.size(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb13-26">        </span>
<span id="cb13-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Evaluate the model</span></span>
<span id="cb13-28">    model.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">eval</span>()</span>
<span id="cb13-29">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> data, target <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> val_loader:</span>
<span id="cb13-30">        output <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(data)</span>
<span id="cb13-31">        loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> criterion(output, target)</span>
<span id="cb13-32">        val_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> loss.item()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>data.size(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb13-33">        </span>
<span id="cb13-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate average losses</span></span>
<span id="cb13-35">    train_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train_loss<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(train_loader.sampler)</span>
<span id="cb13-36">    val_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> val_loss<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(val_loader.sampler)</span>
<span id="cb13-37">    train_losses.append(train_loss)</span>
<span id="cb13-38">    val_losses.append(val_loss)</span>
<span id="cb13-39">    </span>
<span id="cb13-40">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print training/validation statistics </span></span>
<span id="cb13-41">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Epoch: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Training Loss: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{:.6f}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Validation Loss: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{:.6f}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(</span>
<span id="cb13-42">        epoch<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, </span>
<span id="cb13-43">        train_loss,</span>
<span id="cb13-44">        val_loss</span>
<span id="cb13-45">        ))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch: 1    Training Loss: 1.437300     Validation Loss: 0.653900
Epoch: 2    Training Loss: 0.424091     Validation Loss: 0.367598
Epoch: 3    Training Loss: 0.303504     Validation Loss: 0.308797
Epoch: 4    Training Loss: 0.219186     Validation Loss: 0.257062
Epoch: 5    Training Loss: 0.195089     Validation Loss: 0.214157
Epoch: 6    Training Loss: 0.153489     Validation Loss: 0.190220
Epoch: 7    Training Loss: 0.130065     Validation Loss: 0.189110
Epoch: 8    Training Loss: 0.114033     Validation Loss: 0.173153
Epoch: 9    Training Loss: 0.103402     Validation Loss: 0.167645
Epoch: 10   Training Loss: 0.089715     Validation Loss: 0.156438</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the training and validation loss</span></span>
<span id="cb15-2"></span>
<span id="cb15-3">plt.plot(train_losses, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Training loss'</span>)</span>
<span id="cb15-4">plt.plot(val_losses, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Validation loss'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Test the model</span></span>
<span id="cb16-2"></span>
<span id="cb16-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> torch.no_grad():</span>
<span id="cb16-4">    correct <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb16-5">    total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb16-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> data, target <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> test_loader:</span>
<span id="cb16-7">        output <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(data)</span>
<span id="cb16-8">        _, predicted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(output.data, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb16-9">        total <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> target.size(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb16-10">        correct <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> (predicted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> target).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>().item()</span>
<span id="cb16-11"></span>
<span id="cb16-12">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Test Accuracy: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">%'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> correct <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> total))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test Accuracy: 96.1%</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, let us take an image and walk it through the model</span></span>
<span id="cb18-2"></span>
<span id="cb18-3">test_img <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train_data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].unsqueeze(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">plt.imshow(test_img.numpy().squeeze(), cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray_r'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get weights and biases from the first convolutional layer</span></span>
<span id="cb20-2"></span>
<span id="cb20-3">weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.conv1.weight.data</span>
<span id="cb20-4">w <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> weights.numpy()</span>
<span id="cb20-5"></span>
<span id="cb20-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the weights</span></span>
<span id="cb20-7"></span>
<span id="cb20-8">fig, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb20-9">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> axes.ravel()</span>
<span id="cb20-10"></span>
<span id="cb20-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>):</span>
<span id="cb20-12">    sns.heatmap(w[i][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax[i], cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>, cbar<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, annot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb20-13">    ax[i].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Filter </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get output from model's first conv1 layer</span></span>
<span id="cb21-2"></span>
<span id="cb21-3">conv1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.relu(model.conv1(test_img))</span>
<span id="cb21-4"></span>
<span id="cb21-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For plotting bring all the images to the same scale</span></span>
<span id="cb21-6">c1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> conv1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> conv1.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()</span>
<span id="cb21-7">c1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> c1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> conv1.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()</span>
<span id="cb21-8"></span>
<span id="cb21-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(c1.shape)</span>
<span id="cb21-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1 image, 6 channels, 24x24 pixels"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch.Size([1, 6, 24, 24])
1 image, 6 channels, 24x24 pixels</code></pre>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualizae the output of the first convolutional layer</span></span>
<span id="cb23-2"></span>
<span id="cb23-3">fig, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb23-4">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> axes.ravel()</span>
<span id="cb23-5"></span>
<span id="cb23-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>):</span>
<span id="cb23-7">    sns.heatmap(c1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][i].detach().numpy(), ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax[i], cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span>
<span id="cb23-8">    ax[i].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Image </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get output from model after max pooling</span></span>
<span id="cb24-2"></span>
<span id="cb24-3">pool1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.max_pool2d(conv1, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb24-4"></span>
<span id="cb24-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For plotting bring all the images to the same scale</span></span>
<span id="cb24-6">p1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pool1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> pool1.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()</span>
<span id="cb24-7">p1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> p1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> pool1.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()</span>
<span id="cb24-8"></span>
<span id="cb24-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(p1.shape)</span>
<span id="cb24-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1 image, 6 channels, 12x12 pixels"</span>)</span>
<span id="cb24-11"></span>
<span id="cb24-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualizae the output of the first convolutional layer</span></span>
<span id="cb24-13"></span>
<span id="cb24-14">fig, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb24-15">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> axes.ravel()</span>
<span id="cb24-16"></span>
<span id="cb24-17"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>):</span>
<span id="cb24-18">    sns.heatmap(p1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][i].detach().numpy(), ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax[i], cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span>
<span id="cb24-19">    ax[i].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Image </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch.Size([1, 6, 12, 12])
1 image, 6 channels, 12x12 pixels</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-18-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualize the filters in the second convolutional layer</span></span>
<span id="cb26-2"></span>
<span id="cb26-3">weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.conv2.weight.data</span>
<span id="cb26-4">w <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> weights.numpy()</span>
<span id="cb26-5"></span>
<span id="cb26-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the weights</span></span>
<span id="cb26-7"></span>
<span id="cb26-8">fig, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>))</span>
<span id="cb26-9">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> axes.ravel()</span>
<span id="cb26-10"></span>
<span id="cb26-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>):</span>
<span id="cb26-12">    sns.heatmap(w[i][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax[i], cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>, cbar<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb26-13">    ax[i].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Filter </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get output from model's second conv2 layer</span></span>
<span id="cb27-2"></span>
<span id="cb27-3">conv2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.relu(model.conv2(pool1))</span>
<span id="cb27-4"></span>
<span id="cb27-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For plotting bring all the images to the same scale</span></span>
<span id="cb27-6">c2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> conv2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> conv2.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()</span>
<span id="cb27-7">c2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> c2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> conv2.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()</span>
<span id="cb27-8"></span>
<span id="cb27-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(c2.shape)</span>
<span id="cb27-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1 image, 16 channels, 8x8 pixels"</span>)</span>
<span id="cb27-11"></span>
<span id="cb27-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualizae the output of the first convolutional layer</span></span>
<span id="cb27-13"></span>
<span id="cb27-14">fig, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>))</span>
<span id="cb27-15">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> axes.ravel()</span>
<span id="cb27-16"></span>
<span id="cb27-17"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>):</span>
<span id="cb27-18">    sns.heatmap(c2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][i].detach().numpy(), ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax[i], cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span>
<span id="cb27-19">    ax[i].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Image </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch.Size([1, 16, 8, 8])
1 image, 16 channels, 8x8 pixels</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-20-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get output from model after max pooling</span></span>
<span id="cb29-2"></span>
<span id="cb29-3">pool2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.max_pool2d(conv2, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb29-4"></span>
<span id="cb29-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For plotting bring all the images to the same scale</span></span>
<span id="cb29-6">p2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pool2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> pool2.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()</span>
<span id="cb29-7">p2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> p2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> pool2.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()</span>
<span id="cb29-8"></span>
<span id="cb29-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(p2.shape)</span>
<span id="cb29-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1 image, 16 channels, 4x4 pixels"</span>)</span>
<span id="cb29-11"></span>
<span id="cb29-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualizae the output of the first convolutional layer</span></span>
<span id="cb29-13"></span>
<span id="cb29-14">fig, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>))</span>
<span id="cb29-15">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> axes.ravel()</span>
<span id="cb29-16"></span>
<span id="cb29-17"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>):</span>
<span id="cb29-18">    sns.heatmap(p2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][i].detach().numpy(), ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax[i], cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span>
<span id="cb29-19">    ax[i].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Image </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch.Size([1, 16, 4, 4])
1 image, 16 channels, 4x4 pixels</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-21-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flatten the output of the second convolutional layer</span></span>
<span id="cb31-2"></span>
<span id="cb31-3">flat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pool2.view(pool2.size(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb31-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(flat.shape)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch.Size([1, 256])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Repeat the above process as a function to visualize the convolution outputs for any image for any layer</span></span>
<span id="cb33-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> scale_img(img):</span>
<span id="cb33-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb33-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Scale the image to the same scale</span></span>
<span id="cb33-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb33-6">    img <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> img.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()</span>
<span id="cb33-7">    img <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> img <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> img.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()</span>
<span id="cb33-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> img</span>
<span id="cb33-9"></span>
<span id="cb33-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> visualize_conv_output(model, img):</span>
<span id="cb33-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb33-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Visualize the output of a convolutional layer</span></span>
<span id="cb33-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb33-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get output from model's first conv1 layer</span></span>
<span id="cb33-15">    conv1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.relu(model.conv1(img))</span>
<span id="cb33-16"></span>
<span id="cb33-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For plotting bring all the images to the same scale</span></span>
<span id="cb33-18">    c1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scale_img(conv1)</span>
<span id="cb33-19"></span>
<span id="cb33-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualizae the output of the first convolutional layer</span></span>
<span id="cb33-21">    fig, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb33-22">    ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> axes.ravel()</span>
<span id="cb33-23"></span>
<span id="cb33-24"></span>
<span id="cb33-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>):</span>
<span id="cb33-26">        sns.heatmap(c1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][i].detach().numpy(), ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax[i], cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span>
<span id="cb33-27">        ax[i].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Image </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb33-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add title to the figure</span></span>
<span id="cb33-29">    fig.suptitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Convolutional Layer 1'</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span>
<span id="cb33-30">    </span>
<span id="cb33-31">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get output from model after max pooling</span></span>
<span id="cb33-32">    pool1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.max_pool2d(conv1, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb33-33"></span>
<span id="cb33-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For plotting bring all the images to the same scale</span></span>
<span id="cb33-35">    p1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scale_img(pool1)</span>
<span id="cb33-36"></span>
<span id="cb33-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualizae the output of the first convolutional layer</span></span>
<span id="cb33-38">    fig, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb33-39">    ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> axes.ravel()</span>
<span id="cb33-40"></span>
<span id="cb33-41"></span>
<span id="cb33-42">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>):</span>
<span id="cb33-43">        sns.heatmap(p1[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][i].detach().numpy(), ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax[i], cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span>
<span id="cb33-44">        ax[i].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Image </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb33-45">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add title to the figure</span></span>
<span id="cb33-46">    fig.suptitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Max Pooling Layer 1'</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span>
<span id="cb33-47"></span>
<span id="cb33-48">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get output from model's second conv2 layer</span></span>
<span id="cb33-49">    conv2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.relu(model.conv2(pool1))</span>
<span id="cb33-50"></span>
<span id="cb33-51">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For plotting bring all the images to the same scale</span></span>
<span id="cb33-52">    c2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scale_img(conv2)</span>
<span id="cb33-53"></span>
<span id="cb33-54">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualizae the output of the first convolutional layer</span></span>
<span id="cb33-55">    fig, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>))</span>
<span id="cb33-56">    ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> axes.ravel()</span>
<span id="cb33-57"></span>
<span id="cb33-58">    </span>
<span id="cb33-59">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>):</span>
<span id="cb33-60">        sns.heatmap(c2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][i].detach().numpy(), ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax[i], cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span>
<span id="cb33-61">        ax[i].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Image </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb33-62">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add title to the figure</span></span>
<span id="cb33-63">    fig.suptitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Convolutional Layer 2'</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span>
<span id="cb33-64"></span>
<span id="cb33-65">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get output from model after max pooling</span></span>
<span id="cb33-66">    pool2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.max_pool2d(conv2, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb33-67"></span>
<span id="cb33-68">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For plotting bring all the images to the same scale</span></span>
<span id="cb33-69">    p2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scale_img(pool2)</span>
<span id="cb33-70"></span>
<span id="cb33-71">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualizae the output of the first convolutional layer</span></span>
<span id="cb33-72">    fig, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>))</span>
<span id="cb33-73">    ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> axes.ravel()</span>
<span id="cb33-74"></span>
<span id="cb33-75">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>):</span>
<span id="cb33-76">        sns.heatmap(p2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][i].detach().numpy(), ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax[i], cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span>
<span id="cb33-77">        ax[i].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Image </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb33-78">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add title to the figure</span></span>
<span id="cb33-79">    fig.suptitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Max Pooling Layer 2'</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1">visualize_conv_output(model, train_data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].unsqueeze(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-24-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-24-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-24-output-4.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1">visualize_conv_output(model, train_data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].unsqueeze(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-25-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-25-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/cnn_files/figure-html/cell-25-output-4.png" class="img-fluid"></p>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/cnn.html</guid>
  <pubDate>Mon, 03 Apr 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Generating names using MLPs</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/names.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.nn.functional <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> F</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> torch <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> nn</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for making figures</span></span>
<span id="cb1-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span>
<span id="cb1-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>config InlineBackend.figure_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retina'</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">torch.__version__</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>'2.0.0+cu118'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">device <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.device(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cuda"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> torch.cuda.is_available() <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cpu"</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get some names from https://github.com/MASTREX/List-of-Indian-Names</span></span></code></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>wget https:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span>raw.githubusercontent.com<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>balasahebgulave<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>Dataset<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Indian<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>master<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>Indian_Names.csv <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>O names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">long</span>.csv</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--2023-03-31 17:00:55--  https://raw.githubusercontent.com/balasahebgulave/Dataset-Indian-Names/master/Indian_Names.csv
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.110.133, 185.199.109.133, 185.199.108.133, ...
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.110.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 85538 (84K) [text/plain]
Saving to: names-long.csv

names-long.csv      100%[===================&gt;]  83.53K  --.-KB/s    in 0.07s   

2023-03-31 17:00:55 (1.12 MB/s) - names-long.csv saved [85538/85538]
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>head names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">long</span>.csv</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>,Name
0,aabid
1,aabida
2,aachal
3,aadesh
4,aadil
5,aadish
6,aaditya
7,aaenab
8,aafreen</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">words <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'names-long.csv'</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Name"</span>]</span>
<span id="cb10-2">words <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> words.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.lower()</span>
<span id="cb10-3">words <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> words.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.strip()</span>
<span id="cb10-4">words <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> words.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb10-5"></span>
<span id="cb10-6">words <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> words[words.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb10-7">words <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> words[words.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]</span>
<span id="cb10-8"></span>
<span id="cb10-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Randomly shuffle the words</span></span>
<span id="cb10-10">words <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> words.sample(frac<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>).reset_index(drop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb10-11">words <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> words.tolist()</span>
<span id="cb10-12"></span>
<span id="cb10-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove words having non alphabets</span></span>
<span id="cb10-14">words <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [word <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> word <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> words <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> word.isalpha()]</span>
<span id="cb10-15">words[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>['sehran',
 'iema',
 'bajinder',
 'manoj',
 'nayaka',
 'ajmal',
 'navleen',
 'akhtari',
 'samsung',
 'imtyaz']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(words)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>6184</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># build the vocabulary of characters and mappings to/from integers</span></span>
<span id="cb14-2">chars <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sorted</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>.join(words))))</span>
<span id="cb14-3">stoi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {s:i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i,s <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(chars)}</span>
<span id="cb14-4">stoi[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb14-5">itos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {i:s <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> s,i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> stoi.items()}</span>
<span id="cb14-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(itos)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{1: 'a', 2: 'b', 3: 'c', 4: 'd', 5: 'e', 6: 'f', 7: 'g', 8: 'h', 9: 'i', 10: 'j', 11: 'k', 12: 'l', 13: 'm', 14: 'n', 15: 'o', 16: 'p', 17: 'q', 18: 'r', 19: 's', 20: 't', 21: 'u', 22: 'v', 23: 'w', 24: 'x', 25: 'y', 26: 'z', 0: '.'}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">block_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># context length: how many characters do we take to predict the next one?</span></span>
<span id="cb16-2">X, Y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [], []</span>
<span id="cb16-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> w <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> words[:]:</span>
<span id="cb16-4">  </span>
<span id="cb16-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print(w)</span></span>
<span id="cb16-6">  context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> block_size</span>
<span id="cb16-7">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> ch <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> w <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.'</span>:</span>
<span id="cb16-8">    ix <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stoi[ch]</span>
<span id="cb16-9">    X.append(context)</span>
<span id="cb16-10">    Y.append(ix)</span>
<span id="cb16-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print(''.join(itos[i] for i in context), '---&gt;', itos[ix])</span></span>
<span id="cb16-12">    context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> [ix] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># crop and append</span></span>
<span id="cb16-13">  </span>
<span id="cb16-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Move data to GPU</span></span>
<span id="cb16-15"></span>
<span id="cb16-16">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.tensor(X).to(device)</span>
<span id="cb16-17">Y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.tensor(Y).to(device)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">X.shape, X.dtype, Y.shape, Y.dtype</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>(torch.Size([44325, 4]), torch.int64, torch.Size([44325]), torch.int64)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Embedding layer for the context</span></span>
<span id="cb19-2"></span>
<span id="cb19-3">emb_dim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb19-4">emb <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.nn.Embedding(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(stoi), emb_dim)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">emb.weight</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>Parameter containing:
tensor([[-0.7321, -0.0133],
        [ 0.9890, -0.3715],
        [-1.2565, -0.3346],
        [ 0.3989,  1.4209],
        [-0.5718, -0.1615],
        [ 0.4853,  2.2499],
        [ 0.1107,  2.7214],
        [-1.7009,  1.1288],
        [-0.6636, -1.1188],
        [-1.6768,  1.0876],
        [ 0.1645,  0.0063],
        [-1.0367, -0.9603],
        [-3.0939,  1.9831],
        [-0.8332,  0.8572],
        [-1.4305, -0.6878],
        [-0.5197, -0.9626],
        [-2.3395,  0.6205],
        [-0.7045,  0.2387],
        [ 2.8074, -0.8545],
        [-0.2396, -0.7623],
        [-1.1135, -0.1288],
        [-0.5464, -0.0345],
        [-1.2686,  1.0719],
        [-1.3973, -0.5510],
        [ 0.9127,  1.2566],
        [ 0.6278,  1.1915],
        [ 0.0465,  1.2633]], requires_grad=True)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to visualize the embedding in 2d space</span></span>
<span id="cb22-2"></span>
<span id="cb22-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> plot_emb(emb, itos, ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>):</span>
<span id="cb22-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> ax <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb22-5">        fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots()</span>
<span id="cb22-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(itos)):</span>
<span id="cb22-7">        x, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> emb.weight[i].detach().cpu().numpy()</span>
<span id="cb22-8">        ax.scatter(x, y, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>)</span>
<span id="cb22-9">        ax.text(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, itos[i])</span>
<span id="cb22-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> ax</span>
<span id="cb22-11"></span>
<span id="cb22-12">plot_emb(emb, itos)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/names_files/figure-html/cell-15-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> NextChar(nn.Module):</span>
<span id="cb24-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, block_size, vocab_size, emb_dim, hidden_size):</span>
<span id="cb24-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>()</span>
<span id="cb24-4">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.emb <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Embedding(vocab_size, emb_dim)</span>
<span id="cb24-5">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.lin1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Linear(block_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> emb_dim, hidden_size)</span>
<span id="cb24-6">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.lin2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Linear(hidden_size, vocab_size)</span>
<span id="cb24-7"></span>
<span id="cb24-8">  <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> forward(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, x):</span>
<span id="cb24-9">    x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.emb(x)</span>
<span id="cb24-10">    x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x.view(x.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb24-11">    x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.relu(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.lin1(x))</span>
<span id="cb24-12">    x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.lin2(x)</span>
<span id="cb24-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> x</span>
<span id="cb24-14">    </span></code></pre></div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate names from untrained model</span></span>
<span id="cb25-2"></span>
<span id="cb25-3"></span>
<span id="cb25-4">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> NextChar(block_size, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(stoi), emb_dim, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>).to(device)</span>
<span id="cb25-5">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">compile</span>(model)</span>
<span id="cb25-6"></span>
<span id="cb25-7">g <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.Generator()</span>
<span id="cb25-8">g.manual_seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4000002</span>)</span>
<span id="cb25-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> generate_name(model, itos, stoi, block_size, max_len<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>):</span>
<span id="cb25-10">    context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> block_size</span>
<span id="cb25-11">    name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span></span>
<span id="cb25-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(max_len):</span>
<span id="cb25-13">        x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.tensor(context).view(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>).to(device)</span>
<span id="cb25-14">        y_pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(x)</span>
<span id="cb25-15">        ix <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.distributions.categorical.Categorical(logits<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>y_pred).sample().item()</span>
<span id="cb25-16">        ch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> itos[ix]</span>
<span id="cb25-17">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> ch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.'</span>:</span>
<span id="cb25-18">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">break</span></span>
<span id="cb25-19">        name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> ch</span>
<span id="cb25-20">        context <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> context[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> [ix]</span>
<span id="cb25-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> name</span>
<span id="cb25-22"></span>
<span id="cb25-23"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>):</span>
<span id="cb25-24">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(generate_name(model, itos, stoi, block_size))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/nipun.batra/miniforge3/lib/python3.9/site-packages/torch/_inductor/compile_fx.py:90: UserWarning: TensorFloat32 tensor cores for float32 matrix multiplication available but not enabled. Consider setting `torch.set_float32_matmul_precision('high')` for better performance.
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>ihjzyewjrp
puijjpnwfk
gcvvflic
eeokqgmlse
yiaghsikiv
smmggfnsot
ptdmdlmwfi
yitpyixshw
gjqapafodl
dfuhgoowtb</code></pre>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> param_name, param <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> model.named_parameters():</span>
<span id="cb28-2">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(param_name, param.shape)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>emb.weight torch.Size([27, 2])
lin1.weight torch.Size([50, 8])
lin1.bias torch.Size([50])
lin2.weight torch.Size([27, 50])
lin2.bias torch.Size([27])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Train the model</span></span>
<span id="cb30-2"></span>
<span id="cb30-3">loss_fn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.CrossEntropyLoss()</span>
<span id="cb30-4">opt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.optim.AdamW(model.parameters(), lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb30-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb30-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mini-batch training</span></span>
<span id="cb30-7">batch_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4096</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span></span>
<span id="cb30-8">print_every <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span></span>
<span id="cb30-9">elapsed_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb30-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> epoch <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>):</span>
<span id="cb30-11">    start_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb30-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, X.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], batch_size):</span>
<span id="cb30-13">        x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[i:i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>batch_size]</span>
<span id="cb30-14">        y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Y[i:i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>batch_size]</span>
<span id="cb30-15">        y_pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(x)</span>
<span id="cb30-16">        loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> loss_fn(y_pred, y)</span>
<span id="cb30-17">        loss.backward()</span>
<span id="cb30-18">        opt.step()</span>
<span id="cb30-19">        opt.zero_grad()</span>
<span id="cb30-20">    end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb30-21">    elapsed_time.append(end_time <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start_time)</span>
<span id="cb30-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> epoch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> print_every <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb30-23">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(epoch, loss.item())</span>
<span id="cb30-24">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time taken for 1 epochs: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> seconds"</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(elapsed_time)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>print_every))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0 2.0890238285064697
Time taken for 1 epochs: 6.577968597412109e-06 seconds
400 2.0890519618988037
Time taken for 1 epochs: 0.0018871128559112549 seconds
800 2.088754177093506
Time taken for 1 epochs: 0.0037400954961776733 seconds
1200 2.0887293815612793
Time taken for 1 epochs: 0.005593389868736267 seconds
1600 2.0884861946105957
Time taken for 1 epochs: 0.007446771860122681 seconds
2000 2.0891528129577637
Time taken for 1 epochs: 0.009300289154052734 seconds
2400 2.0879929065704346
Time taken for 1 epochs: 0.011153245568275452 seconds
2800 2.088449239730835
Time taken for 1 epochs: 0.013006348609924317 seconds
3200 2.0879693031311035
Time taken for 1 epochs: 0.014860434532165527 seconds
3600 2.0881006717681885
Time taken for 1 epochs: 0.016712880134582518 seconds
4000 2.087575912475586
Time taken for 1 epochs: 0.01856597661972046 seconds
4400 2.087235689163208
Time taken for 1 epochs: 0.020418978929519653 seconds
4800 2.087622880935669
Time taken for 1 epochs: 0.02227234423160553 seconds
5200 2.087576150894165
Time taken for 1 epochs: 0.02412549138069153 seconds
5600 2.0879015922546387
Time taken for 1 epochs: 0.025978831052780153 seconds
6000 2.088137626647949
Time taken for 1 epochs: 0.027831865549087523 seconds
6400 2.0875606536865234
Time taken for 1 epochs: 0.029685078263282774 seconds
6800 2.0870373249053955
Time taken for 1 epochs: 0.031538299322128295 seconds
7200 2.0867090225219727
Time taken for 1 epochs: 0.033391504883766174 seconds
7600 2.085026979446411
Time taken for 1 epochs: 0.035245080590248105 seconds
8000 2.0854732990264893
Time taken for 1 epochs: 0.03710031807422638 seconds
8400 2.0843679904937744
Time taken for 1 epochs: 0.03895375490188599 seconds
8800 2.084249258041382
Time taken for 1 epochs: 0.04080682039260864 seconds
9200 2.0851705074310303
Time taken for 1 epochs: 0.042660011649131774 seconds
9600 2.0844883918762207
Time taken for 1 epochs: 0.044512977004051206 seconds</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualize the embedding</span></span>
<span id="cb32-2"></span>
<span id="cb32-3">plot_emb(model.emb, itos)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/names_files/figure-html/cell-20-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate names from trained model</span></span>
<span id="cb34-2"></span>
<span id="cb34-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>):</span>
<span id="cb34-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(generate_name(model, itos, stoi, block_size))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>swina
miter
jakul
poshaban
nahmishsir
jaillanam
fibwahir
gurs
sakinu
ramta</code></pre>
</div>
</div>
<p>Tuning knobs</p>
<ol type="1">
<li>Embedding size</li>
<li>MLP</li>
<li>Context length</li>
</ol>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/names.html</guid>
  <pubDate>Fri, 31 Mar 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>AutoDiff in JAX and PyTorch</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/autodiff-jax-torch.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> jax.numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> jnp</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> jax</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(torch.__version__)</span>
<span id="cb1-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(jax.__version__)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Array(1., dtype=float32, weak_type=True)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> f(x):</span>
<span id="cb3-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> jnp.sin(x)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>Array(1., dtype=float32, weak_type=True)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.tensor(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, requires_grad<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb5-2">torch.sin(z).backward()</span>
<span id="cb5-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(jax.grad(f)(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>), z.grad)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>tensor(1.)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> f(x):</span>
<span id="cb7-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> jnp.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(x)</span>
<span id="cb7-3"></span>
<span id="cb7-4"></span>
<span id="cb7-5">z1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.tensor(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0001</span>, requires_grad<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb7-6">torch.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(z1).backward()</span>
<span id="cb7-7"></span>
<span id="cb7-8">z2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.tensor(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0001</span>, requires_grad<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb7-9">torch.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(z2).backward()</span>
<span id="cb7-10"></span>
<span id="cb7-11">z3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.tensor(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, requires_grad<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb7-12">torch.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(z3).backward()</span>
<span id="cb7-13"></span>
<span id="cb7-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(jax.grad(f)(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>), z1.grad, z2.grad, z3.grad)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1.0 tensor(1.) tensor(-1.) tensor(0.)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use functorch</span></span>
<span id="cb9-2"></span>
<span id="cb9-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> functorch</span></code></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ImportError: dlopen(/Users/nipun/miniconda3/lib/python3.9/site-packages/functorch/_C.cpython-39-darwin.so, 0x0002): Symbol not found: __ZN2at4_ops10as_strided4callERKNS_6TensorEN3c108ArrayRefINS5_6SymIntEEES8_NS5_8optionalIS7_EE
  Referenced from: &lt;12715304-4308-3E9B-A374-E4ADB3345E65&gt; /Users/nipun/miniconda3/lib/python3.9/site-packages/functorch/_C.cpython-39-darwin.so
  Expected in:     &lt;22ECBAD5-EEDD-3C80-9B5A-0564B60B6811&gt; /Users/nipun/miniconda3/lib/python3.9/site-packages/torch/lib/libtorch_cpu.dylib</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>'1.12.1'</code></pre>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/autodiff-jax-torch.html</guid>
  <pubDate>Wed, 01 Mar 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Neural Network</title>
  <dc:creator>Nipun Batra</dc:creator>
  <link>https://github.com/nipunbatra/pml2023/notebooks/posts/nn.html</link>
  <description><![CDATA[ 



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.nn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> nn</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.nn.functional <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> F</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torch.optim <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> optim</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> torch.utils.data <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DataLoader, TensorDataset</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>matplotlib inline</span>
<span id="cb1-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>config InlineBackend.figure_format <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'retina'</span></span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set random seed for reproducibility</span></span>
<span id="cb1-15">torch.manual_seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb1-16"></span>
<span id="cb1-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Torch version</span></span>
<span id="cb1-18">torch.__version__</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>'2.0.0+cu118'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># MNIST dataset</span></span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> torchvision <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datasets, transforms</span>
<span id="cb3-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> torchvision</span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Split MNIST into train, validation, and test sets</span></span>
<span id="cb3-7">train_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datasets.MNIST(root<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>, train<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, download<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, transform<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>transforms.ToTensor())</span>
<span id="cb3-8">test_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datasets.MNIST(root<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>, train<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, download<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, transform<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>transforms.ToTensor())</span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Split train_data into train and validation sets</span></span>
<span id="cb3-11">val_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.utils.data.Subset(train_data, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51000</span>))</span>
<span id="cb3-12"></span>
<span id="cb3-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reduce the size of the training set to 5,000</span></span>
<span id="cb3-14">train_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.utils.data.Subset(train_data, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>))</span></code></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create data loaders</span></span>
<span id="cb4-2">batch_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span></span>
<span id="cb4-3"></span>
<span id="cb4-4">train_loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataLoader(train_data, batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>batch_size, shuffle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb4-5">val_loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataLoader(val_data, batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>batch_size, shuffle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb4-6">test_loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataLoader(test_data, batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>batch_size, shuffle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">img, target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">next</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">iter</span>(train_loader))</span>
<span id="cb5-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(img.shape)</span>
<span id="cb5-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(target.shape)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch.Size([64, 1, 28, 28])
torch.Size([64])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">plt.imshow(img[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].numpy().squeeze(), cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray_r'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/nn_files/figure-html/cell-6-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">target</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>tensor([3, 4, 1, 8, 9, 3, 9, 8, 4, 8, 3, 0, 0, 7, 7, 1, 6, 6, 9, 7, 4, 3, 3, 4,
        5, 7, 3, 2, 8, 4, 8, 2, 8, 3, 1, 4, 2, 1, 4, 8, 5, 3, 5, 1, 8, 7, 3, 7,
        7, 2, 0, 3, 1, 3, 7, 0, 7, 1, 7, 6, 4, 1, 8, 0])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Store the labels and Images in TensorBoard</span></span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> torch.utils.tensorboard <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> SummaryWriter</span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clean up any old runs</span></span>
<span id="cb10-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>rm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>rf runs</span>
<span id="cb10-7"></span>
<span id="cb10-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Default `log_dir` is "runs"</span></span>
<span id="cb10-9">writer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> SummaryWriter(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'runs/mnist'</span>)</span>
<span id="cb10-10"></span>
<span id="cb10-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add images to tensorboard in the form of a grid in batches of 64</span></span>
<span id="cb10-12">dataiter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">iter</span>(DataLoader(train_data, batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>, shuffle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>))</span>
<span id="cb10-13"></span>
<span id="cb10-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add a slider in tensorboard to iterate through the batches</span></span>
<span id="cb10-15"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>):</span>
<span id="cb10-16">    images, labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">next</span>(dataiter)</span>
<span id="cb10-17">    images <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torchvision.utils.make_grid(images)</span>
<span id="cb10-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add images with labels to tensorboard</span></span>
<span id="cb10-19">    writer.add_image(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'mnist_images_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>, images, global_step<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>i)</span></code></pre></div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define model for 10-class MNIST classification</span></span>
<span id="cb11-2"></span>
<span id="cb11-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">class</span> MNISTClassifier(nn.Module):</span>
<span id="cb11-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb11-5">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>().<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>()</span>
<span id="cb11-6">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fc1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Linear(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">784</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>)</span>
<span id="cb11-7">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fc2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Linear(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>)</span>
<span id="cb11-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fc3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Linear(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb11-9">        </span>
<span id="cb11-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">def</span> forward(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, x):</span>
<span id="cb11-11">        z1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fc1(x)</span>
<span id="cb11-12">        a1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.relu(z1)</span>
<span id="cb11-13">        z2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fc2(a1)</span>
<span id="cb11-14">        a2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.relu(z2)</span>
<span id="cb11-15">        z3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.fc3(a2) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># logits</span></span>
<span id="cb11-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">return</span> z3</span></code></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MNISTClassifier()</span></code></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Forward pass through the model</span></span>
<span id="cb13-2"></span>
<span id="cb13-3"></span>
<span id="cb13-4"></span>
<span id="cb13-5">saved_img, saved_target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">next</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">iter</span>(train_loader))</span>
<span id="cb13-6">saved_img <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> saved_img.view(saved_img.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(saved_img.shape)</span>
<span id="cb13-8"></span>
<span id="cb13-9">plt.imshow(saved_img[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].reshape(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>), cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray_r'</span>)</span>
<span id="cb13-10">plt.title(saved_target[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].item())</span>
<span id="cb13-11"></span>
<span id="cb13-12"></span>
<span id="cb13-13"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> torch.no_grad():</span>
<span id="cb13-14">    out <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(saved_img.view(saved_img.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb13-15"></span>
<span id="cb13-16"></span>
<span id="cb13-17"></span>
<span id="cb13-18"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(out[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb13-19"></span>
<span id="cb13-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Softmax</span></span>
<span id="cb13-21">probas <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.softmax(out, dim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb13-22"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(probas[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch.Size([64, 784])
tensor([-0.1859, -0.1648,  0.0156,  0.0309,  0.1785, -0.1567, -0.0472,  0.1143,
        -0.0400, -0.0006])
tensor([0.0846, 0.0864, 0.1035, 0.1051, 0.1218, 0.0871, 0.0972, 0.1143, 0.0979,
        0.1019])</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="https://github.com/nipunbatra/pml2023/notebooks/posts/nn_files/figure-html/cell-11-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">probas[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>tensor([[0.0846, 0.0864, 0.1035, 0.1051, 0.1218, 0.0871, 0.0972, 0.1143, 0.0979,
         0.1019]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Predicted label before training</span></span>
<span id="cb17-2"></span>
<span id="cb17-3">pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.argmax(probas[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], dim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>).item()</span>
<span id="cb17-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Prediction:  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>pred<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, True label: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>saved_target[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>item()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Prediction:  4, True label: 2</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">model.fc1.weight.shape, model.fc1.bias.shape</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>(torch.Size([64, 784]), torch.Size([64]))</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of parameters in fc1</span></span>
<span id="cb21-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fc1"</span>, model.fc1.weight.numel() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> model.fc1.bias.numel())</span>
<span id="cb21-3"></span>
<span id="cb21-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of parameters in fc2</span></span>
<span id="cb21-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fc2"</span>, model.fc2.weight.numel() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> model.fc2.bias.numel())</span>
<span id="cb21-6"></span>
<span id="cb21-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of parameters in fc3</span></span>
<span id="cb21-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fc3"</span>, model.fc3.weight.numel() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> model.fc3.bias.numel())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>fc1 50240
fc2 2080
fc3 330</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get total number of parameters</span></span>
<span id="cb23-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total number of parameters:"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(p.numel() <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> p <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> model.parameters()))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total number of parameters: 52650</code></pre>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(train_loader)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>79</code></pre>
</div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Forward pass through the model and writing to tensorboard</span></span>
<span id="cb27-2"></span>
<span id="cb27-3">lr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span></span>
<span id="cb27-4">optimizer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> optim.Adam(model.parameters(), lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lr)</span>
<span id="cb27-5">criterion <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.CrossEntropyLoss()</span>
<span id="cb27-6"></span>
<span id="cb27-7">num_epochs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb27-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> epoch <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(num_epochs):</span>
<span id="cb27-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> batch_idx, (data_test, target) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(train_loader):</span>
<span id="cb27-10">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reshape data to input to the network</span></span>
<span id="cb27-11">        data_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_test.view(data_test.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb27-12">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Forward pass</span></span>
<span id="cb27-13">        output <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(data_test)</span>
<span id="cb27-14">        loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> criterion(output, target)</span>
<span id="cb27-15">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Backward and optimize</span></span>
<span id="cb27-16">        optimizer.zero_grad()</span>
<span id="cb27-17">        loss.backward()</span>
<span id="cb27-18">        optimizer.step()</span>
<span id="cb27-19"></span>
<span id="cb27-20">        iteration_num <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> epoch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(train_loader) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> batch_idx</span>
<span id="cb27-21">        </span>
<span id="cb27-22">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Write to tensorboard</span></span>
<span id="cb27-23">        writer.add_scalar(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Loss/train'</span>, loss.item(), iteration_num)</span>
<span id="cb27-24">        writer.add_scalar(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Accuracy/train'</span>, (output.argmax(dim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> target).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>().mean(), iteration_num)</span>
<span id="cb27-25"></span>
<span id="cb27-26">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find test loss and accuracy</span></span>
<span id="cb27-27">        runing_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb27-28">        running_acc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb27-29">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> torch.no_grad():</span>
<span id="cb27-30">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> data_test, target_test <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> val_loader:</span>
<span id="cb27-31">                data_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_test.view(data_test.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb27-32">                output_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(data_test)</span>
<span id="cb27-33">                loss_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> criterion(output_test, target_test)</span>
<span id="cb27-34">                runing_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> loss_test.item()</span>
<span id="cb27-35">                running_acc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> (output_test.argmax(dim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> target_test).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>().mean()</span>
<span id="cb27-36">        writer.add_scalar(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Loss/validation'</span>, runing_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(val_loader), iteration_num)</span>
<span id="cb27-37">        writer.add_scalar(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Accuracy/validation'</span>, running_acc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(val_loader), iteration_num)</span>
<span id="cb27-38"></span>
<span id="cb27-39">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> batch_idx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb27-40">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span> (<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Epoch [</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>epoch<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>num_epochs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">], Step [</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>batch_idx<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(train_loader)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">], Loss: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>loss<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>item()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch [1/1], Step [0/79], Loss: 2.3027</code></pre>
</div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prediction on the saved image</span></span>
<span id="cb29-2"></span>
<span id="cb29-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">with</span> torch.no_grad():</span>
<span id="cb29-4">    out <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(saved_img[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb29-5">    probas <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> F.softmax(out, dim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb29-6">    pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.argmax(probas, dim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>).item()</span>
<span id="cb29-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(pred, saved_target[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].item())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1 1</code></pre>
</div>
</div>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a HParam dictionary for batch size and learning rate for tensorboard</span></span>
<span id="cb31-2"></span>
<span id="cb31-3">b_sizes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">512</span>]</span>
<span id="cb31-4">lrs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>]</span>
<span id="cb31-5"></span>
<span id="cb31-6"></span>
<span id="cb31-7">num_epochs  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb31-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> epoch <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(num_epochs):</span>
<span id="cb31-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> b_size <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> b_sizes:</span>
<span id="cb31-10">        train_loader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DataLoader(train_data, batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>b_size, shuffle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb31-11">        model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MNISTClassifier()</span>
<span id="cb31-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> lr <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> lrs:</span>
<span id="cb31-13">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Batch size: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>b_size<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, Learning rate: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>lr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb31-14">            optimizer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> optim.Adam(model.parameters(), lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lr)</span>
<span id="cb31-15">            criterion <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.CrossEntropyLoss()</span>
<span id="cb31-16">            <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">for</span> batch_idx, (data, target) <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(train_loader):</span>
<span id="cb31-17">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reshape data to input to the network</span></span>
<span id="cb31-18">                data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.view(data.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb31-19">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Forward pass</span></span>
<span id="cb31-20">                output <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model(data)</span>
<span id="cb31-21">                loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> criterion(output, target)</span>
<span id="cb31-22">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Backward and optimize</span></span>
<span id="cb31-23">                optimizer.zero_grad()</span>
<span id="cb31-24">                loss.backward()</span>
<span id="cb31-25">                optimizer.step()</span>
<span id="cb31-26">                </span>
<span id="cb31-27"></span>
<span id="cb31-28">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Write loss as scalar to Tensorboard and hyperparameters to HParams</span></span>
<span id="cb31-29">                writer.add_scalar(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'training loss'</span>,</span>
<span id="cb31-30">                                loss.item(),</span>
<span id="cb31-31">                                epoch <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(train_loader) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> batch_idx)</span>
<span id="cb31-32">                writer.add_hparams({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lr'</span>: lr, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bsize'</span>: b_size},</span>
<span id="cb31-33">                                { <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'hparam/loss'</span>: loss.item()})</span>
<span id="cb31-34">                </span>
<span id="cb31-35"></span>
<span id="cb31-36">    </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Batch size: 32, Learning rate: 0.001
Batch size: 32, Learning rate: 0.01
Batch size: 32, Learning rate: 0.1
Batch size: 64, Learning rate: 0.001
Batch size: 64, Learning rate: 0.01
Batch size: 64, Learning rate: 0.1
Batch size: 512, Learning rate: 0.001
Batch size: 512, Learning rate: 0.01
Batch size: 512, Learning rate: 0.1</code></pre>
</div>
</div>



 ]]></description>
  <guid>https://github.com/nipunbatra/pml2023/notebooks/posts/nn.html</guid>
  <pubDate>Tue, 28 Feb 2023 00:00:00 GMT</pubDate>
</item>
</channel>
</rss>
